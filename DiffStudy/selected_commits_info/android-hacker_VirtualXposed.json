[
  {
    "oid": "fa917b86b06f1c6a999b4e071098a31da84e72e3",
    "message": "Optimize: opt the Broadcast hook.",
    "date": "2016-11-27T14:04:48Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/fa917b86b06f1c6a999b4e071098a31da84e72e3",
    "details": {
      "sha": "914707ca40d030da634d1aade7c288a53f27809d",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/env/SpecialComponentList.java",
      "status": "modified",
      "additions": 14,
      "deletions": 8,
      "changes": 22,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/fa917b86b06f1c6a999b4e071098a31da84e72e3/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fenv%2FSpecialComponentList.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/fa917b86b06f1c6a999b4e071098a31da84e72e3/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fenv%2FSpecialComponentList.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fenv%2FSpecialComponentList.java?ref=fa917b86b06f1c6a999b4e071098a31da84e72e3",
      "patch": "@@ -14,22 +14,25 @@\n  */\n public final class SpecialComponentList {\n \n+    private static String PROTECT_ACTION_PREFIX = \"_VA_protected_\";\n+\n     private static final List<String> ACTION_BLACK_LIST = new ArrayList<String>(1);\n \n-    private static final Map<String, String> PROTECTED_ACTION_MAP = new HashMap<>();\n-    private static final HashSet<String> WHITE_PERMISSION = new HashSet<>();\n+    private static final Map<String, String> PROTECTED_ACTION_MAP = new HashMap<>(5);\n+    private static final HashSet<String> WHITE_PERMISSION = new HashSet<>(3);\n \n     static {\n         ACTION_BLACK_LIST.add(\"android.appwidget.action.APPWIDGET_UPDATE\");\n+\n+        WHITE_PERMISSION.add(\"com.google.android.gms.settings.SECURITY_SETTINGS\");\n+        WHITE_PERMISSION.add(\"com.google.android.apps.plus.PRIVACY_SETTINGS\");\n+        WHITE_PERMISSION.add(Manifest.permission.ACCOUNT_MANAGER);\n+\n         PROTECTED_ACTION_MAP.put(Intent.ACTION_PACKAGE_ADDED, Constants.ACTION_PACKAGE_ADDED);\n         PROTECTED_ACTION_MAP.put(Intent.ACTION_PACKAGE_REMOVED, Constants.ACTION_PACKAGE_REMOVED);\n         PROTECTED_ACTION_MAP.put(Intent.ACTION_PACKAGE_CHANGED, Constants.ACTION_PACKAGE_CHANGED);\n         PROTECTED_ACTION_MAP.put(\"android.intent.action.USER_ADDED\", Constants.ACTION_USER_ADDED);\n         PROTECTED_ACTION_MAP.put(\"android.intent.action.USER_REMOVED\", Constants.ACTION_USER_REMOVED);\n-\n-        WHITE_PERMISSION.add(\"com.google.android.gms.settings.SECURITY_SETTINGS\");\n-        WHITE_PERMISSION.add(\"com.google.android.apps.plus.PRIVACY_SETTINGS\");\n-        WHITE_PERMISSION.add(Manifest.permission.ACCOUNT_MANAGER);\n     }\n \n     /**\n@@ -53,7 +56,7 @@ public static void addBlackAction(String action) {\n     public static String protectAction(String originAction) {\n         String newAction = PROTECTED_ACTION_MAP.get(originAction);\n         if (newAction == null) {\n-            return String.format(\"_VA_protected_%s\", originAction);\n+            newAction = PROTECT_ACTION_PREFIX + originAction;\n         }\n         return newAction;\n     }\n@@ -62,13 +65,16 @@ public static String restoreAction(String action) {\n         if (action == null) {\n             return null;\n         }\n+        if (action.startsWith(PROTECT_ACTION_PREFIX)) {\n+            return action.substring(PROTECT_ACTION_PREFIX.length());\n+        }\n         for (Map.Entry<String, String> next : PROTECTED_ACTION_MAP.entrySet()) {\n             String modifiedAction = next.getValue();\n             if (modifiedAction.equals(action)) {\n                 return next.getKey();\n             }\n         }\n-        return action.startsWith(\"_VA_protected_\") ? action.substring(\"_VA_protected_\".length()) : null;\n+        return null;\n     }\n \n     public static boolean isWhitePermission(String permission) {",
      "parent_sha": "18905660fd1c7281a3846a96264f026aa0632f86"
    }
  },
  {
    "oid": "6e51960ffe469ae16cb5bdc4dbd09db6566d4774",
    "message": "Fix: uninstall app bug.",
    "date": "2017-03-08T11:25:33Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/6e51960ffe469ae16cb5bdc4dbd09db6566d4774",
    "details": {
      "sha": "96e24b491c96cbb96dd042603a5e5324f25043d3",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/server/pm/VAppManagerService.java",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/6e51960ffe469ae16cb5bdc4dbd09db6566d4774/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fpm%2FVAppManagerService.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/6e51960ffe469ae16cb5bdc4dbd09db6566d4774/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fpm%2FVAppManagerService.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fpm%2FVAppManagerService.java?ref=6e51960ffe469ae16cb5bdc4dbd09db6566d4774",
      "patch": "@@ -237,8 +237,8 @@ public boolean uninstallApp(String pkg) {\n                 try {\n                     BroadcastSystem.get().stopApp(pkg);\n                     VActivityManagerService.get().killAppByPkg(pkg, VUserHandle.USER_ALL);\n-                    FileUtils.deleteDir(VEnvironment.getDataAppPackageDirectory(pkg));\n                     VEnvironment.getPackageResourcePath(pkg).delete();\n+                    FileUtils.deleteDir(VEnvironment.getDataAppPackageDirectory(pkg));\n                     VEnvironment.getOdexFile(pkg).delete();\n                     for (int userId : VUserManagerService.get().getUserIds()) {\n                         FileUtils.deleteDir(VEnvironment.getDataUserPackageDirectory(userId, pkg));",
      "parent_sha": "24500219654d76d945351a9ee7b997717e175a5e"
    }
  },
  {
    "oid": "aa1719baeda63942481a74091f46582e039fe511",
    "message": "Revert \"Revert \"Extracting common method of stopService\"\"",
    "date": "2017-06-17T04:26:07Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/aa1719baeda63942481a74091f46582e039fe511",
    "details": {
      "sha": "6e5ddbaa73a145cae95ea8f67a1e167af86cfa3e",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/server/am/VActivityManagerService.java",
      "status": "modified",
      "additions": 58,
      "deletions": 55,
      "changes": 113,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/aa1719baeda63942481a74091f46582e039fe511/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fam%2FVActivityManagerService.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/aa1719baeda63942481a74091f46582e039fe511/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fam%2FVActivityManagerService.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fam%2FVActivityManagerService.java?ref=aa1719baeda63942481a74091f46582e039fe511",
      "patch": "@@ -413,54 +413,8 @@ public int stopService(IBinder caller, Intent service, String resolvedType, int\n             if (r == null) {\n                 return 0;\n             }\n-            if (!r.hasAutoCreateConnections()) {\n-\n-                // Report to all of the connections that the service is no longer\n-                // available.\n-                if (r.connections != null && r.connections.values() != null) {\n-                    Iterator<ArrayList<ConnectionRecord>> crs = r.connections.values().iterator();\n-                    while (crs.hasNext()) {\n-                        ArrayList<ConnectionRecord> c = crs.next();\n-                        for (int i = 0; i < c.size(); i++) {\n-                            ConnectionRecord cr = c.get(i);\n-                            // There is still a connection to the service that is\n-                            // being brought down.  Mark it as dead.\n-                            cr.serviceDead = true;\n-                            try {\n-                                cr.conn.connected(r.name, null);\n-                            } catch (Exception e) {\n-\n-                            }\n-                        }\n-                    }\n-                }\n \n-                // Tell the service that it has been unbound.\n-                if (r.process != null && r.process.appThread != null) {\n-                    Set<Map.Entry<Intent.FilterComparison, ServiceRecord.IntentBindRecord>> entrySet\n-                            = r.bindings.entrySet();\n-                    for (Map.Entry<Intent.FilterComparison, ServiceRecord.IntentBindRecord> entry\n-                            : entrySet) {\n-                        ServiceRecord.IntentBindRecord ibr = entry.getValue();\n-                        if (ibr.hasBound) {\n-                            try {\n-                                ibr.hasBound = false;\n-                                IApplicationThreadCompat.scheduleUnbindService(r.process.appThread,\n-                                        r, ibr.intent);\n-                            } catch (Exception e) {\n-\n-                            }\n-                        }\n-                    }\n-                }\n-\n-                try {\n-                    IApplicationThreadCompat.scheduleStopService(r.process.appThread, r);\n-                } catch (RemoteException e) {\n-                    e.printStackTrace();\n-                }\n-                mHistory.remove(r);\n-            }\n+            stopServiceCommon(r);\n             return 1;\n         }\n     }\n@@ -470,20 +424,69 @@ public boolean stopServiceToken(ComponentName className, IBinder token, int star\n         synchronized (this) {\n             ServiceRecord r = (ServiceRecord) token;\n             if (r != null && (r.startId == startId || startId == -1)) {\n-                try {\n-                    IApplicationThreadCompat.scheduleStopService(r.process.appThread, r);\n-                } catch (RemoteException e) {\n-                    e.printStackTrace();\n-                }\n-                if (Build.VERSION.SDK_INT < Build.VERSION_CODES.LOLLIPOP) {\n-                    mHistory.remove(r);\n-                }\n+                stopServiceCommon(r);\n                 return true;\n             }\n             return false;\n         }\n     }\n \n+    /**\n+     * Extracting common method of stopService(see bringDownServiceIfNeededLocked in android source)\n+     * @param r\n+     */\n+    private void stopServiceCommon(ServiceRecord r) {\n+        if (r.hasAutoCreateConnections()) {\n+            return;\n+        }\n+\n+        // Report to all of the connections that the service is no longer\n+        // available.\n+        if (r.connections != null && r.connections.values() != null) {\n+            Iterator<ArrayList<ConnectionRecord>> crs = r.connections.values().iterator();\n+            while (crs.hasNext()) {\n+                ArrayList<ConnectionRecord> c = crs.next();\n+                for (int i = 0; i < c.size(); i++) {\n+                    ConnectionRecord cr = c.get(i);\n+                    // There is still a connection to the service that is\n+                    // being brought down.  Mark it as dead.\n+                    cr.serviceDead = true;\n+                    try {\n+                        cr.conn.connected(r.name, null);\n+                    } catch (Exception e) {\n+\n+                    }\n+                }\n+            }\n+        }\n+\n+        // Tell the service that it has been unbound.\n+        if (r.process != null && r.process.appThread != null) {\n+            Set<Map.Entry<Intent.FilterComparison, ServiceRecord.IntentBindRecord>> entrySet\n+                    = r.bindings.entrySet();\n+            for (Map.Entry<Intent.FilterComparison, ServiceRecord.IntentBindRecord> entry\n+                    : entrySet) {\n+                ServiceRecord.IntentBindRecord ibr = entry.getValue();\n+                if (ibr.hasBound) {\n+                    try {\n+                        ibr.hasBound = false;\n+                        IApplicationThreadCompat.scheduleUnbindService(r.process.appThread,\n+                                r, ibr.intent);\n+                    } catch (Exception e) {\n+\n+                    }\n+                }\n+            }\n+        }\n+\n+        try {\n+            IApplicationThreadCompat.scheduleStopService(r.process.appThread, r);\n+        } catch (RemoteException e) {\n+            e.printStackTrace();\n+        }\n+        mHistory.remove(r);\n+    }\n+\n     @Override\n     public void setServiceForeground(ComponentName className, IBinder token, int id, Notification notification,\n                                      boolean keepNotification, int userId) {",
      "parent_sha": "8260c57a73842044fc01bdcbf2a3a76f1c25c2c3"
    }
  },
  {
    "oid": "bc3c647daf05b030f14c62cc44939e8900460c07",
    "message": "Revert: [VXP]: storage redirect for wechat.",
    "date": "2018-06-06T06:14:44Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/bc3c647daf05b030f14c62cc44939e8900460c07",
    "details": {
      "sha": "1c07853236bcba6495b7d59ce71d4a323da73268",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/VClientImpl.java",
      "status": "modified",
      "additions": 1,
      "deletions": 9,
      "changes": 10,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/bc3c647daf05b030f14c62cc44939e8900460c07/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2FVClientImpl.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/bc3c647daf05b030f14c62cc44939e8900460c07/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2FVClientImpl.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2FVClientImpl.java?ref=bc3c647daf05b030f14c62cc44939e8900460c07",
      "patch": "@@ -23,7 +23,6 @@\n import android.os.Process;\n import android.os.RemoteException;\n import android.os.StrictMode;\n-import android.util.Base64;\n import android.util.Log;\n \n import com.lody.virtual.client.core.CrashHandler;\n@@ -442,21 +441,14 @@ private void setupVirtualStorage(ApplicationInfo info, int userId) {\n \n         VirtualStorageManager vsManager = VirtualStorageManager.get();\n         boolean enable = vsManager.isVirtualStorageEnable(info.packageName, userId);\n-        HashSet<String> mountPoints = getMountPoints();\n         if (enable) {\n             vsManager.setVirtualStorage(info.packageName, userId, vsDir.getPath());\n \n             // redirect for normal path\n+            HashSet<String> mountPoints = getMountPoints();\n             for (String mountPoint : mountPoints) {\n                 NativeEngine.redirectDirectory(mountPoint, vsDir.getPath());\n             }\n-        } else {\n-            final String tStr = new String(Base64.decode(\"dGVuY2VudA==\", 0));\n-            for (String mountPoint : mountPoints) {\n-                File tDir = new File(mountPoint, tStr);\n-                File tRelocateDir = new File(vsDir, tStr);\n-                NativeEngine.redirectDirectory(tDir.getAbsolutePath(), tRelocateDir.getAbsolutePath());\n-            }\n         }\n     }\n ",
      "parent_sha": "00fc26d8e6d7330cd1c15737704791af01d7e234"
    }
  },
  {
    "oid": "a9a09d41dcdfc360d2ebd97cdf1113d4aed0f647",
    "message": "update userLibPath",
    "date": "2017-04-27T07:05:10Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/a9a09d41dcdfc360d2ebd97cdf1113d4aed0f647",
    "details": {
      "sha": "1f2fedc76b4843ab19f45908461005c4dff1ef79",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/VClientImpl.java",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/a9a09d41dcdfc360d2ebd97cdf1113d4aed0f647/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2FVClientImpl.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/a9a09d41dcdfc360d2ebd97cdf1113d4aed0f647/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2FVClientImpl.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2FVClientImpl.java?ref=a9a09d41dcdfc360d2ebd97cdf1113d4aed0f647",
      "patch": "@@ -363,7 +363,7 @@ private void startIOUniformer() {\n             NativeEngine.redirectDirectory(\"/data/user_de/0/\" + info.packageName, info.dataDir);\n         }\n         String libPath = new File(VEnvironment.getDataAppPackageDirectory(info.packageName), \"lib\").getAbsolutePath();\n-        String userLibPath = new File(VEnvironment.getUserSystemDirectory(userId), \"lib\").getAbsolutePath();\n+        String userLibPath = new File(VEnvironment.getDataUserPackageDirectory(userId, info.packageName), \"lib\").getAbsolutePath();\n         NativeEngine.redirectDirectory(userLibPath, libPath);\n         NativeEngine.redirectDirectory(\"/data/data/\" + info.packageName + \"/lib/\", libPath);\n         NativeEngine.redirectDirectory(\"/data/user/0/\" + info.packageName + \"/lib/\", libPath);",
      "parent_sha": "fcaf9ce0ce96f02bff981a36f867355f4f78f1c4"
    }
  },
  {
    "oid": "4214d7a4c7cf5d0c30d53015217a4892d734b85d",
    "message": "Fix: issue #336.",
    "date": "2017-07-21T09:50:54Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/4214d7a4c7cf5d0c30d53015217a4892d734b85d",
    "details": {
      "sha": "87fab9a5f1c501a961237462218680a0109e7acc",
      "filename": "VirtualApp/app/src/main/java/io/virtualapp/home/adapters/AppPagerAdapter.java",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/4214d7a4c7cf5d0c30d53015217a4892d734b85d/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2Fadapters%2FAppPagerAdapter.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/4214d7a4c7cf5d0c30d53015217a4892d734b85d/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2Fadapters%2FAppPagerAdapter.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2Fadapters%2FAppPagerAdapter.java?ref=4214d7a4c7cf5d0c30d53015217a4892d734b85d",
      "patch": "@@ -46,7 +46,7 @@ public AppPagerAdapter(FragmentManager fm) {\n         } else {\n             // Fallback: only support the default storage sources\n             File storageFir = Environment.getExternalStorageDirectory();\n-            if (storageFir.list() != null) {\n+            if (storageFir != null && storageFir.isDirectory()) {\n                 titles.add(VApp.getApp().getResources().getString(R.string.external_storage));\n                 dirs.add(storageFir);\n             }",
      "parent_sha": "5b18855a3c59018c1e9c63e06e1ad3d4e29c4622"
    }
  },
  {
    "oid": "aa1b8b4a1f8d2c7db495a693c160d504055dfcde",
    "message": "[Exposed] fix vector drawable crash on kitkat.",
    "date": "2018-06-06T06:12:31Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/aa1b8b4a1f8d2c7db495a693c160d504055dfcde",
    "details": {
      "sha": "40a30e93d3ecec3c0e677801f59fd60583555b43",
      "filename": "VirtualApp/app/src/main/java/io/virtualapp/about/AboutActivity.java",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/aa1b8b4a1f8d2c7db495a693c160d504055dfcde/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fabout%2FAboutActivity.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/aa1b8b4a1f8d2c7db495a693c160d504055dfcde/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fabout%2FAboutActivity.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fabout%2FAboutActivity.java?ref=aa1b8b4a1f8d2c7db495a693c160d504055dfcde",
      "patch": "@@ -47,7 +47,7 @@ Element getCopyRightsElement() {\n         Element copyRightsElement = new Element();\n         final String copyrights = String.format(getString(R.string.copy_right), Calendar.getInstance().get(Calendar.YEAR));\n         copyRightsElement.setTitle(copyrights);\n-        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {\n+        if (Build.VERSION.SDK_INT > Build.VERSION_CODES.KITKAT) {\n             copyRightsElement.setIconDrawable(R.drawable.about_icon_copy_right);\n         }\n         copyRightsElement.setIconTint(mehdi.sakout.aboutpage.R.color.about_item_icon_color);",
      "parent_sha": "8f9cdaa348c8623f30b2b3c36ddfab2a1526ea4b"
    }
  },
  {
    "oid": "3417e6f3b6294b48799f363221898043c53b9ed8",
    "message": "\u53cc\u5f00\u6a21\u5f0f\u901a\u77e5\u680f\u4f9d\u7136\u662f\u7ed8\u5236bitmap",
    "date": "2016-07-18T03:30:32Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/3417e6f3b6294b48799f363221898043c53b9ed8",
    "details": {
      "sha": "abcc20fd9efbaddc9ad6d737d62c6824c4c59319",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/hook/patchs/notification/compat/NotificationHandler.java",
      "status": "modified",
      "additions": 28,
      "deletions": 32,
      "changes": 60,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/3417e6f3b6294b48799f363221898043c53b9ed8/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fnotification%2Fcompat%2FNotificationHandler.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/3417e6f3b6294b48799f363221898043c53b9ed8/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fnotification%2Fcompat%2FNotificationHandler.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fnotification%2Fcompat%2FNotificationHandler.java?ref=3417e6f3b6294b48799f363221898043c53b9ed8",
      "patch": "@@ -18,7 +18,6 @@\n \n import com.lody.virtual.R;\n import com.lody.virtual.client.core.VirtualCore;\n-import com.lody.virtual.helper.proto.AppInfo;\n import com.lody.virtual.helper.utils.Reflect;\n import com.lody.virtual.helper.utils.XLog;\n \n@@ -107,7 +106,7 @@ public void dealNotificationIcon(int iconId, String packageName, Object... args)\n             if (args[i] instanceof Notification) {\n                 Notification notification = (Notification) args[i];//nobug\n                 final Context pluginContext = VirtualCore.getCore().getContext().createPackageContext(packageName, Context.CONTEXT_IGNORE_SECURITY | Context.CONTEXT_INCLUDE_CODE);\n-                args[i] = new NotificationCompat(pluginContext,mNotificationActionCompat, notification).getNotification();\n+                args[i] = new NotificationCompat(pluginContext, mNotificationActionCompat, notification).getNotification();\n                 break;\n             }\n         }\n@@ -125,32 +124,30 @@ public int dealNotification(Context hostContext, String packageName, Object... a\n         for (int i = 0; i < args.length; i++) {\n             if (args[i] instanceof Notification) {\n                 Notification notification = (Notification) args[i];//nobug\n-                if (isPluginNotification(notification)) {\n-                    //\u53cc\u5f00\u6a21\u5f0f\uff0cicon\u8fd8\u662fva\u7684\n-                    if(VirtualCore.getCore().isOutsideInstalled(packageName))\n-                    {\n+                //\u53cc\u5f00\u6a21\u5f0f\uff0cicon\u8fd8\u662fva\u7684\n+//                    if(VirtualCore.getCore().isOutsideInstalled(packageName))\n+                {\n //                        //\u53cc\u5f00\u6a21\u5f0f\uff0c\u8c8c\u4f3cicon\u4e0d\u592a\u5bf9\n //                        notification.icon = hostContext.getApplicationInfo().icon;\n //                        //23\u7684icon\n //                        mNotificationActionCompat.builderNotificationIcon(notification, notification.icon, VirtualCore.getCore().getResources(packageName));\n //                        return 0;\n //                    }else {\n-                        //    args[i] = replaceNotification(hostContext, packageName, notification);\n-                        Notification notification1 = replaceNotification(hostContext, packageName, notification);\n-                        if (mNotificationActionCompat.shouldBlock(notification)) {\n+                    //    args[i] = replaceNotification(hostContext, packageName, notification);\n+                    Notification notification1 = replaceNotification(hostContext, packageName, notification);\n+                    if (mNotificationActionCompat.shouldBlock(notification)) {\n //                        //\u81ea\u5b9a\u4e49\u5e03\u5c40\u901a\u77e5\u680f\n+                        args[i] = notification1;\n+                        return 0;\n+                    } else {\n+//                        //\u8fd9\u91cc\u8981\u4fee\u6539\u539f\u751f\u7684\u901a\u77e5\uff0c\u662f\u5426\u4e5f\u548c\u4e0a\u9762\u4e00\u6837\u7684\u5904\u7406\uff1f\n+                        final int icon = notification.icon;\n+                        if (notification1 != null) {\n                             args[i] = notification1;\n-                            return 0;\n                         } else {\n-//                        //\u8fd9\u91cc\u8981\u4fee\u6539\u539f\u751f\u7684\u901a\u77e5\uff0c\u662f\u5426\u4e5f\u548c\u4e0a\u9762\u4e00\u6837\u7684\u5904\u7406\uff1f\n-                            final int icon = notification.icon;\n-                            if (notification1 != null) {\n-                                args[i] = notification1;\n-                            } else {\n-                                mNotificationActionCompat.hackNotification(notification);\n-                            }\n-                            return icon;\n+                            mNotificationActionCompat.hackNotification(notification);\n                         }\n+                        return icon;\n                     }\n                 }\n             }\n@@ -256,20 +253,19 @@ private Notification replaceNotification(Context context, String packageName, No\n             return null;\n         }\n \n-\n-        //\u53cc\u5f00\u6a21\u5f0f\u4e0b,\u76f4\u63a5\u8c03\u7528\u539f\u6765\u7684\n-        AppInfo appInfo = VirtualCore.getCore().findApp(packageName);\n-\n-        if (appInfo != null && appInfo.isInstalled() && contentView != null) {\n-            try {\n-                ApplicationInfo applicationInfo = VirtualCore.getCore().getUnHookPackageManager().getApplicationInfo(packageName, 0);\n-                applicationInfo.packageName = VirtualCore.getCore().getHostPkg();\n-                Reflect.on(contentView).set(\"mApplication\", applicationInfo);\n-                return notification;\n-            } catch (Exception e) {\n-                XLog.e(TAG, \"error:\" + e);\n-            }\n-        }\n+//        //\u53cc\u5f00\u6a21\u5f0f\u4e0b,\u76f4\u63a5\u8c03\u7528\u539f\u6765\u7684\n+//        AppInfo appInfo = VirtualCore.getCore().findApp(packageName);\n+//\n+//        if (appInfo != null && appInfo.isInstalled() && contentView != null) {\n+//            try {\n+//                ApplicationInfo applicationInfo = VirtualCore.getCore().getUnHookPackageManager().getApplicationInfo(packageName, 0);\n+//                applicationInfo.packageName = VirtualCore.getCore().getHostPkg();\n+//                Reflect.on(contentView).set(\"mApplication\", applicationInfo);\n+//                return notification;\n+//            } catch (Exception e) {\n+//                XLog.e(TAG, \"error:\" + e);\n+//            }\n+//        }\n \n         Map<Integer, PendingIntent> clickIntents = getClickIntents(contentView);\n         //\u5982\u679c\u5c31\u4e00\u4e2a\u70b9\u51fb\u4e8b\u4ef6\uff0c\u6ca1\u5fc5\u8981\u7528\u590d\u6742view",
      "parent_sha": "0bd1e0658c2e6a8f8dd18303e163daf543725b0d"
    }
  },
  {
    "oid": "2d396a4f4b35f28689bc280ae3111f54498adad0",
    "message": "Don't install Installer if Xposed is disabled.\n\nSigned-off-by: tiann <twsxtd@gmail.com>",
    "date": "2020-11-23T05:37:46Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/2d396a4f4b35f28689bc280ae3111f54498adad0",
    "details": {
      "sha": "08bba4f37425611498ca36a52982fadeb588b7cc",
      "filename": "VirtualApp/app/src/main/java/io/virtualapp/home/NewHomeActivity.java",
      "status": "modified",
      "additions": 6,
      "deletions": 3,
      "changes": 9,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/2d396a4f4b35f28689bc280ae3111f54498adad0/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2FNewHomeActivity.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/2d396a4f4b35f28689bc280ae3111f54498adad0/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2FNewHomeActivity.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2FNewHomeActivity.java?ref=2d396a4f4b35f28689bc280ae3111f54498adad0",
      "patch": "@@ -40,6 +40,7 @@\n import java.io.InputStream;\n import java.io.OutputStream;\n import java.lang.reflect.Method;\n+import java.util.concurrent.atomic.AtomicBoolean;\n \n import io.virtualapp.R;\n import io.virtualapp.abs.ui.VUiKit;\n@@ -62,7 +63,7 @@ public class NewHomeActivity extends NexusLauncherActivity {\n \n     private Handler mUiHandler;\n     private boolean mDirectlyBack = false;\n-    private boolean checkXposedInstaller = true;\n+    private final AtomicBoolean checkXposedInstaller = new AtomicBoolean(true);\n \n     public static void goHome(Context context) {\n         Intent intent = new Intent(context, NewHomeActivity.class);\n@@ -83,6 +84,9 @@ public void onCreate(Bundle savedInstanceState) {\n     }\n \n     private void installXposed() {\n+        if (!VirtualCore.get().isXposedEnabled()) {\n+            return;\n+        }\n         boolean isXposedInstalled = false;\n         try {\n             isXposedInstalled = VirtualCore.get().isAppInstalled(XPOSED_INSTALLER_PACKAGE);\n@@ -156,8 +160,7 @@ private static void dismissDialog(ProgressDialog dialog) {\n     @Override\n     protected void onResume() {\n         super.onResume();\n-        if (checkXposedInstaller) {\n-            checkXposedInstaller = false;\n+        if (checkXposedInstaller.compareAndSet(true, false)) {\n             installXposed();\n         }\n         // check for update",
      "parent_sha": "4828d24ab7563bf9d189dfa82bb834af10e7cbdb"
    }
  },
  {
    "oid": "57e2be2376d571a6fd880b7990ea5237c4234616",
    "message": "Fix ParceledListSlice type detect(and null check)",
    "date": "2017-02-18T02:32:41Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/57e2be2376d571a6fd880b7990ea5237c4234616",
    "details": {
      "sha": "1edc112f859a95a954e799e2e7f5dcba5c23536e",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/hook/patchs/am/ActivityManagerPatch.java",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/57e2be2376d571a6fd880b7990ea5237c4234616/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fam%2FActivityManagerPatch.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/57e2be2376d571a6fd880b7990ea5237c4234616/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fam%2FActivityManagerPatch.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fam%2FActivityManagerPatch.java?ref=57e2be2376d571a6fd880b7990ea5237c4234616",
      "patch": "@@ -103,7 +103,7 @@ public Object call(Object who, Method method, Object... args) throws Throwable {\n \t\t\t\t\t//noinspection unchecked\n \t\t\t\t\tObject _infos = method.invoke(who, args);\n \t\t\t\t\tList<ActivityManager.RecentTaskInfo> infos =\n-\t\t\t\t\t\t\tParceledListSlice.TYPE.isInstance(_infos)\n+\t\t\t\t\t\t\tParceledListSlice.TYPE != null && ParceledListSlice.TYPE.isInstance(_infos)\n \t\t\t\t\t\t\t\t\t? ParceledListSlice.getList.call(_infos)\n \t\t\t\t\t\t\t\t\t: (List)_infos;\n \t\t\t\t\tfor (ActivityManager.RecentTaskInfo info : infos) {",
      "parent_sha": "cc4d3c6b0e8e1f09ab382106299b74c483537c59"
    }
  },
  {
    "oid": "f3d5e7187e304565833d6f5398d2f41748ba066a",
    "message": "[Exposed-UI] fix crash cause by fragment unattached.",
    "date": "2018-06-06T06:11:30Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/f3d5e7187e304565833d6f5398d2f41748ba066a",
    "details": {
      "sha": "d4dd53bf53673c41fb920e06d70686caaf76885a",
      "filename": "VirtualApp/app/src/main/java/io/virtualapp/home/ListAppFragment.java",
      "status": "modified",
      "additions": 2,
      "deletions": 1,
      "changes": 3,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/f3d5e7187e304565833d6f5398d2f41748ba066a/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2FListAppFragment.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/f3d5e7187e304565833d6f5398d2f41748ba066a/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2FListAppFragment.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2FListAppFragment.java?ref=f3d5e7187e304565833d6f5398d2f41748ba066a",
      "patch": "@@ -19,6 +19,7 @@\n import java.util.Locale;\n \n import io.virtualapp.R;\n+import io.virtualapp.VApp;\n import io.virtualapp.VCommends;\n import io.virtualapp.abs.ui.VFragment;\n import io.virtualapp.abs.ui.VUiKit;\n@@ -99,7 +100,7 @@ public boolean isSelectable(int position) {\n         });\n         mAdapter.setSelectionListener(count -> {\n             mInstallButton.setEnabled(count > 0);\n-            mInstallButton.setText(String.format(Locale.ENGLISH, getResources().getString(R.string.install_d), count));\n+            mInstallButton.setText(String.format(Locale.ENGLISH, VApp.getApp().getResources().getString(R.string.install_d), count));\n         });\n         mInstallButton.setOnClickListener(v -> {\n             Integer[] selectedIndices = mAdapter.getSelectedIndices();",
      "parent_sha": "d87253d929b0269b7ea9d4d91f2967a89dea2a28"
    }
  },
  {
    "oid": "8b9d7e09163752320ae4f437db282ecb384bacea",
    "message": "Try Fix: issue #200(-2-).",
    "date": "2017-02-05T11:00:29Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/8b9d7e09163752320ae4f437db282ecb384bacea",
    "details": {
      "sha": "49ca9a480c36d0d82d5698cf40cfdccdaa6cbb78",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/helper/utils/ComponentUtils.java",
      "status": "modified",
      "additions": 94,
      "deletions": 95,
      "changes": 189,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/8b9d7e09163752320ae4f437db282ecb384bacea/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fhelper%2Futils%2FComponentUtils.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/8b9d7e09163752320ae4f437db282ecb384bacea/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fhelper%2Futils%2FComponentUtils.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fhelper%2Futils%2FComponentUtils.java?ref=8b9d7e09163752320ae4f437db282ecb384bacea",
      "patch": "@@ -6,7 +6,6 @@\n import android.content.pm.ApplicationInfo;\n import android.content.pm.ComponentInfo;\n import android.content.pm.PackageInfo;\n-import android.os.Build;\n \n import com.lody.virtual.client.core.VirtualCore;\n import com.lody.virtual.client.env.SpecialComponentList;\n@@ -16,121 +15,121 @@\n \n /**\n  * @author Lody\n- *\n  */\n public class ComponentUtils {\n \n-\tpublic static String getTaskAffinity(ActivityInfo info) {\n-\t\tif (info.launchMode == LAUNCH_SINGLE_INSTANCE) {\n-\t\t\treturn \"_#SI#_\" + info.packageName + \"/\" + info.name;\n-\t\t} else if (info.taskAffinity == null && info.applicationInfo.taskAffinity == null) {\n-\t\t\treturn info.packageName;\n-\t\t} else if (info.taskAffinity != null) {\n-\t\t\treturn info.taskAffinity;\n-\t\t}\n-\t\treturn info.applicationInfo.taskAffinity;\n-\t}\n+    public static String getTaskAffinity(ActivityInfo info) {\n+        if (info.launchMode == LAUNCH_SINGLE_INSTANCE) {\n+            return \"_#SI#_\" + info.packageName + \"/\" + info.name;\n+        } else if (info.taskAffinity == null && info.applicationInfo.taskAffinity == null) {\n+            return info.packageName;\n+        } else if (info.taskAffinity != null) {\n+            return info.taskAffinity;\n+        }\n+        return info.applicationInfo.taskAffinity;\n+    }\n \n-\tpublic static boolean isSameIntent(Intent a, Intent b) {\n-\t\tif (a != null && b != null) {\n-\t\t\tif (!ObjectsCompat.equals(a.getAction(), b.getAction())) {\n-\t\t\t\treturn false;\n-\t\t\t}\n-\t\t\tif (!ObjectsCompat.equals(a.getData(), b.getData())) {\n-\t\t\t\treturn false;\n-\t\t\t}\n-\t\t\tif (!ObjectsCompat.equals(a.getType(), b.getType())) {\n-\t\t\t\treturn false;\n-\t\t\t}\n-\t\t\tObject pkgA = a.getPackage();\n-\t\t\tif (pkgA == null && a.getComponent() != null) {\n-\t\t\t\tpkgA = a.getComponent().getPackageName();\n-\t\t\t}\n-\t\t\tString pkgB = b.getPackage();\n-\t\t\tif (pkgB == null && b.getComponent() != null) {\n-\t\t\t\tpkgB = b.getComponent().getPackageName();\n-\t\t\t}\n-\t\t\tif (!ObjectsCompat.equals(pkgA, pkgB)) {\n-\t\t\t\treturn false;\n-\t\t\t}\n-\t\t\tif (!ObjectsCompat.equals(a.getComponent(), b.getComponent())) {\n-\t\t\t\treturn false;\n-\t\t\t}\n-\t\t\tif (!ObjectsCompat.equals(a.getCategories(), b.getCategories())) {\n-\t\t\t\treturn false;\n-\t\t\t}\n-\t\t}\n-\t\treturn true;\n-\t}\n+    public static boolean isSameIntent(Intent a, Intent b) {\n+        if (a != null && b != null) {\n+            if (!ObjectsCompat.equals(a.getAction(), b.getAction())) {\n+                return false;\n+            }\n+            if (!ObjectsCompat.equals(a.getData(), b.getData())) {\n+                return false;\n+            }\n+            if (!ObjectsCompat.equals(a.getType(), b.getType())) {\n+                return false;\n+            }\n+            Object pkgA = a.getPackage();\n+            if (pkgA == null && a.getComponent() != null) {\n+                pkgA = a.getComponent().getPackageName();\n+            }\n+            String pkgB = b.getPackage();\n+            if (pkgB == null && b.getComponent() != null) {\n+                pkgB = b.getComponent().getPackageName();\n+            }\n+            if (!ObjectsCompat.equals(pkgA, pkgB)) {\n+                return false;\n+            }\n+            if (!ObjectsCompat.equals(a.getComponent(), b.getComponent())) {\n+                return false;\n+            }\n+            if (!ObjectsCompat.equals(a.getCategories(), b.getCategories())) {\n+                return false;\n+            }\n+        }\n+        return true;\n+    }\n \n-\tpublic static String getProcessName(ComponentInfo componentInfo) {\n-\t\tString processName = componentInfo.processName;\n-\t\tif (processName == null) {\n-\t\t\tprocessName = componentInfo.packageName;\n-\t\t\tcomponentInfo.processName = processName;\n-\t\t}\n-\t\treturn processName;\n-\t}\n+    public static String getProcessName(ComponentInfo componentInfo) {\n+        String processName = componentInfo.processName;\n+        if (processName == null) {\n+            processName = componentInfo.packageName;\n+            componentInfo.processName = processName;\n+        }\n+        return processName;\n+    }\n \n-\tpublic static boolean isSameComponent(ComponentInfo first, ComponentInfo second) {\n+    public static boolean isSameComponent(ComponentInfo first, ComponentInfo second) {\n \n-\t\tif (first != null && second != null) {\n-\t\t\tString pkg1 = first.packageName + \"\";\n-\t\t\tString pkg2 = second.packageName + \"\";\n-\t\t\tString name1 = first.name + \"\";\n-\t\t\tString name2 = second.name + \"\";\n-\t\t\treturn pkg1.equals(pkg2) && name1.equals(name2);\n-\t\t}\n-\t\treturn false;\n-\t}\n+        if (first != null && second != null) {\n+            String pkg1 = first.packageName + \"\";\n+            String pkg2 = second.packageName + \"\";\n+            String name1 = first.name + \"\";\n+            String name2 = second.name + \"\";\n+            return pkg1.equals(pkg2) && name1.equals(name2);\n+        }\n+        return false;\n+    }\n \n-\tpublic static ComponentName toComponentName(ComponentInfo componentInfo) {\n-\t\treturn new ComponentName(componentInfo.packageName, componentInfo.name);\n-\t}\n+    public static ComponentName toComponentName(ComponentInfo componentInfo) {\n+        return new ComponentName(componentInfo.packageName, componentInfo.name);\n+    }\n \n-\tpublic static boolean isSystemApp(PackageInfo packageInfo) {\n-\t\treturn packageInfo != null && packageInfo.applicationInfo != null\n-\t\t\t\t&& (ApplicationInfo.FLAG_SYSTEM & packageInfo.applicationInfo.flags) != 0;\n-\t}\n+    public static boolean isSystemApp(PackageInfo packageInfo) {\n+        return packageInfo != null && isSystemApp(packageInfo.applicationInfo);\n+    }\n \n-\tpublic static boolean isSystemApp(ApplicationInfo applicationInfo) {\n-\t\treturn applicationInfo != null && (ApplicationInfo.FLAG_SYSTEM & applicationInfo.flags) != 0;\n-\t}\n+    public static boolean isSystemApp(ApplicationInfo applicationInfo) {\n+        return applicationInfo != null\n+                && ((ApplicationInfo.FLAG_SYSTEM & applicationInfo.flags) != 0\n+                || \"com.google.android.webview\".equals(applicationInfo.packageName));\n+    }\n \n \n-\tpublic static boolean isStubComponent(Intent intent) {\n-\t\treturn intent != null\n-\t\t\t\t&& intent.getComponent() != null\n-\t\t\t\t&& VirtualCore.get().getHostPkg().equals(intent.getComponent().getPackageName());\n-\t}\n+    public static boolean isStubComponent(Intent intent) {\n+        return intent != null\n+                && intent.getComponent() != null\n+                && VirtualCore.get().getHostPkg().equals(intent.getComponent().getPackageName());\n+    }\n \n-\tpublic static Intent redirectBroadcastIntent(Intent intent, int userId) {\n+    public static Intent redirectBroadcastIntent(Intent intent, int userId) {\n         Intent newIntent = intent.cloneFilter();\n-\t\tnewIntent.setComponent(null);\n-\t\tnewIntent.setPackage(null);\n-\t\tComponentName component = intent.getComponent();\n-\t\tString pkg = intent.getPackage();\n-\t\tif (component != null) {\n-\t\t\tnewIntent.putExtra(\"_VA_|_user_id_\", userId);\n-\t\t\tnewIntent.setAction(String.format(\"_VA_%s_%s\", component.getPackageName(), component.getClassName()));\n-\t\t\tnewIntent.putExtra(\"_VA_|_component_\", component);\n-\t\t\tnewIntent.putExtra(\"_VA_|_intent_\", new Intent(intent));\n-\t\t} else if (pkg != null) {\n-\t\t\tnewIntent.putExtra(\"_VA_|_user_id_\", userId);\n-\t\t\tnewIntent.putExtra(\"_VA_|_creator_\", pkg);\n-\t\t\tnewIntent.putExtra(\"_VA_|_intent_\", new Intent(intent));\n+        newIntent.setComponent(null);\n+        newIntent.setPackage(null);\n+        ComponentName component = intent.getComponent();\n+        String pkg = intent.getPackage();\n+        if (component != null) {\n+            newIntent.putExtra(\"_VA_|_user_id_\", userId);\n+            newIntent.setAction(String.format(\"_VA_%s_%s\", component.getPackageName(), component.getClassName()));\n+            newIntent.putExtra(\"_VA_|_component_\", component);\n+            newIntent.putExtra(\"_VA_|_intent_\", new Intent(intent));\n+        } else if (pkg != null) {\n+            newIntent.putExtra(\"_VA_|_user_id_\", userId);\n+            newIntent.putExtra(\"_VA_|_creator_\", pkg);\n+            newIntent.putExtra(\"_VA_|_intent_\", new Intent(intent));\n             String protectedAction = SpecialComponentList.protectAction(intent.getAction());\n             if (protectedAction != null) {\n                 newIntent.setAction(protectedAction);\n             }\n-\t\t} else {\n-\t\t\tnewIntent.putExtra(\"_VA_|_user_id_\", userId);\n-\t\t\tnewIntent.putExtra(\"_VA_|_intent_\", new Intent(intent));\n+        } else {\n+            newIntent.putExtra(\"_VA_|_user_id_\", userId);\n+            newIntent.putExtra(\"_VA_|_intent_\", new Intent(intent));\n             String protectedAction = SpecialComponentList.protectAction(intent.getAction());\n             if (protectedAction != null) {\n                 newIntent.setAction(protectedAction);\n             }\n-\t\t}\n+        }\n         return newIntent;\n-\t}\n+    }\n }",
      "parent_sha": "ba4e7df9f4264f2d046190cd64c4ceda4f2c614f"
    }
  },
  {
    "oid": "745618a14d965d616398a071e998d1fba1b8b7f4",
    "message": "\u4f7f\u7528ActivityManagerCompat.finishActivity\uff0c\u89e3\u51b3\u57287.0\u7cfb\u7edf\u4e0a\u7684\u5d29\u6e83\u95ee\u9898",
    "date": "2016-11-21T16:13:46Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/745618a14d965d616398a071e998d1fba1b8b7f4",
    "details": {
      "sha": "fb86c6b40b3f86a72b8724dbb6c99d06238953d6",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/ipc/VActivityManager.java",
      "status": "modified",
      "additions": 1,
      "deletions": 20,
      "changes": 21,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/745618a14d965d616398a071e998d1fba1b8b7f4/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fipc%2FVActivityManager.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/745618a14d965d616398a071e998d1fba1b8b7f4/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fipc%2FVActivityManager.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fipc%2FVActivityManager.java?ref=745618a14d965d616398a071e998d1fba1b8b7f4",
      "patch": "@@ -7,7 +7,6 @@\n import android.content.Intent;\n import android.content.pm.ActivityInfo;\n import android.content.pm.ProviderInfo;\n-import android.os.Build;\n import android.os.Bundle;\n import android.os.IBinder;\n import android.os.IInterface;\n@@ -28,10 +27,7 @@\n import java.util.List;\n import java.util.Map;\n \n-import mirror.android.app.ActivityManagerNative;\n import mirror.android.app.ActivityThread;\n-import mirror.android.app.IActivityManagerICS;\n-import mirror.android.app.IActivityManagerL;\n import mirror.android.content.ContentProviderNative;\n \n /**\n@@ -411,22 +407,7 @@ public void finishActivity(IBinder token) {\n \t\t\tif (!mirror.android.app.Activity.mFinished.get(activity)) {\n \t\t\t\tint resultCode = mirror.android.app.Activity.mResultCode.get(activity);\n \t\t\t\tIntent resultData = mirror.android.app.Activity.mResultData.get(activity);\n-\t\t\t\tif (Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {\n-\t\t\t\t\tIActivityManagerL.finishActivity.call(\n-\t\t\t\t\t\t\tActivityManagerNative.getDefault.call(),\n-\t\t\t\t\t\t\ttoken,\n-\t\t\t\t\t\t\tresultCode,\n-\t\t\t\t\t\t\tresultData,\n-\t\t\t\t\t\t\tfalse\n-\t\t\t\t\t);\n-\t\t\t\t} else {\n-\t\t\t\t\tIActivityManagerICS.finishActivity.call(\n-\t\t\t\t\t\t\tActivityManagerNative.getDefault.call(),\n-\t\t\t\t\t\t\ttoken,\n-\t\t\t\t\t\t\tresultCode,\n-\t\t\t\t\t\t\tresultData\n-\t\t\t\t\t);\n-\t\t\t\t}\n+\t\t\t\tActivityManagerCompat.finishActivity(token, resultCode, resultData);\n \t\t\t\tmirror.android.app.Activity.mFinished.set(activity, true);\n \t\t\t}\n \t\t}",
      "parent_sha": "d5273b75a5d39217ee7eec88c7dd399b8bea72d3"
    }
  },
  {
    "oid": "a11f1564e45000c4636c0a4f706dd0495e14893e",
    "message": "Adopt for Google login.",
    "date": "2016-08-08T09:43:17Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/a11f1564e45000c4636c0a4f706dd0495e14893e",
    "details": {
      "sha": "02c76b13c858b26bf6b595705702b50203dda9ec",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/hook/patchs/pm/Hook_GetPackagesForUid.java",
      "status": "modified",
      "additions": 8,
      "deletions": 1,
      "changes": 9,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/a11f1564e45000c4636c0a4f706dd0495e14893e/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fpm%2FHook_GetPackagesForUid.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/a11f1564e45000c4636c0a4f706dd0495e14893e/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fpm%2FHook_GetPackagesForUid.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fpm%2FHook_GetPackagesForUid.java?ref=a11f1564e45000c4636c0a4f706dd0495e14893e",
      "patch": "@@ -3,7 +3,9 @@\n import android.os.Process;\n \n import com.lody.virtual.client.VClientImpl;\n+import com.lody.virtual.client.core.VirtualCore;\n import com.lody.virtual.client.hook.base.Hook;\n+import com.lody.virtual.helper.proto.AppInfo;\n \n import java.lang.reflect.Method;\n import java.util.ArrayList;\n@@ -33,8 +35,13 @@ public Object onHook(Object who, Method method, Object... args) throws Throwable\n \t\tVClientImpl client = VClientImpl.getClient();\n \t\tList<String> sharedPackages = client.getSharedPackages();\n \t\tList<String> packages = new ArrayList<>(sharedPackages.size() + 1);\n-\t\tpackages.add(client.geInitialPackage());\n+\t\tString initialPackage = client.geInitialPackage();\n+\t\tpackages.add(initialPackage);\n \t\tpackages.addAll(sharedPackages);\n+\t\tList<AppInfo> appInfos = VirtualCore.getCore().getAllApps();\n+\t\tfor (AppInfo appInfo : appInfos) {\n+\t\t\tpackages.add(appInfo.packageName);\n+\t\t}\n \t\treturn packages.toArray(new String[packages.size()]);\n \t}\n ",
      "parent_sha": "b157f8d9c707db86e734f5d150416c8df5b95006"
    }
  },
  {
    "oid": "2d73beb995013152c4f44be31dabbee26f667834",
    "message": "\u89e3\u51b3\u9996\u9875\u6ed1\u52a8\u5361\u987f\u95ee\u9898",
    "date": "2016-09-03T06:49:46Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/2d73beb995013152c4f44be31dabbee26f667834",
    "details": {
      "sha": "bd9794d4e97bc1840eeaf274f1db09570084fd75",
      "filename": "VirtualApp/app/src/main/java/io/virtualapp/widgets/PagerView.java",
      "status": "modified",
      "additions": 17,
      "deletions": 13,
      "changes": 30,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/2d73beb995013152c4f44be31dabbee26f667834/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fwidgets%2FPagerView.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/2d73beb995013152c4f44be31dabbee26f667834/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fwidgets%2FPagerView.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fwidgets%2FPagerView.java?ref=2d73beb995013152c4f44be31dabbee26f667834",
      "patch": "@@ -282,19 +282,23 @@ public boolean dispatchTouchEvent(MotionEvent ev) {\n \t\t\tcase MotionEvent.ACTION_MOVE :\n \t\t\t\tint deltaX = (int) (mLastMotionX - x);\n \n-\t\t\t\tif (IsCanMove(deltaX) && Math.abs(deltaX) > thresholdX && mode != MODE_DRAG) {\n-\t\t\t\t\tmLastMotionX = x;\n-\t\t\t\t\tscrollBy(deltaX, 0);\n-\t\t\t\t\tmode = MODE_SCROLL;\n-\t\t\t\t} else if (mode == MODE_DRAG) {\n-\n-\t\t\t\t} else {\n-\t\t\t\t\tmode = MODE_FREE;\n-\t\t\t\t}\n-\n-\t\t\t\tif (mode == MODE_DRAG) {\n-\t\t\t\t\tonDrag((int) x, (int) y);\n-\t\t\t\t}\n+                if (IsCanMove(deltaX) && Math.abs(deltaX) > thresholdX && mode != MODE_DRAG && mode != MODE_SCROLL) {\n+                    mLastMotionX = x;\n+                    scrollBy(deltaX, 0);\n+                    mode = MODE_SCROLL;\n+                } else if (mode == MODE_SCROLL) {\n+                    mLastMotionX = x;\n+                    scrollBy(deltaX, 0);\n+                    mode = MODE_SCROLL;\n+                } else if (mode == MODE_DRAG) {\n+\n+                } else {\n+                    mode = MODE_FREE;\n+                }\n+\n+                if (mode == MODE_DRAG) {\n+                    onDrag((int) x, (int) y);\n+                }\n \t\t\t\tbreak;\n \t\t\tcase MotionEvent.ACTION_UP :\n \t\t\t\tfloat distance = ev.getRawX() - startX;",
      "parent_sha": "999464f349db772eb50a067ef6980e9a8488e9e0"
    }
  },
  {
    "oid": "f9c5425e0d5ce714a32f24f1d78897f6423507ab",
    "message": "[Exposed-core] Xposed log support.",
    "date": "2018-06-06T06:11:29Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/f9c5425e0d5ce714a32f24f1d78897f6423507ab",
    "details": {
      "sha": "b542b8ae38d53d60e14c4942177650e6c0965401",
      "filename": "VirtualApp/app/src/main/java/io/virtualapp/VApp.java",
      "status": "modified",
      "additions": 7,
      "deletions": 2,
      "changes": 9,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/f9c5425e0d5ce714a32f24f1d78897f6423507ab/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2FVApp.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/f9c5425e0d5ce714a32f24f1d78897f6423507ab/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2FVApp.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2FVApp.java?ref=f9c5425e0d5ce714a32f24f1d78897f6423507ab",
      "patch": "@@ -10,6 +10,7 @@\n import com.lody.virtual.client.core.VirtualCore;\n import com.lody.virtual.client.stub.VASettings;\n import com.lody.virtual.helper.utils.FileUtils;\n+import com.lody.virtual.os.VEnvironment;\n \n import java.io.File;\n import java.io.FileOutputStream;\n@@ -22,12 +23,15 @@\n import io.virtualapp.delegate.MyTaskDescriptionDelegate;\n import io.virtualapp.update.VAVersionService;\n import jonathanfinerty.once.Once;\n+import me.weishu.exposed.LogcatService;\n \n /**\n  * @author Lody\n  */\n public class VApp extends MultiDexApplication {\n \n+    private static final String XPOSED_INSTALLER_PACKAGE = \"de.robv.android.xposed.installer\";\n+\n     private static VApp gApp;\n     private SharedPreferences mPreferences;\n \n@@ -64,9 +68,8 @@ public void onMainProcess() {\n                             // nothing\n                         })\n                         .build(VApp.this, \"48RJJP7ZCZZBB6KMMWW5\");\n-                final String xposedPackageName = \"de.robv.android.xposed.installer\";\n \n-                boolean isXposedInstalled = VirtualCore.get().isAppInstalled(xposedPackageName);\n+                boolean isXposedInstalled = VirtualCore.get().isAppInstalled(XPOSED_INSTALLER_PACKAGE);\n                 if (!isXposedInstalled) {\n                     File xposedInstallerApk = getFileStreamPath(\"XposedInstaller.apk\");\n                     if (!xposedInstallerApk.exists()) {\n@@ -106,6 +109,8 @@ public void onVirtualProcess() {\n                 virtualCore.setPhoneInfoDelegate(new MyPhoneInfoDelegate());\n                 //fake task description's icon and title\n                 virtualCore.setTaskDescriptionDelegate(new MyTaskDescriptionDelegate());\n+                // ensure the logcat service alive when every virtual process start.\n+                LogcatService.start(VApp.this, VEnvironment.getDataUserPackageDirectory(0, XPOSED_INSTALLER_PACKAGE));\n             }\n \n             @Override",
      "parent_sha": "0b05c604d887ad08e0e992e3339ef444ecc2af5d"
    }
  },
  {
    "oid": "e568d30f552bdc5e5e7f27e722973a3f57f898a3",
    "message": "[Exposed-UI] remove gmc support, it may conflict with xposed.",
    "date": "2018-06-06T06:11:30Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/e568d30f552bdc5e5e7f27e722973a3f57f898a3",
    "details": {
      "sha": "fce3444b622a0601dc1ae2bfda738785e65dd625",
      "filename": "VirtualApp/app/src/main/java/io/virtualapp/home/HomePresenterImpl.java",
      "status": "modified",
      "additions": 3,
      "deletions": 2,
      "changes": 5,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/e568d30f552bdc5e5e7f27e722973a3f57f898a3/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2FHomePresenterImpl.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/e568d30f552bdc5e5e7f27e722973a3f57f898a3/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2FHomePresenterImpl.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2FHomePresenterImpl.java?ref=e568d30f552bdc5e5e7f27e722973a3f57f898a3",
      "patch": "@@ -4,7 +4,6 @@\n import android.content.pm.PackageInfo;\n import android.graphics.Bitmap;\n \n-import com.lody.virtual.GmsSupport;\n import com.lody.virtual.client.core.VirtualCore;\n import com.lody.virtual.os.VUserInfo;\n import com.lody.virtual.os.VUserManager;\n@@ -49,10 +48,12 @@ public void start() {\n             mView.showGuide();\n             Once.markDone(VCommends.TAG_SHOW_ADD_APP_GUIDE);\n         }\n+        /*\n+        Delete GMS Support, becuase it may conflict with xposed.\n         if (!Once.beenDone(VCommends.TAG_ASK_INSTALL_GMS) && GmsSupport.isOutsideGoogleFrameworkExist()) {\n             mView.askInstallGms();\n             Once.markDone(VCommends.TAG_ASK_INSTALL_GMS);\n-        }\n+        }*/\n     }\n \n     @Override",
      "parent_sha": "b73f887aec949e4e30cbf3aa0d4410d7b9182535"
    }
  },
  {
    "oid": "b406ca3601aae8c66af536fd263e3e4428e1fb65",
    "message": "When listing apps on SD card, handle File.listFiles() == null\n\nThis is caused by a lack of \"SD Acess\" permission, which must be manually enabled by the user on Android L",
    "date": "2017-01-06T12:47:51Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/b406ca3601aae8c66af536fd263e3e4428e1fb65",
    "details": {
      "sha": "24ab48253230d8f6484574fe7e579ebe15e5dc91",
      "filename": "VirtualApp/app/src/main/java/io/virtualapp/home/models/AppRepository.java",
      "status": "modified",
      "additions": 6,
      "deletions": 6,
      "changes": 12,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/b406ca3601aae8c66af536fd263e3e4428e1fb65/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2Fmodels%2FAppRepository.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/b406ca3601aae8c66af536fd263e3e4428e1fb65/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2Fmodels%2FAppRepository.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2Fmodels%2FAppRepository.java?ref=b406ca3601aae8c66af536fd263e3e4428e1fb65",
      "patch": "@@ -81,15 +81,15 @@ public Promise<List<AppModel>, Throwable, Void> getSdCardApps(Context context) {\n \t\t});\n \t}\n \n-\tprivate List<PackageInfo> findAndParseAPKs(Context context, List<String> pathes) {\n+\tprivate List<PackageInfo> findAndParseAPKs(Context context, List<String> paths) {\n \t\tList<PackageInfo> pkgs = new ArrayList<>();\n-\t\tif (pathes == null)\n+\t\tif (paths == null)\n \t\t\treturn pkgs;\n-\t\tfor (String path : pathes) {\n-\t\t\tFile dir = new File(path);\n-\t\t\tif (!dir.exists() || !dir.isDirectory())\n+\t\tfor (String path : paths) {\n+\t\t\tFile[] dirFiles = new File(path).listFiles();\n+\t\t\tif (dirFiles == null)\n \t\t\t\tcontinue;\n-\t\t\tfor (File f : dir.listFiles()) {\n+\t\t\tfor (File f : dirFiles) {\n \t\t\t\tif (!f.getName().toLowerCase().endsWith(\".apk\"))\n \t\t\t\t\tcontinue;\n \t\t\t\tPackageInfo pkgInfo = null;",
      "parent_sha": "2162934d779b3cce8abdbfd81ad805cf629c21ee"
    }
  },
  {
    "oid": "81f84f8bb56f901d12585604638ec043684d876f",
    "message": "Fix: some bugs on Google nexus devices.",
    "date": "2016-07-26T07:13:22Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/81f84f8bb56f901d12585604638ec043684d876f",
    "details": {
      "sha": "2b0ca23089628b79cac26dc9ec973589c988e1b4",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/core/VirtualCore.java",
      "status": "modified",
      "additions": 3,
      "deletions": 6,
      "changes": 9,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/81f84f8bb56f901d12585604638ec043684d876f/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fcore%2FVirtualCore.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/81f84f8bb56f901d12585604638ec043684d876f/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fcore%2FVirtualCore.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fcore%2FVirtualCore.java?ref=81f84f8bb56f901d12585604638ec043684d876f",
      "patch": "@@ -21,6 +21,7 @@\n \n import com.lody.virtual.client.env.Constants;\n import com.lody.virtual.client.env.RuntimeEnv;\n+import com.lody.virtual.client.local.LocalPackageManager;\n import com.lody.virtual.client.local.LocalProcessManager;\n import com.lody.virtual.client.service.ServiceManagerNative;\n import com.lody.virtual.helper.ExtraConstants;\n@@ -347,7 +348,7 @@ public boolean isHostPackageName(String pkgName) {\n \tpublic synchronized ActivityInfo resolveActivityInfo(Intent intent) {\n \t\tActivityInfo activityInfo = null;\n \t\tif (intent.getComponent() == null) {\n-\t\t\tResolveInfo resolveInfo = getPM().resolveActivity(intent, 0);\n+\t\t\tResolveInfo resolveInfo = LocalPackageManager.getInstance().resolveIntent(intent, intent.getType(), 0);\n \t\t\tif (resolveInfo != null && resolveInfo.activityInfo != null) {\n \t\t\t\tactivityInfo = resolveInfo.activityInfo;\n \t\t\t\tintent.setClassName(activityInfo.packageName, activityInfo.name);\n@@ -362,14 +363,10 @@ public synchronized ActivityInfo resolveActivityInfo(Intent intent) {\n \tpublic synchronized ActivityInfo resolveActivityInfo(ComponentName componentName) {\n \t\tActivityInfo activityInfo = activityInfoCache.get(componentName);\n \t\tif (activityInfo == null) {\n-\t\t\ttry {\n-\t\t\t\tactivityInfo = getPM().getActivityInfo(componentName, 0);\n+\t\t\t\tactivityInfo = LocalPackageManager.getInstance().getActivityInfo(componentName, 0);\n \t\t\t\tif (activityInfo != null) {\n \t\t\t\t\tactivityInfoCache.put(componentName, activityInfo);\n \t\t\t\t}\n-\t\t\t} catch (PackageManager.NameNotFoundException e) {\n-\t\t\t\t// Ignore\n-\t\t\t}\n \t\t}\n \t\treturn activityInfo;\n \t}",
      "parent_sha": "9c3feb69dbea81218afeff92997fb36d250e8da8"
    }
  },
  {
    "oid": "73ded6db2a3bf1920faf305a0c6a479b47aa1988",
    "message": "Merge pull request #157 from diigu/multiuser_support\n\nadd multi user support for CmeReceiver",
    "date": "2018-06-06T06:23:40Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/73ded6db2a3bf1920faf305a0c6a479b47aa1988",
    "details": {
      "sha": "fc704a8aef22fce685a2e400b1a38f5a1784652b",
      "filename": "VirtualApp/app/src/main/java/io/virtualapp/dev/CmdReceiver.java",
      "status": "modified",
      "additions": 13,
      "deletions": 1,
      "changes": 14,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/73ded6db2a3bf1920faf305a0c6a479b47aa1988/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fdev%2FCmdReceiver.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/73ded6db2a3bf1920faf305a0c6a479b47aa1988/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fdev%2FCmdReceiver.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fdev%2FCmdReceiver.java?ref=73ded6db2a3bf1920faf305a0c6a479b47aa1988",
      "patch": "@@ -23,6 +23,7 @@ public class CmdReceiver extends BroadcastReceiver {\n     private static final String ACTION = \"io.va.exposed.CMD\";\n     private static final String KEY_CMD = \"cmd\";\n     private static final String KEY_PKG = \"pkg\";\n+    private static final String KEY_UID = \"uid\";\n \n     private static final String CMD_UPDATE = \"update\";\n     private static final String CMD_REBOOT = \"reboot\";\n@@ -80,7 +81,18 @@ public void onReceive(Context context, Intent intent) {\n                 showTips(context, \"Please tell me the launch package!!\");\n                 return;\n             }\n-            LoadingActivity.launch(context, pkg, 0);\n+            String uid = intent.getStringExtra(KEY_UID);\n+            int userId = 0;\n+            if (!TextUtils.isEmpty(uid)){\n+                try {\n+                    userId = Integer.parseInt(uid);\n+                }catch (NumberFormatException e){\n+                    e.printStackTrace();\n+                }\n+            }\n+            LoadingActivity.launch(context, pkg, userId);\n+\n+\n         }\n     }\n ",
      "parent_sha": "d274adca83c8d97c5fad3ef422b6bf883ec674c7"
    }
  },
  {
    "oid": "efe2a8388e1e1cd1f73eea627121c0017fe7e1ee",
    "message": "Feature: Implement SharedUserId TAG.",
    "date": "2016-08-08T04:35:23Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/efe2a8388e1e1cd1f73eea627121c0017fe7e1ee",
    "details": {
      "sha": "b05197a40f552c81e5ca3f214007b3dcdb2ae80b",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/VClientImpl.java",
      "status": "modified",
      "additions": 16,
      "deletions": 2,
      "changes": 18,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/efe2a8388e1e1cd1f73eea627121c0017fe7e1ee/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2FVClientImpl.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/efe2a8388e1e1cd1f73eea627121c0017fe7e1ee/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2FVClientImpl.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2FVClientImpl.java?ref=efe2a8388e1e1cd1f73eea627121c0017fe7e1ee",
      "patch": "@@ -29,10 +29,11 @@\n import com.lody.virtual.helper.proto.AppInfo;\n import com.lody.virtual.helper.proto.ReceiverInfo;\n import com.lody.virtual.helper.utils.Reflect;\n-import com.lody.virtual.helper.utils.VLog;\n \n import java.util.ArrayList;\n+import java.util.HashMap;\n import java.util.List;\n+import java.util.Map;\n \n import static com.lody.virtual.helper.utils.Reflect.on;\n \n@@ -108,13 +109,26 @@ public void handleMessage(Message msg) {\n \t\t}\n \t}\n \n+\t/**\n+\t * Avoid the GC.\n+\t */\n+\tprivate final Map<String, LoadedApk> strongRefPackages = new HashMap<>();\n+\n \tprivate void handleBindApplication(AppBindData data) {\n \t\tContextFixer.fixCamera();\n \t\tmBoundApplication = data;\n+\t\tVirtualCore core = VirtualCore.getCore();\n \t\tActivityThread mainThread = VirtualCore.mainThread();\n-\t\tAppInfo appInfo = VirtualCore.getCore().findApp(data.appInfo.packageName);\n+\t\tAppInfo appInfo = core.findApp(data.appInfo.packageName);\n \t\tmBoundApplication.info = mainThread.getPackageInfoNoCheck(data.appInfo,\n \t\t\t\tCompatibilityInfo.DEFAULT_COMPATIBILITY_INFO);\n+\t\tfor (String shared : data.sharedPackages) {\n+\t\t\tAppInfo sharedInfo = core.findApp(shared);\n+\t\t\tLoadedApk loadedApk =  mainThread.getPackageInfoNoCheck(sharedInfo.getApplicationInfo(),\n+\t\t\t\t\tCompatibilityInfo.DEFAULT_COMPATIBILITY_INFO);\n+\t\t\tfixLoadedApk(loadedApk, sharedInfo);\n+\t\t\tstrongRefPackages.put(shared, loadedApk);\n+\t\t}\n \t\tfixLoadedApk(mBoundApplication.info, appInfo);\n \t\tApplication app = data.info.makeApplication(false, null);\n \t\tContextFixer.fixContext(app);",
      "parent_sha": "47af5b74f138c96e0d9081a8b18938cff7d9b8ce"
    }
  },
  {
    "oid": "c7a1ed90390fe8c9bb8802ef1e5155dcf226e587",
    "message": "fix  IContentProvider.delete() parameter error after API18",
    "date": "2017-10-12T04:32:39Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/c7a1ed90390fe8c9bb8802ef1e5155dcf226e587",
    "details": {
      "sha": "a2466be9b551aa89efba6fb5d999110967fe6169",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/hook/providers/ProviderHook.java",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/c7a1ed90390fe8c9bb8802ef1e5155dcf226e587/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fproviders%2FProviderHook.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/c7a1ed90390fe8c9bb8802ef1e5155dcf226e587/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fproviders%2FProviderHook.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fproviders%2FProviderHook.java?ref=c7a1ed90390fe8c9bb8802ef1e5155dcf226e587",
      "patch": "@@ -160,7 +160,7 @@ public Object invoke(Object proxy, Method method, Object... args) throws Throwab\n             } else if (\"getType\".equals(name)) {\n                 return getType(methodBox, (Uri) args[0]);\n             } else if (\"delete\".equals(name)) {\n-                Uri url = (Uri) args[0];\n+                Uri url = (Uri) args[start];\n                 String selection = (String) args[start + 1];\n                 String[] selectionArgs = (String[]) args[start + 2];\n                 return delete(methodBox, url, selection, selectionArgs);",
      "parent_sha": "30f548208bfc9a0a50df985d1409f95684e7a4bc"
    }
  },
  {
    "oid": "8ac799c037d1b929ed8da871125c275d8f6dedcc",
    "message": "[Exposed-UI] refresh ui when package state changed to avoid reboot.",
    "date": "2018-06-06T06:11:30Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/8ac799c037d1b929ed8da871125c275d8f6dedcc",
    "details": {
      "sha": "8f4542607b0878b73527a39899cf6b8f42fee847",
      "filename": "VirtualApp/app/src/main/java/io/virtualapp/home/HomeActivity.java",
      "status": "modified",
      "additions": 29,
      "deletions": 28,
      "changes": 57,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/8ac799c037d1b929ed8da871125c275d8f6dedcc/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2FHomeActivity.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/8ac799c037d1b929ed8da871125c275d8f6dedcc/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2FHomeActivity.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2FHomeActivity.java?ref=8ac799c037d1b929ed8da871125c275d8f6dedcc",
      "patch": "@@ -10,6 +10,7 @@\n import android.os.Bundle;\n import android.os.Handler;\n import android.os.Looper;\n+import android.os.RemoteException;\n import android.support.annotation.Nullable;\n import android.support.v7.app.AlertDialog;\n import android.support.v7.widget.OrientationHelper;\n@@ -76,6 +77,27 @@ public class HomeActivity extends VActivity implements HomeContract.HomeView {\n     private LaunchpadAdapter mLaunchpadAdapter;\n     private Handler mUiHandler;\n \n+    //region ---------------package observer---------------\n+    private VirtualCore.PackageObserver mPackageObserver = new VirtualCore.PackageObserver() {\n+        @Override\n+        public void onPackageInstalled(String packageName) throws RemoteException {\n+            runOnUiThread(() -> mPresenter.dataChanged());\n+        }\n+\n+        @Override\n+        public void onPackageUninstalled(String packageName) throws RemoteException {\n+            runOnUiThread(() -> mPresenter.dataChanged());\n+        }\n+\n+        @Override\n+        public void onPackageInstalledAsUser(int userId, String packageName) throws RemoteException {\n+        }\n+\n+        @Override\n+        public void onPackageUninstalledAsUser(int userId, String packageName) throws RemoteException {\n+        }\n+    };\n+    //endregion\n \n     public static void goHome(Context context) {\n         Intent intent = new Intent(context, HomeActivity.class);\n@@ -94,40 +116,19 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {\n         initLaunchpad();\n         initMenu();\n         new HomePresenterImpl(this).start();\n+        VirtualCore.get().registerObserver(mPackageObserver);\n+    }\n+\n+    @Override\n+    protected void onDestroy() {\n+        super.onDestroy();\n+        VirtualCore.get().unregisterObserver(mPackageObserver);\n     }\n \n     private void initMenu() {\n         mPopupMenu = new PopupMenu(new ContextThemeWrapper(this, R.style.Theme_AppCompat_Light), mMenuView);\n         Menu menu = mPopupMenu.getMenu();\n         setIconEnable(menu, true);\n-//        menu.add(\"Accounts\").setIcon(R.drawable.ic_account).setOnMenuItemClickListener(item -> {\n-//            List<VUserInfo> users = VUserManager.get().getUsers();\n-//            List<String> names = new ArrayList<>(users.size());\n-//            for (VUserInfo info : users) {\n-//                names.add(info.name);\n-//            }\n-//            CharSequence[] items = new CharSequence[names.size()];\n-//            for (int i = 0; i < names.size(); i++) {\n-//                items[i] = names.get(i);\n-//            }\n-//            new AlertDialog.Builder(this)\n-//                    .setTitle(\"Please select an user\")\n-//                    .setItems(items, (dialog, which) -> {\n-//                        VUserInfo info = users.get(which);\n-//                        Intent intent = new Intent(this, ChooseTypeAndAccountActivity.class);\n-//                        intent.putExtra(ChooseTypeAndAccountActivity.KEY_USER_ID, info.id);\n-//                        startActivity(intent);\n-//                    }).show();\n-//            return false;\n-//        });\n-//        menu.add(\"Virtual Storage\").setIcon(R.drawable.ic_vs).setOnMenuItemClickListener(item -> {\n-//            Toast.makeText(this, \"The coming\", Toast.LENGTH_SHORT).show();\n-//            return false;\n-//        });\n-//        menu.add(\"Notification\").setIcon(R.drawable.ic_notification).setOnMenuItemClickListener(item -> {\n-//            Toast.makeText(this, \"The coming\", Toast.LENGTH_SHORT).show();\n-//            return false;\n-//        });\n \n         final SpannableString s = new SpannableString(getResources().getString(R.string.menu_feedback_string));\n         Linkify.addLinks(s, Linkify.ALL);",
      "parent_sha": "e568d30f552bdc5e5e7f27e722973a3f57f898a3"
    }
  },
  {
    "oid": "acf82bf404061fa6c4323aab67c44d0eaa1ee392",
    "message": "Feature: improve ability of HCallback.",
    "date": "2016-07-15T12:44:11Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/acf82bf404061fa6c4323aab67c44d0eaa1ee392",
    "details": {
      "sha": "6754bd99b2affeca529ee9e4338cd02ebcdfb4d9",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/hook/patchs/am/HCallbackHook.java",
      "status": "modified",
      "additions": 25,
      "deletions": 29,
      "changes": 54,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/acf82bf404061fa6c4323aab67c44d0eaa1ee392/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fam%2FHCallbackHook.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/acf82bf404061fa6c4323aab67c44d0eaa1ee392/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fam%2FHCallbackHook.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fam%2FHCallbackHook.java?ref=acf82bf404061fa6c4323aab67c44d0eaa1ee392",
      "patch": "@@ -1,6 +1,12 @@\n package com.lody.virtual.client.hook.patchs.am;\n \n-import java.lang.reflect.Field;\n+import android.app.ActivityThread;\n+import android.content.ComponentName;\n+import android.content.Intent;\n+import android.content.pm.ActivityInfo;\n+import android.os.Build;\n+import android.os.Handler;\n+import android.os.Message;\n \n import com.lody.virtual.client.core.VirtualCore;\n import com.lody.virtual.client.interfaces.Injectable;\n@@ -10,13 +16,7 @@\n import com.lody.virtual.helper.proto.AppInfo;\n import com.lody.virtual.helper.utils.XLog;\n \n-import android.app.ActivityThread;\n-import android.content.ComponentName;\n-import android.content.Intent;\n-import android.content.pm.ActivityInfo;\n-import android.os.Build;\n-import android.os.Handler;\n-import android.os.Message;\n+import java.lang.reflect.Field;\n \n /**\n  * @author Lody\n@@ -29,16 +29,15 @@\n  */\n public class HCallbackHook implements Handler.Callback, Injectable {\n \n-\t////////////////////////////////////////////////////////////////\n-\t////////////////// Copy from ActivityThread$H////////////////////\n-\t////////////////////////////////////////////////////////////////\n \tpublic static final int LAUNCH_ACTIVITY = 100;\n \n \tprivate static final String TAG = HCallbackHook.class.getSimpleName();\n \tprivate static final HCallbackHook sCallback = new HCallbackHook();\n \tprivate static Field f_h;\n \tprivate static Field f_handleCallback;\n \n+\tprivate boolean calling = false;\n+\n \tstatic {\n \t\ttry {\n \t\t\tf_h = ActivityThread.class.getDeclaredField(\"mH\");\n@@ -74,7 +73,6 @@ public static Handler getH() {\n \tprivate static Handler.Callback getHCallback() {\n \t\ttry {\n \t\t\tHandler handler = getH();\n-\n \t\t\treturn (Handler.Callback) f_handleCallback.get(handler);\n \t\t} catch (Throwable e) {\n \t\t\te.printStackTrace();\n@@ -84,22 +82,23 @@ private static Handler.Callback getHCallback() {\n \n \t@Override\n \tpublic boolean handleMessage(Message msg) {\n-\t\tswitch (msg.what) {\n-\t\t\tcase LAUNCH_ACTIVITY : {\n-\t\t\t\tif (!handleLaunchActivity(msg)) {\n-\t\t\t\t\treturn true;\n+\t\tif (!calling) {\n+\t\t\tcalling = true;\n+\t\t\ttry {\n+\t\t\t\tif (LAUNCH_ACTIVITY == msg.what) {\n+\t\t\t\t\thandleLaunchActivity(msg);\n+\t\t\t\t}\n+\t\t\t\tif (otherCallback != null) {\n+\t\t\t\t\treturn otherCallback.handleMessage(msg);\n \t\t\t\t}\n-\t\t\t\tbreak;\n+\t\t\t} finally {\n+\t\t\t\tcalling = false;\n \t\t\t}\n \t\t}\n-\t\tif (true) {\n-\t\t\treturn false;\n-\t\t}\n-\t\t// \u5411\u4e0b\u8c03\u7528\u517c\u5bb9\u5176\u5b83\u7684\u63d2\u4ef6\u5316\n-\t\treturn otherCallback != null && otherCallback.handleMessage(msg);\n+\t\treturn false;\n \t}\n \n-\tprivate boolean handleLaunchActivity(Message msg) {\n+\tprivate void handleLaunchActivity(Message msg) {\n \t\tObject r = msg.obj;\n \t\t// StubIntent\n \n@@ -115,7 +114,7 @@ private boolean handleLaunchActivity(Message msg) {\n \t\tAppInfo appInfo = VirtualCore.getCore().findApp(pkgName);\n \n \t\tif (appInfo == null) {\n-\t\t\treturn false;\n+\t\t\treturn;\n \t\t}\n \t\tClassLoader pluginClassLoader = appInfo.getClassLoader();\n \t\tstubIntent.setExtrasClassLoader(pluginClassLoader);\n@@ -127,9 +126,8 @@ private boolean handleLaunchActivity(Message msg) {\n \t\tActivityInfo targetActInfo = stubIntent.getParcelableExtra(ExtraConstants.EXTRA_TARGET_ACT_INFO);\n \n \t\tif (stubActInfo == null || targetActInfo == null) {\n-\t\t\treturn false;\n+\t\t\treturn;\n \t\t}\n-\n \t\tboolean error = false;\n \t\ttry {\n \t\t\ttargetIntent.putExtra(ExtraConstants.EXTRA_STUB_ACT_INFO, stubActInfo);\n@@ -139,7 +137,7 @@ private boolean handleLaunchActivity(Message msg) {\n \t\t\tXLog.w(TAG, \"Directly putExtra failed: %s.\", e.getMessage());\n \t\t}\n \t\tif (error && Build.VERSION.SDK_INT <= Build.VERSION_CODES.KITKAT) {\n-\t\t\t// 4.4\u4ee5\u4e0b\u7684\u8bbe\u5907\u4f1a\u51fa\u73b0\u8fd9\u4e2a\u5947\u8469\u7684\u95ee\u9898(unParcel\u6b7b\u6d3b\u627e\u4e0d\u5230\u7c7b\u52a0\u8f7d\u5668),\n+\t\t\t// 4.4\u4ee5\u4e0b\u7684\u8bbe\u5907\u4f1a\u51fa\u73b0\u8fd9\u4e2aBUG(unParcel\u627e\u4e0d\u5230\u7c7b\u52a0\u8f7d\u5668),\n \t\t\t// \u53ea\u80fd\u901a\u8fc7\u6ce8\u5165Class.forName\u6240\u4f7f\u7528\u7684\u7c7b\u52a0\u8f7d\u5668\u6765\u89e3\u51b3\u4e86...\n \t\t\tClassLoader oldParent = ClassLoaderCompat.setParent(getClass().getClassLoader(), pluginClassLoader);\n \t\t\ttry {\n@@ -153,8 +151,6 @@ private boolean handleLaunchActivity(Message msg) {\n \n \t\tActivityRecordCompat.setIntent(r, targetIntent);\n \t\tActivityRecordCompat.setActivityInfo(r, targetActInfo);\n-\n-\t\treturn true;\n \t}\n \n \t@Override",
      "parent_sha": "bfd6d5a652b3b02014601f8494e21b414a822786"
    }
  },
  {
    "oid": "418b40b008ea53efd12a46eca6a038555877247d",
    "message": "Fix: remove log.",
    "date": "2016-07-21T01:34:01Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/418b40b008ea53efd12a46eca6a038555877247d",
    "details": {
      "sha": "0c14d4b2bffa1149e9e586e72616f50519efeeda",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/hook/patchs/am/Hook_RegisterReceiver.java",
      "status": "modified",
      "additions": 3,
      "deletions": 10,
      "changes": 13,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/418b40b008ea53efd12a46eca6a038555877247d/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fam%2FHook_RegisterReceiver.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/418b40b008ea53efd12a46eca6a038555877247d/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fam%2FHook_RegisterReceiver.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fam%2FHook_RegisterReceiver.java?ref=418b40b008ea53efd12a46eca6a038555877247d",
      "patch": "@@ -14,7 +14,6 @@\n import com.lody.virtual.client.hook.base.Hook;\n import com.lody.virtual.client.hook.utils.HookUtils;\n import com.lody.virtual.helper.utils.Reflect;\n-import com.lody.virtual.helper.utils.XLog;\n \n import java.lang.ref.WeakReference;\n import java.lang.reflect.Method;\n@@ -28,7 +27,6 @@\n /* package */ class Hook_RegisterReceiver extends Hook {\n \n     private WeakHashMap<IBinder, IIntentReceiver.Stub> mProxyIIntentReceiver = new WeakHashMap<>();\n-    private static final String TAG = \"broadcast\";\n \n     @Override\n     public String getName() {\n@@ -60,18 +58,14 @@ public Object onHook(Object who, Method method, Object... args) throws Throwable\n                     mProxyIIntentReceiver.put(token, proxyIIntentReceiver);\n                 }\n                 try {\n-                    XLog.d(TAG, \"class=\" + old.getClass());\n                     WeakReference WeakReference_mDispatcher = Reflect.on(old).get(\"mDispatcher\");\n                     Object mDispatcher = WeakReference_mDispatcher.get();\n                     //\u8bbe\u7f6e\u5173\u7cfb\n                     Reflect.on(mDispatcher).set(\"mIIntentReceiver\", proxyIIntentReceiver);\n                     args[indexOfIIntentReceiver] = proxyIIntentReceiver;\n-                    XLog.d(TAG, \"set proxy ok\");\n                 } catch (Throwable e) {\n-                    XLog.e(TAG, \"test\" + e);\n+                    e.printStackTrace();\n                 }\n-            }else{\n-                XLog.w(TAG, \"is proxy\");\n             }\n         }\n         return method.invoke(who, args);\n@@ -82,10 +76,10 @@ public boolean isEnable() {\n         return isAppProcess();\n     }\n \n-    static class ProxyIIntentReceiver extends IIntentReceiver.Stub {\n+    private static class ProxyIIntentReceiver extends IIntentReceiver.Stub {\n         IIntentReceiver old;\n \n-        public ProxyIIntentReceiver(IIntentReceiver old) {\n+        ProxyIIntentReceiver(IIntentReceiver old) {\n             this.old = old;\n         }\n \n@@ -96,7 +90,6 @@ public void performReceive(Intent intent, int resultCode, String data, Bundle ex\n             try {\n                 String action = intent.getAction();\n                 ComponentName oldComponent = VirtualCore.getOriginComponentName(action);\n-                XLog.d(TAG, \"performReceive:\" + intent);\n                 if (oldComponent != null) {\n                     intent.setComponent(oldComponent);\n                     intent.setAction(null);",
      "parent_sha": "2c870f4bd045d15d3a34ed51da80acc2f9c3e818"
    }
  },
  {
    "oid": "00cdca9d9e291e179b29c3f90d55ace0a5c7da94",
    "message": "fix \u89e3\u51b3\u67d0\u79cd\u60c5\u51b5\u4e0bActivityInfo\u4e3anull\u60c5\u51b5\u9020\u6210\u7684\u5d29\u6e83\n\n\u6bd4\u5982\u638c\u9605\u4f7f\u7528LocalActivityManager\u542f\u52a8Activity\u7684\u60c5\u51b5",
    "date": "2016-07-10T17:00:12Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/00cdca9d9e291e179b29c3f90d55ace0a5c7da94",
    "details": {
      "sha": "5d63c6a9347c2d0ecb8c0444be0208f73631e6f0",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/local/LocalActivityManager.java",
      "status": "modified",
      "additions": 28,
      "deletions": 22,
      "changes": 50,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/00cdca9d9e291e179b29c3f90d55ace0a5c7da94/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Flocal%2FLocalActivityManager.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/00cdca9d9e291e179b29c3f90d55ace0a5c7da94/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Flocal%2FLocalActivityManager.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Flocal%2FLocalActivityManager.java?ref=00cdca9d9e291e179b29c3f90d55ace0a5c7da94",
      "patch": "@@ -12,18 +12,18 @@\n import com.lody.virtual.helper.proto.AppTaskInfo;\n import com.lody.virtual.helper.proto.VActRedirectResult;\n import com.lody.virtual.helper.proto.VRedirectActRequest;\n+import com.lody.virtual.helper.utils.Reflect;\n import com.lody.virtual.service.IActivityManager;\n \n import java.util.HashMap;\n import java.util.Map;\n \n /**\n  * @author Lody\n- *\n  */\n public class LocalActivityManager {\n \n-\tprivate IActivityManager service;\n+    private IActivityManager service;\n \n     private Map<IBinder, LocalActivityRecord> mActivities = new HashMap<IBinder, LocalActivityRecord>(6);\n \n@@ -32,31 +32,37 @@ public Map<IBinder, LocalActivityRecord> getActivities() {\n     }\n \n     public static LocalActivityManager getInstance() {\n-\t\treturn Holder.sAM;\n-\t}\n-\n-\tpublic IActivityManager getService() {\n-\t\tif (service == null) {\n-\t\t\tservice = IActivityManager.Stub\n-\t\t\t\t\t.asInterface(ServiceManagerNative.getService(ServiceManagerNative.ACTIVITY_MANAGER));\n-\t\t}\n-\t\treturn service;\n-\t}\n-\n-\tpublic VActRedirectResult redirectTargetActivity(VRedirectActRequest request) {\n-\t\ttry {\n-\t\t\treturn getService().redirectTargetActivity(request);\n-\t\t} catch (RemoteException e) {\n-\t\t\treturn RuntimeEnv.crash(e);\n-\t\t}\n-\t}\n+        return Holder.sAM;\n+    }\n+\n+    public IActivityManager getService() {\n+        if (service == null) {\n+            service = IActivityManager.Stub\n+                    .asInterface(ServiceManagerNative.getService(ServiceManagerNative.ACTIVITY_MANAGER));\n+        }\n+        return service;\n+    }\n+\n+    public VActRedirectResult redirectTargetActivity(VRedirectActRequest request) {\n+        try {\n+            return getService().redirectTargetActivity(request);\n+        } catch (RemoteException e) {\n+            return RuntimeEnv.crash(e);\n+        }\n+    }\n \n     public LocalActivityRecord onActivityCreate(Activity activity) {\n         Intent intent = activity.getIntent();\n         if (intent == null) {\n             return null;\n         }\n         ActivityInfo activityInfo = intent.getParcelableExtra(ExtraConstants.EXTRA_TARGET_ACT_INFO);\n+        //\u6b64\u5904\u5728\u4f7f\u7528LocalActivityManager\u542f\u52a8Activity\u7684\u65f6\u5019\u662f\u7a7a\u7684,\u56e0\u4e3a\u8d70\u4e0d\u5230replaceIntent\u91cc,\n+        // \u6bd4\u5982\u638c\u9605\u4f1a\u5d29\u6e83,\u6682\u65f6\u4eceActivity\u91cc\u53d6,\u6ca1\u8c03\u7814\u517c\u5bb9\u6027=_=,\u5148\u7528\u7740\n+        if (activityInfo == null) {\n+            activityInfo = Reflect.on(activity).field(\"mActivityInfo\").get();\n+        }\n+\n         IBinder token = activity.getActivityToken();\n         LocalActivityRecord r = new LocalActivityRecord();\n         r.activityInfo = activityInfo;\n@@ -100,6 +106,6 @@ public AppTaskInfo getTaskInfo(int taskId) {\n     }\n \n     private static final class Holder {\n-\t\tprivate static final LocalActivityManager sAM = new LocalActivityManager();\n-\t}\n+        private static final LocalActivityManager sAM = new LocalActivityManager();\n+    }\n }",
      "parent_sha": "9a7ed676ee30e5d7c786ea4ae7972aaa6024feee"
    }
  },
  {
    "oid": "a685146b2bf20fdd704d357d9f7c81c0006f8b3c",
    "message": "Fix: getServices return invalid values.",
    "date": "2016-08-07T12:39:52Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/a685146b2bf20fdd704d357d9f7c81c0006f8b3c",
    "details": {
      "sha": "8d058b40554877009ad2e03b5526d0dd5aa6abcb",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/hook/patchs/am/Hook_GetServices.java",
      "status": "modified",
      "additions": 3,
      "deletions": 3,
      "changes": 6,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/a685146b2bf20fdd704d357d9f7c81c0006f8b3c/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fam%2FHook_GetServices.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/a685146b2bf20fdd704d357d9f7c81c0006f8b3c/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fam%2FHook_GetServices.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fam%2FHook_GetServices.java?ref=a685146b2bf20fdd704d357d9f7c81c0006f8b3c",
      "patch": "@@ -1,10 +1,10 @@\n package com.lody.virtual.client.hook.patchs.am;\n \n-import java.lang.reflect.Method;\n-\n import com.lody.virtual.client.hook.base.Hook;\n import com.lody.virtual.client.local.VActivityManager;\n \n+import java.lang.reflect.Method;\n+\n /**\n  * @author Lody\n  *\n@@ -21,7 +21,7 @@ public String getName() {\n \tpublic Object onHook(Object who, Method method, Object... args) throws Throwable {\n \t\tint maxNum = (int) args[0];\n \t\tint flags = (int) args[1];\n-\t\treturn VActivityManager.getInstance().getServices(maxNum, flags);\n+\t\treturn VActivityManager.getInstance().getServices(maxNum, flags).getList();\n \t}\n \n \t@Override",
      "parent_sha": "5df57ff85fbc691a610b85acf565ec50cd028fdf"
    }
  },
  {
    "oid": "4828d24ab7563bf9d189dfa82bb834af10e7cbdb",
    "message": "Android 11: fix pm\n\nSigned-off-by: tiann <twsxtd@gmail.com>",
    "date": "2020-11-23T05:34:42Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/4828d24ab7563bf9d189dfa82bb834af10e7cbdb",
    "details": {
      "sha": "9c03651af0e5bd1a17872e4b01d5dc0126282c34",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/core/VirtualCore.java",
      "status": "modified",
      "additions": 1,
      "deletions": 12,
      "changes": 13,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/4828d24ab7563bf9d189dfa82bb834af10e7cbdb/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fcore%2FVirtualCore.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/4828d24ab7563bf9d189dfa82bb834af10e7cbdb/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fcore%2FVirtualCore.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fcore%2FVirtualCore.java?ref=4828d24ab7563bf9d189dfa82bb834af10e7cbdb",
      "patch": "@@ -391,17 +391,6 @@ public void removeVisibleOutsidePackage(String pkg) {\n     }\n \n     public boolean isOutsidePackageVisible(String pkg) {\n-        if (!isXposedEnabled() && !BuildCompat.isR()) {\n-            // FIXME: 2020/7/9 recursive call\n-            PackageManager unHookPackageManager = getUnHookPackageManager();\n-            try {\n-                unHookPackageManager.getPackageInfo(pkg, 0);\n-                return true;\n-            } catch (PackageManager.NameNotFoundException e) {\n-                return false;\n-            }\n-        }\n-\n         try {\n             return getService().isOutsidePackageVisible(pkg);\n         } catch (RemoteException e) {\n@@ -410,7 +399,7 @@ public boolean isOutsidePackageVisible(String pkg) {\n     }\n \n     public boolean isXposedEnabled() {\n-        return !VirtualCore.get().getContext().getFileStreamPath(\".disable_xposed\").exists() || BuildCompat.isR();\n+        return !VirtualCore.get().getContext().getFileStreamPath(\".disable_xposed\").exists() && !BuildCompat.isR();\n     }\n \n     public boolean isAppInstalled(String pkg) {",
      "parent_sha": "fe72ccb215a014ca75efa713517a96c2357cd0bb"
    }
  },
  {
    "oid": "f80cb1642b3160d8910f9e2e084a8c08730833b1",
    "message": "[VXP-fix]: collect method offset info.",
    "date": "2018-06-06T06:14:28Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/f80cb1642b3160d8910f9e2e084a8c08730833b1",
    "details": {
      "sha": "a89f935ad8feecf6f267d7d8da587f239fce08b9",
      "filename": "VirtualApp/app/src/main/java/io/virtualapp/home/FlurryROMCollector.java",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/f80cb1642b3160d8910f9e2e084a8c08730833b1/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2FFlurryROMCollector.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/f80cb1642b3160d8910f9e2e084a8c08730833b1/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2FFlurryROMCollector.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2FFlurryROMCollector.java?ref=f80cb1642b3160d8910f9e2e084a8c08730833b1",
      "patch": "@@ -29,9 +29,9 @@ public static void startCollect() {\n             reportCameraNativeSetup();\n         }\n         Map<String, Integer> offsetInfo = Epic.collectOffsetInfo();\n-//        if (!offsetInfo.isEmpty()) {\n+        if (!offsetInfo.isEmpty()) {\n             reportOffsetInfo(offsetInfo);\n-//        }\n+        }\n         Log.i(TAG, \"end collect...\");\n     }\n ",
      "parent_sha": "d5a1720a938272fddcf85c583185fce42af854c7"
    }
  },
  {
    "oid": "ead1033123a0d90acfc68eebb85fd4c7981aa118",
    "message": "Fix: ignore bad ContentProvider.",
    "date": "2017-09-30T04:25:04Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/ead1033123a0d90acfc68eebb85fd4c7981aa118",
    "details": {
      "sha": "3ddf1daff2d75d32a6e2a82b9d967c1332c9bf24",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/VClientImpl.java",
      "status": "modified",
      "additions": 5,
      "deletions": 1,
      "changes": 6,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/ead1033123a0d90acfc68eebb85fd4c7981aa118/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2FVClientImpl.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/ead1033123a0d90acfc68eebb85fd4c7981aa118/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2FVClientImpl.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2FVClientImpl.java?ref=ead1033123a0d90acfc68eebb85fd4c7981aa118",
      "patch": "@@ -449,7 +449,11 @@ private void installContentProviders(Context app, List<ProviderInfo> providers)\n         try {\n             for (ProviderInfo cpi : providers) {\n                 if (cpi.enabled) {\n-                    ActivityThread.installProvider(mainThread, app, cpi, null);\n+                    try {\n+                        ActivityThread.installProvider(mainThread, app, cpi, null);\n+                    } catch (Throwable e) {\n+                        e.printStackTrace();\n+                    }\n                 }\n             }\n         } finally {",
      "parent_sha": "a0220f7cfd7cf2b92ef3ee020b9bef603f1144ca"
    }
  },
  {
    "oid": "4659aaff4d376d72e1b320f0e082b174d6b76695",
    "message": "Fix: 'getPackagesForUid'.",
    "date": "2016-09-16T02:10:17Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/4659aaff4d376d72e1b320f0e082b174d6b76695",
    "details": {
      "sha": "bde157f7bcfb6c270f2e28709ec413b0c877a185",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/hook/patchs/pm/GetPackagesForUid.java",
      "status": "modified",
      "additions": 11,
      "deletions": 5,
      "changes": 16,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/4659aaff4d376d72e1b320f0e082b174d6b76695/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fpm%2FGetPackagesForUid.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/4659aaff4d376d72e1b320f0e082b174d6b76695/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fpm%2FGetPackagesForUid.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fpm%2FGetPackagesForUid.java?ref=4659aaff4d376d72e1b320f0e082b174d6b76695",
      "patch": "@@ -1,14 +1,16 @@\n package com.lody.virtual.client.hook.patchs.pm;\n \n import android.os.Binder;\n+import android.os.Process;\n \n import com.lody.virtual.client.core.VirtualCore;\n import com.lody.virtual.client.hook.base.Hook;\n import com.lody.virtual.client.local.VPackageManager;\n+import com.lody.virtual.helper.utils.collection.ArraySet;\n \n import java.lang.reflect.Method;\n-import java.util.ArrayList;\n import java.util.Arrays;\n+import java.util.Set;\n \n /**\n  * @author Lody\n@@ -30,14 +32,18 @@ public Object call(Object who, Method method, Object... args) throws Throwable {\n \t\t\tuid = getBaseVUid();\n \t\t}\n \t\tString[] callingPkgs = VPackageManager.get().getPackagesForUid(callingUid);\n-\t\tString[] pkgs = VPackageManager.get().getPackagesForUid(uid);\n+\t\tString[] targetPkgs = VPackageManager.get().getPackagesForUid(uid);\n+\t\tString[] selfPkgs = VPackageManager.get().getPackagesForUid(Process.myUid());\n \n-\t\tArrayList<String> pkgList = new ArrayList<>(2);\n+\t\tSet<String> pkgList = new ArraySet<>(2);\n \t\tif (callingPkgs != null && callingPkgs.length > 0) {\n \t\t\tpkgList.addAll(Arrays.asList(callingPkgs));\n \t\t}\n-\t\tif (pkgs != null && pkgs.length > 0) {\n-\t\t\tpkgList.addAll(Arrays.asList(pkgs));\n+\t\tif (targetPkgs != null && targetPkgs.length > 0) {\n+\t\t\tpkgList.addAll(Arrays.asList(targetPkgs));\n+\t\t}\n+\t\tif (selfPkgs != null && selfPkgs.length > 0) {\n+\t\t\tpkgList.addAll(Arrays.asList(selfPkgs));\n \t\t}\n \t\treturn pkgList.toArray(new String[pkgList.size()]);\n \t}",
      "parent_sha": "0079844955ac516bd85b7292d6365afe6e2eb7c3"
    }
  },
  {
    "oid": "feaea9e9244fb2d947abfd91b4de68d015fc0e68",
    "message": "FIX: fake-signature can not work on Android P.",
    "date": "2019-04-05T04:08:48Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/feaea9e9244fb2d947abfd91b4de68d015fc0e68",
    "details": {
      "sha": "fcc7a2243df056701aa45f98ef3414640a4cebb4",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/server/pm/parser/PackageParserEx.java",
      "status": "modified",
      "additions": 12,
      "deletions": 2,
      "changes": 14,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/feaea9e9244fb2d947abfd91b4de68d015fc0e68/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fpm%2Fparser%2FPackageParserEx.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/feaea9e9244fb2d947abfd91b4de68d015fc0e68/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fpm%2Fparser%2FPackageParserEx.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fpm%2Fparser%2FPackageParserEx.java?ref=feaea9e9244fb2d947abfd91b4de68d015fc0e68",
      "patch": "@@ -57,7 +57,7 @@ public static VPackage parsePackage(File packageFile) throws Throwable {\n                 && p.mAppMetaData != null\n                 && p.mAppMetaData.containsKey(\"fake-signature\")) {\n             String sig = p.mAppMetaData.getString(\"fake-signature\");\n-            p.mSignatures = new Signature[]{new Signature(sig)};\n+            buildSignature(p, new Signature[]{new Signature(sig)});\n             VLog.d(TAG, \"Using fake-signature feature on : \" + p.packageName);\n         } else {\n             try {\n@@ -66,7 +66,7 @@ public static VPackage parsePackage(File packageFile) throws Throwable {\n                 VLog.e(TAG, \"collectCertificates failed\", e);\n                 if (VirtualCore.get().getContext().getFileStreamPath(Constants.FAKE_SIGNATURE_FLAG).exists()) {\n                     VLog.w(TAG, \"Using fake signature: \" + p.packageName);\n-                    p.mSignatures = new Signature[]{new Signature(FAKE_SIG)};\n+                    buildSignature(p, new Signature[]{new Signature(FAKE_SIG)});\n                 } else {\n                     throw e;\n                 }\n@@ -75,6 +75,16 @@ public static VPackage parsePackage(File packageFile) throws Throwable {\n         return buildPackageCache(p);\n     }\n \n+    private static void buildSignature(PackageParser.Package p, Signature[] signatures) {\n+        if (Build.VERSION.SDK_INT < 28) {\n+            p.mSignatures = signatures;\n+        } else {\n+            Object signingDetails = mirror.android.content.pm.PackageParser.Package.mSigningDetails.get(p);\n+            mirror.android.content.pm.PackageParser.SigningDetails.pastSigningCertificates.set(signingDetails, signatures);\n+            mirror.android.content.pm.PackageParser.SigningDetails.signatures.set(signingDetails, signatures);\n+        }\n+    }\n+\n     public static VPackage readPackageCache(String packageName) {\n         Parcel p = Parcel.obtain();\n         try {",
      "parent_sha": "70a74fc92ab9536cece7b9ee429cd7b0f2614828"
    }
  },
  {
    "oid": "b00ddcdd759e599903428afb023d2b8ce24e4f60",
    "message": "[VXP]: refactor code.",
    "date": "2018-11-15T07:12:27Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/b00ddcdd759e599903428afb023d2b8ce24e4f60",
    "details": {
      "sha": "494327fef6b8f5f076bbec9147e9896177cc2251",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/hook/proxies/view/AutoFillManagerStub.java",
      "status": "modified",
      "additions": 28,
      "deletions": 58,
      "changes": 86,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/b00ddcdd759e599903428afb023d2b8ce24e4f60/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fproxies%2Fview%2FAutoFillManagerStub.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/b00ddcdd759e599903428afb023d2b8ce24e4f60/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fproxies%2Fview%2FAutoFillManagerStub.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fproxies%2Fview%2FAutoFillManagerStub.java?ref=b00ddcdd759e599903428afb023d2b8ce24e4f60",
      "patch": "@@ -4,10 +4,8 @@\n import android.content.ComponentName;\n import android.util.Log;\n \n-import com.lody.virtual.client.core.VirtualCore;\n import com.lody.virtual.client.hook.base.BinderInvocationProxy;\n-import com.lody.virtual.client.hook.base.MethodProxy;\n-import com.lody.virtual.client.hook.utils.MethodParameterUtils;\n+import com.lody.virtual.client.hook.base.ReplaceLastPkgMethodProxy;\n import com.lody.virtual.helper.utils.ArrayUtils;\n \n import java.lang.reflect.Field;\n@@ -48,63 +46,35 @@ public void inject() throws Throwable {\n             Log.e(TAG, \"AutoFillManagerStub inject error.\", tr);\n             return;\n         }\n-        addMethodProxy(new MethodProxy() {\n-            @Override\n-            public String getMethodName() {\n-                return \"startSession\";\n-            }\n-            @Override\n-            public boolean beforeCall(Object who, Method method, Object... args) {\n-                if (args == null) {\n-                    return super.beforeCall(who, method, args);\n-                }\n-                int length = args.length;\n-                if (length == 0) {\n-                    return super.beforeCall(who, method, args);\n-                }\n-\n-                int lastIndex = length - 1;\n-                Object lastParam = args[lastIndex];\n-                if (lastParam instanceof String) {\n-                    MethodParameterUtils.replaceLastAppPkg(args);\n-                } else if (lastParam instanceof ComponentName){\n-                    ComponentName lastComponent = (ComponentName) lastParam;\n-                    ComponentName newComponent = new ComponentName(VirtualCore.get().getHostPkg(),\n-                            lastComponent.getClassName());\n-                    args[lastIndex] = newComponent;\n-                }\n-                return super.beforeCall(who, method, args);\n-            }\n-        });\n \n-        addMethodProxy(new MethodProxy() {\n-            @Override\n-            public String getMethodName() {\n-                return \"updateOrRestartSession\";\n-            }\n-            @Override\n-            public boolean beforeCall(Object who, Method method, Object... args) {\n-                MethodParameterUtils.replaceLastAppPkg(args);\n-                int index = ArrayUtils.indexOfLast(args, ComponentName.class);\n-                if (index > 0) {\n-                    ComponentName origComponent = (ComponentName) args[index];\n-                    ComponentName newComponent = new ComponentName(getHostPkg(), origComponent.getClassName());\n-                    args[index] = newComponent;\n-                }\n-                return super.beforeCall(who, method, args);\n-            }\n-        });\n-        addMethodProxy(new MethodProxy() {\n-            @Override\n-            public String getMethodName() {\n-                return \"isServiceEnabled\";\n-            }\n-            @Override\n-            public boolean beforeCall(Object who, Method method, Object... args) {\n-                MethodParameterUtils.replaceLastAppPkg(args);\n-                return super.beforeCall(who, method, args);\n+        addMethodProxy(new ReplacePkgAndComponentProxy(\"startSession\"));\n+        addMethodProxy(new ReplacePkgAndComponentProxy(\"updateOrRestartSession\"));\n+        addMethodProxy(new ReplaceLastPkgMethodProxy(\"isServiceEnabled\"));\n+    }\n+\n+    static class ReplacePkgAndComponentProxy extends ReplaceLastPkgMethodProxy {\n+\n+        ReplacePkgAndComponentProxy(String name) {\n+            super(name);\n+        }\n+\n+        @Override\n+        public boolean beforeCall(Object who, Method method, Object... args) {\n+            replaceLastAppComponent(args, getHostPkg());\n+            return super.beforeCall(who, method, args);\n+        }\n+\n+        static ComponentName replaceLastAppComponent(Object[] args, String hostPkg) {\n+            int index = ArrayUtils.indexOfLast(args, ComponentName.class);\n+            if (index != -1) {\n+                ComponentName orig = (ComponentName) args[index];\n+                ComponentName newComponent = new ComponentName(hostPkg, orig.getClassName());\n+                args[index] = newComponent;\n+                return newComponent;\n             }\n-        });\n+            return null;\n+        }\n     }\n \n+\n }",
      "parent_sha": "6bef57be6b8e2db7cca78347987d178df01a996f"
    }
  },
  {
    "oid": "ff0ffc544f0ed774e92c212dd208bc4d4a2bbb03",
    "message": "[VA]: fix clipboard NPE on MIUI dev version.",
    "date": "2018-06-06T06:13:57Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/ff0ffc544f0ed774e92c212dd208bc4d4a2bbb03",
    "details": {
      "sha": "3e2889aa2928be9c353bdaff3450c5215bad6466",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/hook/proxies/clipboard/ClipBoardStub.java",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/ff0ffc544f0ed774e92c212dd208bc4d4a2bbb03/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fproxies%2Fclipboard%2FClipBoardStub.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/ff0ffc544f0ed774e92c212dd208bc4d4a2bbb03/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fproxies%2Fclipboard%2FClipBoardStub.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fproxies%2Fclipboard%2FClipBoardStub.java?ref=ff0ffc544f0ed774e92c212dd208bc4d4a2bbb03",
      "patch": "@@ -23,7 +23,7 @@ public ClipBoardStub() {\n     }\n \n     private static IInterface getInterface() {\n-        if (BuildCompat.isOreo()) {\n+        if (BuildCompat.isOreo() || ClipboardManager.getService == null) {\n             android.content.ClipboardManager cm = (android.content.ClipboardManager)\n                     VirtualCore.get().getContext().getSystemService(Context.CLIPBOARD_SERVICE);\n             return ClipboardManagerOreo.mService.get(cm);",
      "parent_sha": "a8cf9307a797b1daf6a93cdd2c25a49de0238eeb"
    }
  },
  {
    "oid": "43104a3721626aa8d3e6251e1ece92b5d45dd35e",
    "message": "Fix: Accounts not update in some devices.",
    "date": "2016-08-13T00:26:24Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/43104a3721626aa8d3e6251e1ece92b5d45dd35e",
    "details": {
      "sha": "2404bd720d4886ba3b24283aaca1f665a46c1d01",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/service/account/RegisteredServicesCache.java",
      "status": "modified",
      "additions": 12,
      "deletions": 28,
      "changes": 40,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/43104a3721626aa8d3e6251e1ece92b5d45dd35e/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fservice%2Faccount%2FRegisteredServicesCache.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/43104a3721626aa8d3e6251e1ece92b5d45dd35e/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fservice%2Faccount%2FRegisteredServicesCache.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fservice%2Faccount%2FRegisteredServicesCache.java?ref=43104a3721626aa8d3e6251e1ece92b5d45dd35e",
      "patch": "@@ -1,10 +1,8 @@\n package com.lody.virtual.service.account;\n \n-import android.content.BroadcastReceiver;\n import android.content.ComponentName;\n import android.content.Context;\n import android.content.Intent;\n-import android.content.IntentFilter;\n import android.content.pm.ApplicationInfo;\n import android.content.pm.PackageInfo;\n import android.content.pm.PackageManager;\n@@ -14,6 +12,7 @@\n import android.content.res.Resources;\n import android.content.res.XmlResourceParser;\n import android.os.Handler;\n+import android.os.RemoteException;\n import android.util.AttributeSet;\n import android.util.Log;\n import android.util.Xml;\n@@ -22,7 +21,8 @@\n import com.android.internal.util.FastXmlSerializer;\n import com.google.android.collect.Lists;\n import com.google.android.collect.Maps;\n-import com.lody.virtual.client.env.Constants;\n+import com.lody.virtual.service.interfaces.IAppObserver;\n+import com.lody.virtual.service.pm.VAppManagerService;\n \n import org.xmlpull.v1.XmlPullParser;\n import org.xmlpull.v1.XmlPullParserException;\n@@ -40,7 +40,6 @@\n import java.util.HashMap;\n import java.util.List;\n import java.util.Map;\n-import java.util.concurrent.atomic.AtomicReference;\n \n /**\n  * A cache of registered services. This cache is built by interrogating the\n@@ -58,8 +57,6 @@ public abstract class RegisteredServicesCache<V> {\n \tprivate final String mMetaDataName;\n \tprivate final String mAttributesName;\n \tprivate final XmlSerializerAndParser<V> mSerializerAndParser;\n-\tprivate final AtomicReference<BroadcastReceiver> mReceiver;\n-\n \tprivate final Object mServicesLock = new Object();\n \t/**\n \t * This file contains the list of known services. We would like to maintain\n@@ -95,24 +92,17 @@ public RegisteredServicesCache(Context context, String interfaceName, String met\n \n \t\tgenerateServicesMap();\n \n-\t\tfinal BroadcastReceiver receiver = new BroadcastReceiver() {\n+\t\tVAppManagerService.getService().registerObserver(new IAppObserver.Stub() {\n+\t\t\t@Override\n+\t\t\tpublic void onNewApp(String pkg) throws RemoteException {\n+\t\t\t\tgenerateServicesMap();\n+\t\t\t}\n+\n \t\t\t@Override\n-\t\t\tpublic void onReceive(Context context1, Intent intent) {\n+\t\t\tpublic void onRemoveApp(String pkg) throws RemoteException {\n \t\t\t\tgenerateServicesMap();\n \t\t\t}\n-\t\t};\n-\t\tmReceiver = new AtomicReference<BroadcastReceiver>(receiver);\n-\t\tIntentFilter intentFilter = new IntentFilter();\n-\t\tintentFilter.addAction(Constants.VIRTUAL_ACTION_PACKAGE_ADDED);\n-\t\tintentFilter.addAction(Constants.VIRTUAL_ACTION_PACKAGE_CHANGED);\n-\t\tintentFilter.addAction(Constants.VIRTUAL_ACTION_PACKAGE_REMOVED);\n-\t\tintentFilter.addDataScheme(\"package\");\n-\t\tmContext.registerReceiver(receiver, intentFilter);\n-\t\t// Register for events related to sdcard installation.\n-\t\tIntentFilter sdFilter = new IntentFilter();\n-\t\tsdFilter.addAction(Intent.ACTION_EXTERNAL_APPLICATIONS_AVAILABLE);\n-\t\tsdFilter.addAction(Intent.ACTION_EXTERNAL_APPLICATIONS_UNAVAILABLE);\n-\t\tmContext.registerReceiver(receiver, sdFilter);\n+\t\t});\n \t}\n \n \n@@ -191,17 +181,11 @@ public Collection<ServiceInfo<V>> getAllServices() {\n \t * Stops the monitoring of package additions, removals and changes.\n \t */\n \tpublic void close() {\n-\t\tfinal BroadcastReceiver receiver = mReceiver.getAndSet(null);\n-\t\tif (receiver != null) {\n-\t\t\tmContext.unregisterReceiver(receiver);\n-\t\t}\n+\t\t// Nothing\n \t}\n \n \t@Override\n \tprotected void finalize() throws Throwable {\n-\t\tif (mReceiver.get() != null) {\n-\t\t\tLog.e(TAG, \"RegisteredServicesCache finalized without being closed\");\n-\t\t}\n \t\tclose();\n \t\tsuper.finalize();\n \t}",
      "parent_sha": "47e60a0f7257602a2c80da7570c5496fb796dafd"
    }
  },
  {
    "oid": "7f5e6cf8e830693b28636aee0323a05acedeed7a",
    "message": "Revert \"Fix: SignleTop launch mode\"",
    "date": "2016-09-23T08:17:36Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/7f5e6cf8e830693b28636aee0323a05acedeed7a",
    "details": {
      "sha": "0191f3fc3b6d79fee3fc28c0a03c2da396980ac0",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/server/am/ActivityStack.java",
      "status": "modified",
      "additions": 2,
      "deletions": 7,
      "changes": 9,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/7f5e6cf8e830693b28636aee0323a05acedeed7a/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fam%2FActivityStack.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/7f5e6cf8e830693b28636aee0323a05acedeed7a/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fam%2FActivityStack.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fam%2FActivityStack.java?ref=7f5e6cf8e830693b28636aee0323a05acedeed7a",
      "patch": "@@ -160,9 +160,6 @@ private boolean markTaskByClearTarget(TaskRecord task, ClearTarget clearTarget,\n \t\t\t\t\t}\n \t\t\t\t}\n \t\t\t} break;\n-\t\t\tcase ONLY_TOP : {\n-\t\t\t\tmarked = false;\n-\t\t\t} break;\n \t\t}\n \n \t\treturn marked;\n@@ -242,7 +239,7 @@ int startActivityLocked(int userId, Intent intent, ActivityInfo info, IBinder re\n \n \t\tswitch (info.launchMode) {\n \t\t\tcase LAUNCH_SINGLE_TOP : {\n-\t\t\t\tclearTarget = ClearTarget.ONLY_TOP;\n+\t\t\t\tclearTarget = ClearTarget.AFTER_TOP;\n \t\t\t\tif (containFlags(intent, Intent.FLAG_ACTIVITY_NEW_TASK)) {\n \t\t\t\t\treuseTarget = containFlags(intent, Intent.FLAG_ACTIVITY_MULTIPLE_TASK)\n \t\t\t\t\t\t\t? ReuseTarget.MULTIPLE\n@@ -596,9 +593,7 @@ private enum ClearTarget {\n \t\tNOTHING,\n \t\tSPEC_ACTIVITY,\n \t\tFULL_TASK(true),\n-\t\tAFTER_TOP(true),\n-\t\tONLY_TOP(true);\n-\n+\t\tAFTER_TOP(true);\n \t\tboolean deliverIntent;\n \n \t\tClearTarget() {",
      "parent_sha": "e876d8603c533c520d5f315dc708397fc7634819"
    }
  },
  {
    "oid": "588397a453f845bbf5b33cfe1c56fe3532bad083",
    "message": "[VXP-fix]: fix error when throw exception.",
    "date": "2018-06-06T06:13:59Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/588397a453f845bbf5b33cfe1c56fe3532bad083",
    "details": {
      "sha": "2e1304498614842222aaca1d04e444af752da9d3",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/VClientImpl.java",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/588397a453f845bbf5b33cfe1c56fe3532bad083/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2FVClientImpl.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/588397a453f845bbf5b33cfe1c56fe3532bad083/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2FVClientImpl.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2FVClientImpl.java?ref=588397a453f845bbf5b33cfe1c56fe3532bad083",
      "patch": "@@ -334,7 +334,7 @@ private void bindApplicationNoCheck(String packageName, String processName, Cond\n         } catch (Exception e) {\n             if (!mInstrumentation.onException(mInitialApplication, e)) {\n                 throw new RuntimeException(\n-                        \"Unable to create application \" + mInitialApplication.getClass().getName()\n+                        \"Unable to create application \" + (mInitialApplication == null ? \" [null application] \" : mInitialApplication.getClass().getName()\n                                 + \": \" + e.toString(), e);\n             }\n         }",
      "parent_sha": "c34dad7502294bc6b4d8a0894645681123a09fd5"
    }
  },
  {
    "oid": "e7b44ed7fee701425e39fcba16b5875547526c0f",
    "message": "[VXP]: fix for anti-virus, ESET-NOD32: a variant of Android/AdDisplay.AdLock.AL potentially unwanted",
    "date": "2018-06-06T06:16:37Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/e7b44ed7fee701425e39fcba16b5875547526c0f",
    "details": {
      "sha": "878b6c7ab9d6410c1b040bc1a9a184faef556eda",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/natives/NativeMethods.java",
      "status": "modified",
      "additions": 7,
      "deletions": 1,
      "changes": 8,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/e7b44ed7fee701425e39fcba16b5875547526c0f/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fnatives%2FNativeMethods.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/e7b44ed7fee701425e39fcba16b5875547526c0f/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fnatives%2FNativeMethods.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fnatives%2FNativeMethods.java?ref=e7b44ed7fee701425e39fcba16b5875547526c0f",
      "patch": "@@ -4,6 +4,8 @@\n import android.media.AudioRecord;\n import android.os.Build;\n \n+import com.lody.virtual.helper.utils.EncodeUtils;\n+\n import java.lang.reflect.Method;\n \n import dalvik.system.DexFile;\n@@ -21,8 +23,12 @@ public class NativeMethods {\n     public static Method gAudioRecordNativeCheckPermission;\n \n     public static void init() {\n+        // anti-virus, fuck ESET-NOD32: a variant of Android/AdDisplay.AdLock.AL potentially unwanted\n+        final String openDexFileNative = EncodeUtils.decode(\"b3BlbkRleEZpbGVOYXRpdmU=\");\n+        final String openDexFile = EncodeUtils.decode(\"b3BlbkRleEZpbGU=\");\n+\n         String methodName =\n-                Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT ? \"openDexFileNative\" : \"openDexFile\";\n+                Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT ? openDexFileNative : openDexFile;\n         for (Method method : DexFile.class.getDeclaredMethods()) {\n             if (method.getName().equals(methodName)) {\n                 gOpenDexFileNative = method;",
      "parent_sha": "264a92a45da06ae3e6d23385ad9ba1ad4f6131ca"
    }
  },
  {
    "oid": "afb763be67ea904534c081ea72f78b7faf2427a7",
    "message": "\u524d\u7f6edeletePackageLocked()\u8c03\u7528",
    "date": "2016-11-10T05:26:23Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/afb763be67ea904534c081ea72f78b7faf2427a7",
    "details": {
      "sha": "0dfe7b3640787cdcef52475bd6f20b9396c76fe8",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/server/pm/PackageCache.java",
      "status": "modified",
      "additions": 2,
      "deletions": 6,
      "changes": 8,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/afb763be67ea904534c081ea72f78b7faf2427a7/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fpm%2FPackageCache.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/afb763be67ea904534c081ea72f78b7faf2427a7/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fpm%2FPackageCache.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fpm%2FPackageCache.java?ref=afb763be67ea904534c081ea72f78b7faf2427a7",
      "patch": "@@ -30,12 +30,8 @@ public static PackageParser.Package get(String packageName) {\n \n \tpublic static PackageParser.Package remove(String packageName) {\n \t\tsynchronized (PackageCache.class) {\n-\t\t\tPackageParser.Package p = sPackageCaches.remove(packageName);\n-\t\t\tif (p != null) {\n-\t\t\t\tVPackageManagerService.get().deletePackageLocked(packageName);\n-\t\t\t\treturn p;\n-\t\t\t}\n-\t\t\treturn null;\n+\t\t\tVPackageManagerService.get().deletePackageLocked(packageName);\n+\t\t\treturn sPackageCaches.remove(packageName);\n \t\t}\n \t}\n }",
      "parent_sha": "2358611b5ee2b1b04cc4d5aef4e161bf4b974334"
    }
  },
  {
    "oid": "46e6531f767ee9435cb62d666e992b6bd25231aa",
    "message": "[Exposed-UI]: stop loading when activity onStop(ui disappear) instead onPause.",
    "date": "2018-06-06T06:13:25Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/46e6531f767ee9435cb62d666e992b6bd25231aa",
    "details": {
      "sha": "b860f7a73252406678026fa1d36471cf949d695d",
      "filename": "VirtualApp/app/src/main/java/io/virtualapp/home/LoadingActivity.java",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/46e6531f767ee9435cb62d666e992b6bd25231aa/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2FLoadingActivity.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/46e6531f767ee9435cb62d666e992b6bd25231aa/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2FLoadingActivity.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2FLoadingActivity.java?ref=46e6531f767ee9435cb62d666e992b6bd25231aa",
      "patch": "@@ -90,8 +90,8 @@ protected void onResume() {\n     }\n \n     @Override\n-    protected void onPause() {\n-        super.onPause();\n+    protected void onStop() {\n+        super.onStop();\n         if (loadingView != null) {\n             loadingView.stopAnim();\n         }",
      "parent_sha": "f6976b1de1bce17279d86adfc718b5d3248272f8"
    }
  },
  {
    "oid": "a22e3176e565b3266154bf69b9eb0329efa36c8a",
    "message": "Fix: issue #193.",
    "date": "2017-01-25T13:35:37Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/a22e3176e565b3266154bf69b9eb0329efa36c8a",
    "details": {
      "sha": "590946677f3d510ea8d4163c87428f5e6d2feb54",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/os/VUserManager.java",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/a22e3176e565b3266154bf69b9eb0329efa36c8a/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fos%2FVUserManager.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/a22e3176e565b3266154bf69b9eb0329efa36c8a/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fos%2FVUserManager.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fos%2FVUserManager.java?ref=a22e3176e565b3266154bf69b9eb0329efa36c8a",
      "patch": "@@ -365,7 +365,7 @@ public void wipeUser(int handle) {\n      * @return a value greater than or equal to 1\n      */\n     public static int getMaxSupportedUsers() {\n-        return 9;\n+        return Integer.MAX_VALUE;\n     }\n \n     /**",
      "parent_sha": "b170b4e6c34a0e3959a238e4b8c4ccb15b77a62f"
    }
  },
  {
    "oid": "79dcbbfb4bd9fa5c2ba71b47e4602ed1a01828a5",
    "message": "[Exposed-UI]: update email.",
    "date": "2018-06-06T06:13:25Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/79dcbbfb4bd9fa5c2ba71b47e4602ed1a01828a5",
    "details": {
      "sha": "3621fe715fb32d83d5dabfeaad5e84c99c0741ae",
      "filename": "VirtualApp/app/src/main/java/io/virtualapp/about/AboutActivity.java",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/79dcbbfb4bd9fa5c2ba71b47e4602ed1a01828a5/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fabout%2FAboutActivity.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/79dcbbfb4bd9fa5c2ba71b47e4602ed1a01828a5/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fabout%2FAboutActivity.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fabout%2FAboutActivity.java?ref=79dcbbfb4bd9fa5c2ba71b47e4602ed1a01828a5",
      "patch": "@@ -41,7 +41,7 @@ protected void onCreate(@Nullable Bundle savedInstanceState) {\n         try {\n             page.addItem(getThanksElement())\n                     .addItem(getDonateElement())\n-                    .addEmail(\"twsxtd@gmail.com\")\n+                    .addEmail(\"va1xposed@gmail.com\")\n                     .addWebsite(\"https://github.com/android-hacker/VAExposed\")\n                     .addGitHub(\"tiann\")\n                     .addItem(getCopyRightsElement());",
      "parent_sha": "ba405e99a2d961ba7b5917f069f06f6b16922dc0"
    }
  },
  {
    "oid": "bfd6d5a652b3b02014601f8494e21b414a822786",
    "message": "Fix: a memory leak.",
    "date": "2016-07-14T13:46:28Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/bfd6d5a652b3b02014601f8494e21b414a822786",
    "details": {
      "sha": "9b279c04d9153b1bc0617c6049768ed0994f5049",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/service/VContentServiceImpl.java",
      "status": "modified",
      "additions": 7,
      "deletions": 6,
      "changes": 13,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/bfd6d5a652b3b02014601f8494e21b414a822786/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fservice%2FVContentServiceImpl.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/bfd6d5a652b3b02014601f8494e21b414a822786/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fservice%2FVContentServiceImpl.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fservice%2FVContentServiceImpl.java?ref=bfd6d5a652b3b02014601f8494e21b414a822786",
      "patch": "@@ -1,16 +1,16 @@\n package com.lody.virtual.service;\n \n-import java.util.List;\n-\n-import com.lody.virtual.helper.proto.VComponentInfo;\n-import com.lody.virtual.helper.utils.XLog;\n-\n import android.app.IActivityManager;\n import android.content.pm.ProviderInfo;\n import android.os.IBinder;\n import android.os.RemoteException;\n import android.text.TextUtils;\n \n+import com.lody.virtual.helper.proto.VComponentInfo;\n+import com.lody.virtual.helper.utils.XLog;\n+\n+import java.util.List;\n+\n /**\n  * @author Lody\n  *\n@@ -85,7 +85,7 @@ public void publishContentProviders(List<IActivityManager.ContentProviderHolder>\n \t\t}\n \t}\n \n-\tprivate boolean linkProviderDied(final String auth, IBinder binder) {\n+\tprivate boolean linkProviderDied(final String auth, final IBinder binder) {\n \t\tif (binder == null) {\n \t\t\treturn false;\n \t\t}\n@@ -95,6 +95,7 @@ private boolean linkProviderDied(final String auth, IBinder binder) {\n \t\t\t\tpublic void binderDied() {\n \t\t\t\t\tsynchronized (mProviderList) {\n \t\t\t\t\t\tmProviderList.removeAuth(auth);\n+\t\t\t\t\t\tbinder.unlinkToDeath(this, 0);\n \t\t\t\t\t}\n \t\t\t\t}\n \t\t\t}, 0);",
      "parent_sha": "f9aa81d05545c712e59365576aa796e9e1c42122"
    }
  },
  {
    "oid": "b1bbd9ebc9bcb61b5c40657c9ba7ae79eb0fdfbc",
    "message": "[VXP]: handle start activity failed exception.",
    "date": "2018-06-06T06:25:33Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/b1bbd9ebc9bcb61b5c40657c9ba7ae79eb0fdfbc",
    "details": {
      "sha": "e09928440805d8c366a4cb307e693ad7bf7f28b4",
      "filename": "VirtualApp/app/src/main/java/io/virtualapp/settings/SettingsActivity.java",
      "status": "modified",
      "additions": 8,
      "deletions": 8,
      "changes": 16,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/b1bbd9ebc9bcb61b5c40657c9ba7ae79eb0fdfbc/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fsettings%2FSettingsActivity.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/b1bbd9ebc9bcb61b5c40657c9ba7ae79eb0fdfbc/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fsettings%2FSettingsActivity.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fsettings%2FSettingsActivity.java?ref=b1bbd9ebc9bcb61b5c40657c9ba7ae79eb0fdfbc",
      "patch": "@@ -378,15 +378,15 @@ protected int dp2px(float dp) {\n             final float scale = getResources().getDisplayMetrics().density;\n             return (int) (dp * scale + 0.5f);\n         }\n-    }\n \n-    @Override\n-    public void startActivity(Intent intent) {\n-        try {\n-            super.startActivity(intent);\n-        } catch (Throwable ignored) {\n-            Toast.makeText(this, \"startActivity failed.\", Toast.LENGTH_SHORT).show();\n-            ignored.printStackTrace();\n+        @Override\n+        public void startActivity(Intent intent) {\n+            try {\n+                super.startActivity(intent);\n+            } catch (Throwable ignored) {\n+                Toast.makeText(getActivity(), \"startActivity failed.\", Toast.LENGTH_SHORT).show();\n+                ignored.printStackTrace();\n+            }\n         }\n     }\n }",
      "parent_sha": "1a992663feca79a51df0d583849c9d932186ee93"
    }
  },
  {
    "oid": "5a0f33c334a4c16deed028d7978b4e1960b5e85c",
    "message": "Fix: a nullptr bug.",
    "date": "2017-01-26T12:41:04Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/5a0f33c334a4c16deed028d7978b4e1960b5e85c",
    "details": {
      "sha": "8dd132f5657cfe3afe4e03c1315178f0af20d55b",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/server/am/UiEngine.java",
      "status": "modified",
      "additions": 10,
      "deletions": 8,
      "changes": 18,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/5a0f33c334a4c16deed028d7978b4e1960b5e85c/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fam%2FUiEngine.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/5a0f33c334a4c16deed028d7978b4e1960b5e85c/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fam%2FUiEngine.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fam%2FUiEngine.java?ref=5a0f33c334a4c16deed028d7978b4e1960b5e85c",
      "patch": "@@ -79,16 +79,18 @@ void exitActivity(int userId, String packageName) {\n \n     void appDead(int userId, String packageName) {\n         Map<String, Integer> appCounter = appMarker.get(userId);\n-        appCounter.remove(packageName);\n-        final int N = observers.beginBroadcast();\n-        for (int i = 0; i < N; i++) {\n-            try {\n-                observers.getBroadcastItem(i).exitAppUI(userId, packageName);\n-            } catch (RemoteException e) {\n-                e.printStackTrace();\n+        if (appCounter != null) {\n+            appCounter.remove(packageName);\n+            final int N = observers.beginBroadcast();\n+            for (int i = 0; i < N; i++) {\n+                try {\n+                    observers.getBroadcastItem(i).exitAppUI(userId, packageName);\n+                } catch (RemoteException e) {\n+                    e.printStackTrace();\n+                }\n             }\n+            observers.finishBroadcast();\n         }\n-        observers.finishBroadcast();\n     }\n }\n ",
      "parent_sha": "e093b6d1db9ebd0fcddc292f6dbaef214cebe854"
    }
  },
  {
    "oid": "e18658758d9c78d26b4aec46d45da8d2545cf7ef",
    "message": "rm log",
    "date": "2016-07-19T12:36:49Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/e18658758d9c78d26b4aec46d45da8d2545cf7ef",
    "details": {
      "sha": "b24968c86c30208051c6980daf41e6c333f14edf",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/hook/patchs/notification/compat/NotificationPendIntent.java",
      "status": "modified",
      "additions": 3,
      "deletions": 5,
      "changes": 8,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/e18658758d9c78d26b4aec46d45da8d2545cf7ef/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fnotification%2Fcompat%2FNotificationPendIntent.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/e18658758d9c78d26b4aec46d45da8d2545cf7ef/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fnotification%2Fcompat%2FNotificationPendIntent.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fnotification%2Fcompat%2FNotificationPendIntent.java?ref=e18658758d9c78d26b4aec46d45da8d2545cf7ef",
      "patch": "@@ -8,8 +8,6 @@\n import android.widget.RemoteViews;\n import android.widget.TextView;\n \n-import com.lody.virtual.helper.ExtraConstants;\n-\n import java.util.ArrayList;\n import java.util.Iterator;\n import java.util.List;\n@@ -38,7 +36,7 @@ public void set(RemoteViews remoteViews) {\n                 if (view != null) {\n                     Rect rect = new Rect();\n                     view.getHitRect(rect);\n-                    Log.i(\"kk\", view.getId() + \",rect=\" + rect + \",intent=\" + e.getValue().getIntent().getParcelableExtra(ExtraConstants.EXTRA_INTENT));\n+//                    Log.i(\"kk\", view.getId() + \",rect=\" + rect + \",intent=\" + e.getValue().getIntent().getParcelableExtra(ExtraConstants.EXTRA_INTENT));\n                     list.add(new RectInfo(rect, e.getValue()));\n                 }\n             }\n@@ -64,10 +62,10 @@ private void setIntentByViewGroup(RemoteViews remoteViews, ViewGroup viewGroup,\n //                Log.d(\"kk\", v.getId() + \",rect=\" + rect);\n                 PendingIntent pendingIntent = findIntent(rect, list);\n                 if (pendingIntent != null) {\n-                    Log.d(\"kk\", v.getId() + \" set click =\" + pendingIntent.getIntent().getParcelableExtra(ExtraConstants.EXTRA_INTENT));\n+//                    Log.d(\"kk\", v.getId() + \" set click =\" + pendingIntent.getIntent().getParcelableExtra(ExtraConstants.EXTRA_INTENT));\n                     remoteViews.setOnClickPendingIntent(v.getId(), pendingIntent);\n                 } else {\n-                    Log.w(\"kk\", v.getId() + \",rect=\" + rect);\n+//                    Log.w(\"kk\", v.getId() + \",rect=\" + rect);\n                 }\n             }\n         }",
      "parent_sha": "2c2b30c3254ec5fd1b211b3eb8930c8ee1298bb1"
    }
  },
  {
    "oid": "2050e2a422498fc71319df3946f32c1edf9fb2d3",
    "message": "revert a9a09d4",
    "date": "2017-07-19T01:46:05Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/2050e2a422498fc71319df3946f32c1edf9fb2d3",
    "details": {
      "sha": "5fb26ca0ce0eb362c1f251101bacea1af82237a2",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/VClientImpl.java",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/2050e2a422498fc71319df3946f32c1edf9fb2d3/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2FVClientImpl.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/2050e2a422498fc71319df3946f32c1edf9fb2d3/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2FVClientImpl.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2FVClientImpl.java?ref=2050e2a422498fc71319df3946f32c1edf9fb2d3",
      "patch": "@@ -363,7 +363,7 @@ private void startIOUniformer() {\n             NativeEngine.redirectDirectory(\"/data/user_de/0/\" + info.packageName, info.dataDir);\n         }\n         String libPath = new File(VEnvironment.getDataAppPackageDirectory(info.packageName), \"lib\").getAbsolutePath();\n-        String userLibPath = new File(VEnvironment.getDataUserPackageDirectory(userId, info.packageName), \"lib\").getAbsolutePath();\n+        String userLibPath = new File(VEnvironment.getUserSystemDirectory(userId), \"lib\").getAbsolutePath();\n         NativeEngine.redirectDirectory(userLibPath, libPath);\n         NativeEngine.redirectDirectory(\"/data/data/\" + info.packageName + \"/lib/\", libPath);\n         NativeEngine.redirectDirectory(\"/data/user/0/\" + info.packageName + \"/lib/\", libPath);",
      "parent_sha": "3deb76e4748bceb853439360084446293d7d074c"
    }
  },
  {
    "oid": "77076f1a7b57db01136be2377bb0814ab9563c24",
    "message": "Fix: WifiManagerPatch FC: MacAddress may be null\n\u60f3\u4e86\u60f3\uff0c\u8fd8\u662f\u8fd9\u6837\u597d\u4e86\u3002\u3002\u3002null\u5c31\u4e0d\u7ba1\u5b83\u4e86",
    "date": "2017-02-21T12:18:44Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/77076f1a7b57db01136be2377bb0814ab9563c24",
    "details": {
      "sha": "8abbbb8e8ff1e4b945ac297b684eeca0f84e4aa8",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/hook/patchs/wifi/WifiManagerPatch.java",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/77076f1a7b57db01136be2377bb0814ab9563c24/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fwifi%2FWifiManagerPatch.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/77076f1a7b57db01136be2377bb0814ab9563c24/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fwifi%2FWifiManagerPatch.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fwifi%2FWifiManagerPatch.java?ref=77076f1a7b57db01136be2377bb0814ab9563c24",
      "patch": "@@ -31,7 +31,7 @@ protected void onBindHooks() {\n \t\t\tpublic Object call(Object who, Method method, Object... args) throws Throwable {\n \t\t\t\tWifiInfo info = (WifiInfo) super.call(who, method, args);\n \t\t\t\tif (info != null) {\n-\t\t\t\t\tif (info.getMacAddress() == null || info.getMacAddress().startsWith(\"00-00-00-00-00-00\")) {\n+\t\t\t\t\tif (info.getMacAddress() != null && info.getMacAddress().startsWith(\"00-00-00-00-00-00\")) {\n \t\t\t\t\t\tReflect.on(info).set(\"mMacAddress\", \"00:00:08:76:54:32\");\n \t\t\t\t\t}\n \t\t\t\t}",
      "parent_sha": "576d4fd81776a7082899422b46184a046ffa280c"
    }
  },
  {
    "oid": "8ceb838982a65c3f3f9400ea318ca67d23d3ef89",
    "message": "[VXP]: fix launch activity exception.",
    "date": "2018-06-30T05:58:34Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/8ceb838982a65c3f3f9400ea318ca67d23d3ef89",
    "details": {
      "sha": "0fecb523b86b117692d5ea5a03b2bd527f6feb81",
      "filename": "VirtualApp/app/src/main/java/io/virtualapp/home/LoadingActivity.java",
      "status": "modified",
      "additions": 4,
      "deletions": 1,
      "changes": 5,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/8ceb838982a65c3f3f9400ea318ca67d23d3ef89/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2FLoadingActivity.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/8ceb838982a65c3f3f9400ea318ca67d23d3ef89/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2FLoadingActivity.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2FLoadingActivity.java?ref=8ceb838982a65c3f3f9400ea318ca67d23d3ef89",
      "patch": "@@ -180,7 +180,10 @@ private void checkAndLaunch(Intent intent, int userId) {\n                             .setMessage(getResources().getString(R.string.permission_tips_content, name))\n                             .setPositiveButton(R.string.permission_tips_confirm, (dialog, which) -> {\n                                 String[] permissionToRequest = dangerousPermissions.toArray(new String[dangerousPermissions.size()]);\n-                                ActivityCompat.requestPermissions(this, permissionToRequest, REQUEST_PERMISSION_CODE);\n+                                try {\n+                                    ActivityCompat.requestPermissions(this, permissionToRequest, REQUEST_PERMISSION_CODE);\n+                                } catch (Throwable ignored) {\n+                                }\n                             })\n                             .create();\n                     try {",
      "parent_sha": "76ce836bd418b4de4c8ef6deffaa0a143906c2d3"
    }
  },
  {
    "oid": "839ececef9a4010cd4c9309cbe19237844de0876",
    "message": "Fix: ContentProvider.query with NULL param.",
    "date": "2017-10-25T03:38:40Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/839ececef9a4010cd4c9309cbe19237844de0876",
    "details": {
      "sha": "e6c8b89285fbd0242730034cc29ed3a07bf2bbbd",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/hook/providers/ProviderHook.java",
      "status": "modified",
      "additions": 8,
      "deletions": 6,
      "changes": 14,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/839ececef9a4010cd4c9309cbe19237844de0876/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fproviders%2FProviderHook.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/839ececef9a4010cd4c9309cbe19237844de0876/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fproviders%2FProviderHook.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fproviders%2FProviderHook.java?ref=839ececef9a4010cd4c9309cbe19237844de0876",
      "patch": "@@ -185,15 +185,17 @@ public Object invoke(Object proxy, Method method, Object... args) throws Throwab\n             } else if (\"query\".equals(name)) {\n                 Uri url = (Uri) args[start];\n                 String[] projection = (String[]) args[start + 1];\n-                String selection;\n-                String[] selectionArgs;\n-                String sortOrder;\n+                String selection = null;\n+                String[] selectionArgs = null;\n+                String sortOrder = null;\n                 Bundle queryArgs = null;\n                 if (Build.VERSION.SDK_INT >= 26) {\n                     queryArgs = (Bundle) args[start + 2];\n-                    selection = queryArgs.getString(QUERY_ARG_SQL_SELECTION);\n-                    selectionArgs = queryArgs.getStringArray(QUERY_ARG_SQL_SELECTION_ARGS);\n-                    sortOrder = queryArgs.getString(QUERY_ARG_SQL_SORT_ORDER);\n+                    if (queryArgs != null) {\n+                        selection = queryArgs.getString(QUERY_ARG_SQL_SELECTION);\n+                        selectionArgs = queryArgs.getStringArray(QUERY_ARG_SQL_SELECTION_ARGS);\n+                        sortOrder = queryArgs.getString(QUERY_ARG_SQL_SORT_ORDER);\n+                    }\n                 } else {\n                     selection = (String) args[start + 2];\n                     selectionArgs = (String[]) args[start + 3];",
      "parent_sha": "e26223486f8265e646dd826dbac3f17a45b2f18e"
    }
  },
  {
    "oid": "f7b9ae3ffbd4f39142db51802deafc482af9d573",
    "message": "[Exposed-UI] use lambda instead",
    "date": "2018-06-06T06:12:31Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/f7b9ae3ffbd4f39142db51802deafc482af9d573",
    "details": {
      "sha": "66f19d8825fc89af31808504516b1419614d6c31",
      "filename": "VirtualApp/app/src/main/java/io/virtualapp/VApp.java",
      "status": "modified",
      "additions": 6,
      "deletions": 10,
      "changes": 16,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/f7b9ae3ffbd4f39142db51802deafc482af9d573/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2FVApp.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/f7b9ae3ffbd4f39142db51802deafc482af9d573/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2FVApp.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2FVApp.java?ref=f7b9ae3ffbd4f39142db51802deafc482af9d573",
      "patch": "@@ -7,7 +7,6 @@\n import android.util.Log;\n \n import com.flurry.android.FlurryAgent;\n-import com.lody.virtual.client.core.CrashHandler;\n import com.lody.virtual.client.core.InstallStrategy;\n import com.lody.virtual.client.core.VirtualCore;\n import com.lody.virtual.client.stub.VASettings;\n@@ -127,15 +126,12 @@ public void onVirtualProcess() {\n                 virtualCore.setPhoneInfoDelegate(new MyPhoneInfoDelegate());\n                 //fake task description's icon and title\n                 virtualCore.setTaskDescriptionDelegate(new MyTaskDescriptionDelegate());\n-                virtualCore.setCrashHandler(new CrashHandler() {\n-                    @Override\n-                    public void handleUncaughtException(Thread t, Throwable e) {\n-                        Log.i(TAG, \"uncaught :\" + t, e);\n-                        if (t == Looper.getMainLooper().getThread()) {\n-                            System.exit(0);\n-                        } else {\n-                            Log.e(TAG, \"ignore uncaught exception of thread: \" + t);\n-                        }\n+                virtualCore.setCrashHandler((t, e) -> {\n+                    Log.i(TAG, \"uncaught :\" + t, e);\n+                    if (t == Looper.getMainLooper().getThread()) {\n+                        System.exit(0);\n+                    } else {\n+                        Log.e(TAG, \"ignore uncaught exception of thread: \" + t);\n                     }\n                 });\n                 // ensure the logcat service alive when every virtual process start.",
      "parent_sha": "51ec0732d9dbad2cc1023c035971e5f34345274a"
    }
  },
  {
    "oid": "16a431516f815100f02810cf30383e361705beae",
    "message": "Fix: Notification(HOST) bug.",
    "date": "2017-04-11T00:24:18Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/16a431516f815100f02810cf30383e361705beae",
    "details": {
      "sha": "fe6dc5bdf7d47088f4cbf81c4bca5974c962a488",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/hook/proxies/notification/MethodProxies.java",
      "status": "modified",
      "additions": 20,
      "deletions": 22,
      "changes": 42,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/16a431516f815100f02810cf30383e361705beae/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fproxies%2Fnotification%2FMethodProxies.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/16a431516f815100f02810cf30383e361705beae/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fproxies%2Fnotification%2FMethodProxies.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fproxies%2Fnotification%2FMethodProxies.java?ref=16a431516f815100f02810cf30383e361705beae",
      "patch": "@@ -8,14 +8,14 @@\n import com.lody.virtual.client.hook.utils.MethodParameterUtils;\n import com.lody.virtual.client.ipc.VNotificationManager;\n import com.lody.virtual.helper.utils.ArrayUtils;\n-import com.lody.virtual.helper.utils.VLog;\n \n import java.lang.reflect.Method;\n \n /**\n  * @author Lody\n  */\n \n+@SuppressWarnings(\"unused\")\n class MethodProxies {\n \n     static class EnqueueNotification extends MethodProxy {\n@@ -27,8 +27,10 @@ public String getMethodName() {\n \n         @Override\n         public Object call(Object who, Method method, Object... args) throws Throwable {\n-            //enqueueNotification(pkg, id, notification, idOut);\n             String pkg = (String) args[0];\n+            if (getHostPkg().equals(pkg)) {\n+                return method.invoke(who, args);\n+            }\n             int notificationIndex = ArrayUtils.indexOfFirst(args, Notification.class);\n             int idIndex = ArrayUtils.indexOfFirst(args, Integer.class);\n             int id = (int) args[idIndex];\n@@ -64,15 +66,17 @@ public Object call(Object who, Method method, Object... args) throws Throwable {\n             //24 enqueueNotificationWithTag(pkg, mContext.getOpPackageName(), tag, id, notification, idOut, user.getIdentifier());\n             //25 enqueueNotificationWithTag(pkg, mContext.getOpPackageName(), tag, id, notification, idOut, user.getIdentifier());\n             String pkg = (String) args[0];\n+            if (getHostPkg().equals(pkg)) {\n+                return method.invoke(who, args);\n+            }\n             int notificationIndex = ArrayUtils.indexOfFirst(args, Notification.class);\n             int idIndex = ArrayUtils.indexOfFirst(args, Integer.class);\n             int tagIndex = (Build.VERSION.SDK_INT >= 18 ? 2 : 1);\n             int id = (int) args[idIndex];\n-    //        int user = (Build.VERSION.SDK_INT>=17?((int)args[args.length-1]):0);\n             String tag = (String) args[tagIndex];\n \n             id = VNotificationManager.get().dealNotificationId(id, pkg, tag, getAppUserId());\n-            tag= VNotificationManager.get().dealNotificationTag(id, pkg, tag, getAppUserId());\n+            tag = VNotificationManager.get().dealNotificationTag(id, pkg, tag, getAppUserId());\n             args[idIndex] = id;\n             args[tagIndex] = tag;\n             //key(tag,id)\n@@ -106,25 +110,17 @@ public String getMethodName() {\n \n         @Override\n         public Object call(Object who, Method method, Object... args) throws Throwable {\n-            //15 cancelNotificationWithTag(pkg, tag, id);\n-            //16 cancelNotificationWithTag(pkg, tag, id);\n-            //17 cancelNotificationWithTag(pkg, tag, id, UserHandle.myUserId());\n-            //18 cancelNotificationWithTag(pkg, tag, id, UserHandle.myUserId());\n-            //19 cancelNotificationWithTag(pkg, tag, id, UserHandle.myUserId());\n-            //21 cancelNotificationWithTag(pkg, tag, id, UserHandle.myUserId());\n-            //22 cancelNotificationWithTag(pkg, tag, id, UserHandle.myUserId());\n-            //23 cancelNotificationWithTag(pkg, tag, id, UserHandle.myUserId());\n-            //24 cancelNotificationWithTag(pkg, tag, id, user.getIdentifier());\n-            //25 cancelNotificationWithTag(pkg, tag, id, user.getIdentifier());\n             String pkg = MethodParameterUtils.replaceFirstAppPkg(args);\n+            if (getHostPkg().equals(pkg)) {\n+                return method.invoke(who, args);\n+            }\n             String tag = (String) args[1];\n             int id = (int) args[2];\n             id = VNotificationManager.get().dealNotificationId(id, pkg, tag, getAppUserId());\n             tag = VNotificationManager.get().dealNotificationTag(id, pkg, tag, getAppUserId());\n \n             args[1] = tag;\n             args[2] = id;\n-            VLog.d(\"notification\", \"need cancel \" + tag + \" \" + id);\n             return method.invoke(who, args);\n         }\n     }\n@@ -142,10 +138,6 @@ public String getMethodName() {\n         @Override\n         public Object call(Object who, Method method, Object... args) throws Throwable {\n             String pkg = MethodParameterUtils.replaceFirstAppPkg(args);\n-    //        int user = 0;\n-    //        if (Build.VERSION.SDK_INT >= 17) {\n-    //            user = (int) args[1];\n-    //        }\n             if (VirtualCore.get().isAppInstalled(pkg)) {\n                 VNotificationManager.get().cancelAllNotification(pkg, getAppUserId());\n                 return 0;\n@@ -162,9 +154,11 @@ public String getMethodName() {\n \n         @Override\n         public Object call(Object who, Method method, Object... args) throws Throwable {\n-            String pkg  = (String) args[0];\n+            String pkg = (String) args[0];\n+            if (getHostPkg().equals(pkg)) {\n+                return method.invoke(who, args);\n+            }\n             return VNotificationManager.get().areNotificationsEnabledForPackage(pkg, getAppUserId());\n-    //        return super.call(who, method, args);\n         }\n     }\n \n@@ -173,9 +167,13 @@ static class SetNotificationsEnabledForPackage extends MethodProxy {\n         public String getMethodName() {\n             return \"setNotificationsEnabledForPackage\";\n         }\n+\n         @Override\n         public Object call(Object who, Method method, Object... args) throws Throwable {\n-            String pkg  = (String) args[0];\n+            String pkg = (String) args[0];\n+            if (getHostPkg().equals(pkg)) {\n+                return method.invoke(who, args);\n+            }\n             int enableIndex = ArrayUtils.indexOfFirst(args, Boolean.class);\n             boolean enable = (boolean) args[enableIndex];\n             VNotificationManager.get().setNotificationsEnabledForPackage(pkg, enable, getAppUserId());",
      "parent_sha": "72e202642a5be788e862d1038c44d5addf4c247d"
    }
  },
  {
    "oid": "049d635d8213badaeca50c7db6a57f648f91bd81",
    "message": "[Exposed-Fix]: fix random error on Android O.\n\n Above Android O, dex load mode has changed:\n 1. dynamic loaded dex's compiler-filter is 'quicken', which is kind of interpreter mode; but before android o, dynamic loaded code is compiled by no means; (refer Android O: http://androidxref.com/8.0.0_r4/xref/art/runtime/oat_file_assistant.h#52, Android N: http://androidxref.com/7.1.2_r36/xref/art/runtime/oat_file_manager.cc#42)\n 2. odex location is fixed, (dexfile/../oat/<arch>/base.odex), we can not use custom location.\n 3. a new vdex is appeared, which is the same directory of odex.\n\n If the odex location is incorrect, the odex may re-generate. In VA, we force compiler-mode, this may interrupt the rule and cause random crash. So, we just assign the correct location of odex to solve the problem.",
    "date": "2018-06-06T06:11:27Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/049d635d8213badaeca50c7db6a57f648f91bd81",
    "details": {
      "sha": "cb865c3b0191dca57b657f13e5b05865ca6654c7",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/os/VEnvironment.java",
      "status": "modified",
      "additions": 14,
      "deletions": 1,
      "changes": 15,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/049d635d8213badaeca50c7db6a57f648f91bd81/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fos%2FVEnvironment.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/049d635d8213badaeca50c7db6a57f648f91bd81/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fos%2FVEnvironment.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fos%2FVEnvironment.java?ref=049d635d8213badaeca50c7db6a57f648f91bd81",
      "patch": "@@ -9,6 +9,8 @@\n \n import java.io.File;\n \n+import mirror.dalvik.system.VMRuntime;\n+\n /**\n  * @author Lody\n  */\n@@ -116,7 +118,14 @@ public static File getDalvikCacheDirectory() {\n     }\n \n     public static File getOdexFile(String packageName) {\n-        return new File(DALVIK_CACHE_DIRECTORY, \"base.odex\");\n+        if (isAndroidO()) {\n+            // in Android O, the oatfile is relate with classloader, we must ensure the correct location to avoid repeated load dex.\n+            String instructionSet = VMRuntime.getCurrentInstructionSet.call();\n+            File oatDir = ensureCreated(new File(getDataAppPackageDirectory(packageName), \"oat\" + File.separator + instructionSet));\n+            return new File(oatDir, \"base.odex\");\n+        } else {\n+            return new File(DALVIK_CACHE_DIRECTORY, \"data@app@\" + packageName + \"-1@base.apk@classes.dex\");\n+        }\n     }\n \n     public static File getDataAppPackageDirectory(String packageName) {\n@@ -158,4 +167,8 @@ public static File getSystemSecureDirectory() {\n     public static File getPackageInstallerStageDir() {\n         return ensureCreated(new File(DATA_DIRECTORY, \".session_dir\"));\n     }\n+\n+    public static boolean isAndroidO() {\n+        return Build.VERSION.SDK_INT > 25;\n+    }\n }\n\\ No newline at end of file",
      "parent_sha": "6005cf47e21d0eb82c2677fb81b91c91062d7b71"
    }
  },
  {
    "oid": "736656986d164e4bbbe6a644ce733d681187a9a6",
    "message": "Code: update version.",
    "date": "2017-02-27T14:17:07Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/736656986d164e4bbbe6a644ce733d681187a9a6",
    "details": {
      "sha": "dcea809e52145bc708ed773d6c84dceb4a6b4f43",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/Version.java",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/736656986d164e4bbbe6a644ce733d681187a9a6/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2FVersion.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/736656986d164e4bbbe6a644ce733d681187a9a6/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2FVersion.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2FVersion.java?ref=736656986d164e4bbbe6a644ce733d681187a9a6",
      "patch": "@@ -10,7 +10,7 @@\n \n public class Version {\n \n-    public static final String VERSION_NAME = \"Build-742-01\";\n+    public static final String VERSION_NAME = \"Build-745-02\";\n \n-    public static final int VERSION_CODE = 7420001;\n+    public static final int VERSION_CODE = 7450002;\n }",
      "parent_sha": "ccef579f4116384e08f3c48b77b0ba7415e962e3"
    }
  },
  {
    "oid": "83582bcc83069dc0e4f7d804cbbc310b5e704283",
    "message": "Fix: a thread-safe problem.",
    "date": "2016-08-06T09:21:03Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/83582bcc83069dc0e4f7d804cbbc310b5e704283",
    "details": {
      "sha": "7fa22bbcb68ac4c4a55dcf0384090111850a1619",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/service/process/VProcessService.java",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/83582bcc83069dc0e4f7d804cbbc310b5e704283/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fservice%2Fprocess%2FVProcessService.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/83582bcc83069dc0e4f7d804cbbc310b5e704283/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fservice%2Fprocess%2FVProcessService.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fservice%2Fprocess%2FVProcessService.java?ref=83582bcc83069dc0e4f7d804cbbc310b5e704283",
      "patch": "@@ -262,7 +262,7 @@ public void binderDied() {\n \t}\n \n \t@Override\n-\tpublic void onAppProcessCreate(IBinder clientBinder, String pkg, String processName) {\n+\tpublic synchronized void onAppProcessCreate(IBinder clientBinder, String pkg, String processName) {\n \t\tfinal int callingPid = Binder.getCallingPid();\n \t\tint uid = Binder.getCallingUid();\n \t\tIVClient client = IVClient.Stub.asInterface(clientBinder);",
      "parent_sha": "662a75df0aa45f2af8eb53bb4a138403bae23ad5"
    }
  },
  {
    "oid": "3793967d668e4964c984ab9cb681c02432f18439",
    "message": "[VXP]: fix IllegalArgumentException.",
    "date": "2018-06-30T05:55:52Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/3793967d668e4964c984ab9cb681c02432f18439",
    "details": {
      "sha": "0052e7806d9a221b53ff6d8b967c28cc4b9ba854",
      "filename": "VirtualApp/app/src/main/java/io/virtualapp/home/NewHomeActivity.java",
      "status": "modified",
      "additions": 13,
      "deletions": 2,
      "changes": 15,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/3793967d668e4964c984ab9cb681c02432f18439/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2FNewHomeActivity.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/3793967d668e4964c984ab9cb681c02432f18439/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2FNewHomeActivity.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2FNewHomeActivity.java?ref=3793967d668e4964c984ab9cb681c02432f18439",
      "patch": "@@ -133,13 +133,24 @@ private void installXposed() {\n                     }\n                 }\n             }).then((v) -> {\n-                dialog.dismiss();\n+                dismissDialog(dialog);\n             }).fail((err) -> {\n-                dialog.dismiss();\n+                dismissDialog(dialog);\n             });\n         }\n     }\n \n+    private static void dismissDialog(ProgressDialog dialog) {\n+        if (dialog == null) {\n+            return;\n+        }\n+        try {\n+            dialog.dismiss();\n+        } catch (Throwable e) {\n+            e.printStackTrace();\n+        }\n+    }\n+\n     @Override\n     protected void onResume() {\n         super.onResume();",
      "parent_sha": "61a4b02cfcfe6cc436d0bd181ae88aac5b6fe27d"
    }
  },
  {
    "oid": "8d2cf5f7a97219f1abdac14f3f255507050907c2",
    "message": "[VXP-fix]: fix the shortcut icon error when create multi-shortcut.",
    "date": "2018-06-06T06:13:59Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/8d2cf5f7a97219f1abdac14f3f255507050907c2",
    "details": {
      "sha": "11d509d17cba936150d7d6df4b6de3cf52b360b6",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/core/VirtualCore.java",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/8d2cf5f7a97219f1abdac14f3f255507050907c2/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fcore%2FVirtualCore.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/8d2cf5f7a97219f1abdac14f3f255507050907c2/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fcore%2FVirtualCore.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fcore%2FVirtualCore.java?ref=8d2cf5f7a97219f1abdac14f3f255507050907c2",
      "patch": "@@ -24,6 +24,7 @@\n import android.os.Looper;\n import android.os.Process;\n import android.os.RemoteException;\n+import android.util.Log;\n \n import com.lody.virtual.R;\n import com.lody.virtual.client.VClientImpl;\n@@ -525,8 +526,7 @@ public int compare(ShortcutInfo o1, ShortcutInfo o2) {\n                 shortcutManager.removeDynamicShortcuts(Collections.singletonList(remove.getId()));\n             }\n \n-            dynamicShortcuts.add(likeShortcut);\n-            shortcutManager.addDynamicShortcuts(dynamicShortcuts);\n+            shortcutManager.addDynamicShortcuts(Collections.singletonList(likeShortcut));\n             return true;\n         } catch (Throwable e) {\n             return false;",
      "parent_sha": "7f7339d856860f08fb1a763584157b19be96c0f3"
    }
  },
  {
    "oid": "a7dd31470f5d88c009b869571a847f1133d51d5f",
    "message": "[VXP]: fix animation display exception.",
    "date": "2018-06-30T05:52:56Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/a7dd31470f5d88c009b869571a847f1133d51d5f",
    "details": {
      "sha": "9fd56950ac3ca1f86ee8b3b0ceef605f32164c67",
      "filename": "VirtualApp/app/src/main/java/io/virtualapp/home/LoadingActivity.java",
      "status": "modified",
      "additions": 29,
      "deletions": 4,
      "changes": 33,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/a7dd31470f5d88c009b869571a847f1133d51d5f/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2FLoadingActivity.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/a7dd31470f5d88c009b869571a847f1133d51d5f/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2FLoadingActivity.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2FLoadingActivity.java?ref=a7dd31470f5d88c009b869571a847f1133d51d5f",
      "patch": "@@ -7,6 +7,7 @@\n import android.content.pm.PackageManager;\n import android.os.Bundle;\n import android.os.RemoteException;\n+import android.os.SystemClock;\n import android.support.annotation.NonNull;\n import android.support.v4.app.ActivityCompat;\n import android.support.v4.content.ContextCompat;\n@@ -51,6 +52,8 @@ public class LoadingActivity extends VActivity {\n     private Intent intentToLaunch;\n     private int userToLaunch;\n \n+    private long start;\n+\n     public static void launch(Context context, String packageName, int userId) {\n         Intent intent = VirtualCore.get().getLaunchIntent(packageName, userId);\n         if (intent != null) {\n@@ -63,9 +66,12 @@ public static void launch(Context context, String packageName, int userId) {\n         }\n     }\n \n+\n     @Override\n     protected void onCreate(Bundle savedInstanceState) {\n         super.onCreate(savedInstanceState);\n+        start = SystemClock.elapsedRealtime();\n+\n         setContentView(R.layout.activity_loading);\n         loadingView = (EatBeansView) findViewById(R.id.loading_anim);\n         int userId = getIntent().getIntExtra(KEY_USER, -1);\n@@ -87,13 +93,16 @@ protected void onCreate(Bundle savedInstanceState) {\n             return;\n         }\n         VirtualCore.get().setUiCallback(intent, mUiCallback);\n+        checkAndLaunch(intent, userId);\n+    }\n \n+    private void checkAndLaunch(Intent intent, int userId) {\n         final int RUNTIME_PERMISSION_API_LEVEL = android.os.Build.VERSION_CODES.M;\n \n         if (android.os.Build.VERSION.SDK_INT < RUNTIME_PERMISSION_API_LEVEL) {\n             // the device is below Android M, the permissions are granted when install, start directly\n             Log.i(TAG, \"device's api level below Android M, do not need runtime permission.\");\n-            VActivityManager.get().startActivity(intent, userId);\n+            launchActivity(intent, userId);\n             return;\n         }\n \n@@ -109,7 +118,7 @@ protected void onCreate(Bundle savedInstanceState) {\n \n             if (targetSdkVersion >= RUNTIME_PERMISSION_API_LEVEL) {\n                 Log.i(TAG, \"target package support runtime permission, launch directly.\");\n-                VActivityManager.get().startActivity(intent, userId);\n+                launchActivity(intent, userId);\n             } else {\n \n                 intentToLaunch = intent;\n@@ -133,7 +142,7 @@ protected void onCreate(Bundle savedInstanceState) {\n                 if (dangerousPermissions.isEmpty()) {\n                     Log.i(TAG, \"all permission are granted, launch directly.\");\n                     // all permission are granted, launch directly.\n-                    VActivityManager.get().startActivity(intent, userId);\n+                    launchActivity(intent, userId);\n                 } else {\n                     // tell user that this app need that permission\n                     Log.i(TAG, \"request permission: \" + dangerousPermissions);\n@@ -157,7 +166,19 @@ protected void onCreate(Bundle savedInstanceState) {\n             }\n         } catch (Throwable e) {\n             Log.e(TAG, \"check permission failed: \", e);\n+            launchActivity(intent, userId);\n+        }\n+    }\n+\n+    private void launchActivity(Intent intent, int userId) {\n+        final int MAX_WAIT = 1000;\n+        long delta = SystemClock.elapsedRealtime() - start;\n+        long waitTime = MAX_WAIT - delta;\n+\n+        if (waitTime <= 0) {\n             VActivityManager.get().startActivity(intent, userId);\n+        } else {\n+            loadingView.postDelayed(() -> VActivityManager.get().startActivity(intent, userId), waitTime);\n         }\n     }\n \n@@ -178,7 +199,7 @@ public void onRequestPermissionsResult(int requestCode, @NonNull String[] permis\n                     Toast.makeText(this, getResources().getString(R.string.start_app_failed, appModel.name), Toast.LENGTH_SHORT).show();\n                     finish();\n                 } else {\n-                    VActivityManager.get().startActivity(intentToLaunch, userToLaunch);\n+                    launchActivity(intentToLaunch, userToLaunch);\n                 }\n             } else {\n                 // \u63d0\u793a\u7528\u6237\uff0ctargetSdkVersion < 23 \u65e0\u6cd5\u4f7f\u7528\u8fd0\u884c\u65f6\u6743\u9650\n@@ -223,6 +244,10 @@ public void onOpenFailed(String packageName, int userId) throws RemoteException\n     @Override\n     protected void onResume() {\n         super.onResume();\n+        startAnim();\n+    }\n+\n+    private void startAnim() {\n         if (loadingView != null) {\n             loadingView.startAnim();\n         }",
      "parent_sha": "8010a5a579ac76db55498d9b827cb8ca8978d223"
    }
  },
  {
    "oid": "fcaf9ce0ce96f02bff981a36f867355f4f78f1c4",
    "message": "Fix: issue #293.",
    "date": "2017-04-22T13:25:15Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/fcaf9ce0ce96f02bff981a36f867355f4f78f1c4",
    "details": {
      "sha": "e9324c1f400e8dc9ef9e4008f4d7598490cd479d",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/hook/proxies/pm/MethodProxies.java",
      "status": "modified",
      "additions": 20,
      "deletions": 16,
      "changes": 36,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/fcaf9ce0ce96f02bff981a36f867355f4f78f1c4/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fproxies%2Fpm%2FMethodProxies.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/fcaf9ce0ce96f02bff981a36f867355f4f78f1c4/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fproxies%2Fpm%2FMethodProxies.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fproxies%2Fpm%2FMethodProxies.java?ref=fcaf9ce0ce96f02bff981a36f867355f4f78f1c4",
      "patch": "@@ -380,16 +380,18 @@ public Object call(Object who, Method method, Object... args) throws Throwable {\n             List<ResolveInfo> appResult = VPackageManager.get().queryIntentServices((Intent) args[0],\n                     (String) args[1], (Integer) args[2], userId);\n             Object _hostResult = method.invoke(who, args);\n-            List<ResolveInfo> hostResult = slice ? ParceledListSlice.getList.call(_hostResult)\n-                    : (List) _hostResult;\n-            Iterator<ResolveInfo> iterator = hostResult.iterator();\n-            while (iterator.hasNext()) {\n-                ResolveInfo info = iterator.next();\n-                if (info == null || info.serviceInfo == null || !isVisiblePackage(info.serviceInfo.applicationInfo)) {\n-                    iterator.remove();\n+            if (_hostResult != null) {\n+                List<ResolveInfo> hostResult = slice ? ParceledListSlice.getList.call(_hostResult)\n+                        : (List) _hostResult;\n+                Iterator<ResolveInfo> iterator = hostResult.iterator();\n+                while (iterator.hasNext()) {\n+                    ResolveInfo info = iterator.next();\n+                    if (info == null || info.serviceInfo == null || !isVisiblePackage(info.serviceInfo.applicationInfo)) {\n+                        iterator.remove();\n+                    }\n                 }\n+                appResult.addAll(hostResult);\n             }\n-            appResult.addAll(hostResult);\n             if (slice) {\n                 return ParceledListSliceCompat.create(appResult);\n             }\n@@ -474,16 +476,18 @@ public Object call(Object who, Method method, Object... args) throws Throwable {\n             List<ResolveInfo> appResult = VPackageManager.get().queryIntentActivities((Intent) args[0],\n                     (String) args[1], (Integer) args[2], userId);\n             Object _hostResult = method.invoke(who, args);\n-            List<ResolveInfo> hostResult = slice ? ParceledListSlice.getList.call(_hostResult)\n-                    : (List) _hostResult;\n-            Iterator<ResolveInfo> iterator = hostResult.iterator();\n-            while (iterator.hasNext()) {\n-                ResolveInfo info = iterator.next();\n-                if (info == null || info.activityInfo == null || !isVisiblePackage(info.activityInfo.applicationInfo)) {\n-                    iterator.remove();\n+            if (_hostResult != null) {\n+                List<ResolveInfo> hostResult = slice ? ParceledListSlice.getList.call(_hostResult)\n+                        : (List) _hostResult;\n+                Iterator<ResolveInfo> iterator = hostResult.iterator();\n+                while (iterator.hasNext()) {\n+                    ResolveInfo info = iterator.next();\n+                    if (info == null || info.activityInfo == null || !isVisiblePackage(info.activityInfo.applicationInfo)) {\n+                        iterator.remove();\n+                    }\n                 }\n+                appResult.addAll(hostResult);\n             }\n-            appResult.addAll(hostResult);\n             if (slice) {\n                 return ParceledListSliceCompat.create(appResult);\n             }",
      "parent_sha": "a9d4f444d2d801ee8c0d14bb5b76bda31e605672"
    }
  },
  {
    "oid": "9596065888f3eb948f03be05a0606bba10af14bd",
    "message": "Fix: provider not install bug.",
    "date": "2017-10-27T12:01:48Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/9596065888f3eb948f03be05a0606bba10af14bd",
    "details": {
      "sha": "b28a6f519de0ac8e7b49e8329dee4c9ad59e873d",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/VClientImpl.java",
      "status": "modified",
      "additions": 5,
      "deletions": 6,
      "changes": 11,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/9596065888f3eb948f03be05a0606bba10af14bd/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2FVClientImpl.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/9596065888f3eb948f03be05a0606bba10af14bd/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2FVClientImpl.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2FVClientImpl.java?ref=9596065888f3eb948f03be05a0606bba10af14bd",
      "patch": "@@ -15,6 +15,7 @@\n import android.os.Binder;\n import android.os.Build;\n import android.os.ConditionVariable;\n+import android.os.Debug;\n import android.os.Handler;\n import android.os.IBinder;\n import android.os.IInterface;\n@@ -465,12 +466,10 @@ private void installContentProviders(Context app, List<ProviderInfo> providers)\n         Object mainThread = VirtualCore.mainThread();\n         try {\n             for (ProviderInfo cpi : providers) {\n-                if (cpi.enabled) {\n-                    try {\n-                        ActivityThread.installProvider(mainThread, app, cpi, null);\n-                    } catch (Throwable e) {\n-                        e.printStackTrace();\n-                    }\n+                try {\n+                    ActivityThread.installProvider(mainThread, app, cpi, null);\n+                } catch (Throwable e) {\n+                    e.printStackTrace();\n                 }\n             }\n         } finally {",
      "parent_sha": "e6efdc58d0621b29f0db49e762be430cdbdcef75"
    }
  },
  {
    "oid": "c2e2ded483caa7a2fa77ff2b92fd96eb454116ce",
    "message": "Update VirtualCore.java\n\nFIX bug when activity info null",
    "date": "2016-09-19T12:24:04Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/c2e2ded483caa7a2fa77ff2b92fd96eb454116ce",
    "details": {
      "sha": "d8faf4b880600f8ac4b03a95e8513c5575414580",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/core/VirtualCore.java",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/c2e2ded483caa7a2fa77ff2b92fd96eb454116ce/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fcore%2FVirtualCore.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/c2e2ded483caa7a2fa77ff2b92fd96eb454116ce/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fcore%2FVirtualCore.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fcore%2FVirtualCore.java?ref=c2e2ded483caa7a2fa77ff2b92fd96eb454116ce",
      "patch": "@@ -344,7 +344,7 @@ public synchronized ActivityInfo resolveActivityInfo(Intent intent, int userId)\n \t\t} else {\n \t\t\tactivityInfo = resolveActivityInfo(intent.getComponent(), userId);\n \t\t}\n-\t\treturn new ActivityInfo(activityInfo);\n+\t\treturn activityInfo != null ? new ActivityInfo(activityInfo) : null;\n \t}\n \n \tpublic ActivityInfo resolveActivityInfo(ComponentName componentName, int userId) {",
      "parent_sha": "53c1c348fb240ec37eea622290477c24d4f0d9f3"
    }
  },
  {
    "oid": "c54a46e8fee74f893c8e5da89ff9970a3a9c5d0f",
    "message": "Fix : problem when acquire provider.",
    "date": "2016-09-02T14:17:34Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/c54a46e8fee74f893c8e5da89ff9970a3a9c5d0f",
    "details": {
      "sha": "ddb19af4ee42e8d409ae29474dca8380df588420",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/VClientImpl.java",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/c54a46e8fee74f893c8e5da89ff9970a3a9c5d0f/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2FVClientImpl.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/c54a46e8fee74f893c8e5da89ff9970a3a9c5d0f/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2FVClientImpl.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2FVClientImpl.java?ref=c54a46e8fee74f893c8e5da89ff9970a3a9c5d0f",
      "patch": "@@ -274,7 +274,7 @@ public void bindApplication(String processName, ApplicationInfo appInfo, List<St\n \t@Override\n \tpublic IBinder acquireProviderClient(ProviderInfo info) {\n \t\tif (Binder.getCallingPid() != Process.myPid()) {\n-\t\t\tif (!isBound() || !isProviderInitialized) {\n+\t\t\tif (!isBound() && !isProviderInitialized) {\n \t\t\t\tlock.block();\n \t\t\t}\n \t\t}",
      "parent_sha": "022a93a9e4540a8b3e797218352b68ab8605eb8e"
    }
  },
  {
    "oid": "3d0830c91bbd0bce90803b7148c7d6f99114d05c",
    "message": "6.0\u7684notification\u7684\u70b9\u51fb\u4e8b\u4ef6",
    "date": "2016-08-07T12:19:18Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/3d0830c91bbd0bce90803b7148c7d6f99114d05c",
    "details": {
      "sha": "bae4f872fd61fd3691c8a866971c79ec7a37d3e0",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/hook/patchs/notification/compat/NotificaitionUtils.java",
      "status": "modified",
      "additions": 20,
      "deletions": 9,
      "changes": 29,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/3d0830c91bbd0bce90803b7148c7d6f99114d05c/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fnotification%2Fcompat%2FNotificaitionUtils.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/3d0830c91bbd0bce90803b7148c7d6f99114d05c/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fnotification%2Fcompat%2FNotificaitionUtils.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fnotification%2Fcompat%2FNotificaitionUtils.java?ref=3d0830c91bbd0bce90803b7148c7d6f99114d05c",
      "patch": "@@ -1,14 +1,5 @@\n package com.lody.virtual.client.hook.patchs.notification.compat;\n \n-import java.lang.reflect.Field;\n-import java.lang.reflect.Modifier;\n-import java.util.HashMap;\n-import java.util.Map;\n-\n-import com.lody.virtual.client.core.VirtualCore;\n-import com.lody.virtual.helper.utils.Reflect;\n-import com.lody.virtual.helper.utils.VLog;\n-\n import android.app.Notification;\n import android.content.Context;\n import android.content.pm.ApplicationInfo;\n@@ -22,6 +13,15 @@\n import android.os.Bundle;\n import android.widget.RemoteViews;\n \n+import com.lody.virtual.client.core.VirtualCore;\n+import com.lody.virtual.helper.utils.Reflect;\n+import com.lody.virtual.helper.utils.VLog;\n+\n+import java.lang.reflect.Field;\n+import java.lang.reflect.Modifier;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n /***\n  * \u901a\u77e5\u680f\u7684\u5305\u540d\u5224\u65ad\n  */\n@@ -202,6 +202,17 @@ public static Notification clone(Context context, Notification notification) {\n \t\t}\n \t\tnotification1.flags = notification.flags;\n \t\tnotification1.icon = notification.icon;\n+\n+        //intent\n+        if(notification1.contentIntent == null){\n+            notification1.contentIntent = notification.contentIntent;\n+        }\n+        if(notification1.deleteIntent == null){\n+            notification1.deleteIntent = notification.deleteIntent;\n+        }\n+        if(notification1.fullScreenIntent == null){\n+            notification1.fullScreenIntent = notification.fullScreenIntent;\n+        }\n \t\t///\n \t\tif (notification1.contentView == null) {\n \t\t\tnotification1.contentView = notification.contentView;",
      "parent_sha": "95e68aa2f93824b6826773cdb357eaea62051938"
    }
  },
  {
    "oid": "5ddd1f69aaa1a2bb88d423196b42c1644ae99146",
    "message": "Fix: Install/Uninstall broadcast bug.",
    "date": "2017-04-06T14:17:32Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/5ddd1f69aaa1a2bb88d423196b42c1644ae99146",
    "details": {
      "sha": "8d66e1e632d6572278f467b457e29c719512df03",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/server/pm/VAppManagerService.java",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/5ddd1f69aaa1a2bb88d423196b42c1644ae99146/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fpm%2FVAppManagerService.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/5ddd1f69aaa1a2bb88d423196b42c1644ae99146/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fpm%2FVAppManagerService.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fpm%2FVAppManagerService.java?ref=5ddd1f69aaa1a2bb88d423196b42c1644ae99146",
      "patch": "@@ -454,13 +454,13 @@ private void notifyAppUninstalled(PackageSetting setting, int userId) {\n \n     private void sendInstalledBroadcast(String packageName) {\n         Intent intent = new Intent(Intent.ACTION_PACKAGE_ADDED);\n-        intent.setData(Uri.parse(\"package://\" + packageName));\n+        intent.setData(Uri.parse(\"package:\" + packageName));\n         VActivityManagerService.get().sendBroadcastAsUser(intent, VUserHandle.ALL);\n     }\n \n     private void sendUninstalledBroadcast(String packageName) {\n         Intent intent = new Intent(Intent.ACTION_PACKAGE_REMOVED);\n-        intent.setData(Uri.parse(\"package://\" + packageName));\n+        intent.setData(Uri.parse(\"package:\" + packageName));\n         VActivityManagerService.get().sendBroadcastAsUser(intent, VUserHandle.ALL);\n     }\n ",
      "parent_sha": "90e9e7e8b68dff04db6581f875739ed75cea0777"
    }
  },
  {
    "oid": "9855d660a53e8c15dc6c588a18fac1a35bb1d8e5",
    "message": "[Exposed-UI] fix bad token exception on meizu.",
    "date": "2018-06-06T06:12:30Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/9855d660a53e8c15dc6c588a18fac1a35bb1d8e5",
    "details": {
      "sha": "728ec174aa296131f2150215ca0ea875cc98d9a8",
      "filename": "VirtualApp/app/src/main/java/io/virtualapp/home/HomeActivity.java",
      "status": "modified",
      "additions": 3,
      "deletions": 1,
      "changes": 4,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/9855d660a53e8c15dc6c588a18fac1a35bb1d8e5/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2FHomeActivity.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/9855d660a53e8c15dc6c588a18fac1a35bb1d8e5/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2FHomeActivity.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2FHomeActivity.java?ref=9855d660a53e8c15dc6c588a18fac1a35bb1d8e5",
      "patch": "@@ -565,7 +565,9 @@ private void alertForMeizu() {\n                     .setPositiveButton(android.R.string.yes, (dialog, which) -> {\n                     })\n                     .create();\n-            alertDialog.show();\n+            try {\n+                alertDialog.show();\n+            } catch (Throwable ignored) {}\n         }, 2000);\n     }\n }",
      "parent_sha": "67d46876294d74e9a3448a97773f5ea1e10faca1"
    }
  },
  {
    "oid": "d9f231b2a46d5f379c8a1e40c74a101211dfd6bb",
    "message": "Code: optmize the code.",
    "date": "2016-09-19T12:28:51Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/d9f231b2a46d5f379c8a1e40c74a101211dfd6bb",
    "details": {
      "sha": "db014b37223838544e9eec1a51635a62f8474323",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/core/VirtualCore.java",
      "status": "modified",
      "additions": 9,
      "deletions": 13,
      "changes": 22,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/d9f231b2a46d5f379c8a1e40c74a101211dfd6bb/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fcore%2FVirtualCore.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/d9f231b2a46d5f379c8a1e40c74a101211dfd6bb/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fcore%2FVirtualCore.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fcore%2FVirtualCore.java?ref=d9f231b2a46d5f379c8a1e40c74a101211dfd6bb",
      "patch": "@@ -28,6 +28,7 @@\n import com.lody.virtual.helper.compat.BundleCompat;\n import com.lody.virtual.helper.proto.AppSetting;\n import com.lody.virtual.helper.proto.InstallResult;\n+import com.lody.virtual.helper.utils.ComponentUtils;\n import com.lody.virtual.os.VUserHandle;\n import com.lody.virtual.service.IAppManager;\n \n@@ -153,7 +154,7 @@ public void startup(Context context) throws Throwable {\n \t\t\tPatchManager patchManager = PatchManager.getInstance();\n \t\t\tpatchManager.init();\n \t\t\tpatchManager.injectAll();\n-            ContextFixer.fixContext(context);\n+\t\t\tContextFixer.fixContext(context);\n \t\t\tisStartUp = true;\n \t\t\tif (initLock != null) {\n \t\t\t\tinitLock.open();\n@@ -329,27 +330,22 @@ public synchronized ActivityInfo resolveActivityInfo(Intent intent, int userId)\n \t\tif (intent.getComponent() == null) {\n \t\t\tResolveInfo resolveInfo = VPackageManager.get().resolveIntent(intent, intent.getType(), 0, 0);\n \t\t\tif (resolveInfo != null && resolveInfo.activityInfo != null) {\n-\t\t\t\tif (resolveInfo.activityInfo.targetActivity != null) {\n-\t\t\t\t\tComponentName componentName = new ComponentName(resolveInfo.activityInfo.packageName, resolveInfo.activityInfo.targetActivity);\n-\t\t\t\t\tresolveInfo.activityInfo = VPackageManager.get().getActivityInfo(componentName, 0, userId);\n+\t\t\t\tactivityInfo = resolveInfo.activityInfo;\n+\t\t\t\tif (activityInfo.targetActivity != null) {\n+\t\t\t\t\tComponentName componentName = new ComponentName(activityInfo.packageName, activityInfo.targetActivity);\n+\t\t\t\t\tactivityInfo = VPackageManager.get().getActivityInfo(componentName, 0, userId);\n \t\t\t\t\tif (intent.getComponent() != null) {\n \t\t\t\t\t\tintent.setComponent(componentName);\n \t\t\t\t\t}\n \t\t\t\t}\n-\t\t\t\tactivityInfo = resolveInfo.activityInfo;\n-\t\t\t\tif (intent.getComponent() == null) {\n-\t\t\t\t\tintent.setClassName(activityInfo.packageName, activityInfo.name);\n-\t\t\t\t}\n+\t\t\t\tintent.setComponent(ComponentUtils.toComponentName(activityInfo));\n \t\t\t}\n \t\t} else {\n-\t\t\tactivityInfo = resolveActivityInfo(intent.getComponent(), userId);\n+\t\t\tactivityInfo = VPackageManager.get().getActivityInfo(intent.getComponent(), 0, userId);\n \t\t}\n-\t\treturn new ActivityInfo(activityInfo);\n+\t\treturn activityInfo;\n \t}\n \n-\tpublic ActivityInfo resolveActivityInfo(ComponentName componentName, int userId) {\n-\t\treturn VPackageManager.get().getActivityInfo(componentName, 0, userId);\n-\t}\n \n \tpublic ServiceInfo resolveServiceInfo(Intent intent, int userId) {\n \t\tServiceInfo serviceInfo = null;",
      "parent_sha": "53c1c348fb240ec37eea622290477c24d4f0d9f3"
    }
  },
  {
    "oid": "1d608933cb53961f9db1e4a257fd021a9fb666b8",
    "message": "[VXP]: support launch app for develop mode.",
    "date": "2018-06-06T06:14:43Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/1d608933cb53961f9db1e4a257fd021a9fb666b8",
    "details": {
      "sha": "02c4bad51c6b0ef1c3032a6e414c7e8d708f3402",
      "filename": "VirtualApp/app/src/main/java/io/virtualapp/dev/CmdReceiver.java",
      "status": "modified",
      "additions": 11,
      "deletions": 1,
      "changes": 12,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/1d608933cb53961f9db1e4a257fd021a9fb666b8/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fdev%2FCmdReceiver.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/1d608933cb53961f9db1e4a257fd021a9fb666b8/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fdev%2FCmdReceiver.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fdev%2FCmdReceiver.java?ref=1d608933cb53961f9db1e4a257fd021a9fb666b8",
      "patch": "@@ -12,6 +12,8 @@\n import com.lody.virtual.client.core.VirtualCore;\n import com.lody.virtual.remote.InstallResult;\n \n+import io.virtualapp.home.LoadingActivity;\n+\n /**\n  * author: weishu on 18/2/23.\n  */\n@@ -24,6 +26,7 @@ public class CmdReceiver extends BroadcastReceiver {\n \n     private static final String CMD_UPDATE = \"update\";\n     private static final String CMD_REBOOT = \"reboot\";\n+    private static final String CMD_LAUNCH = \"launch\";\n \n     @Override\n     public void onReceive(Context context, Intent intent) {\n@@ -47,7 +50,7 @@ public void onReceive(Context context, Intent intent) {\n         if (CMD_UPDATE.equalsIgnoreCase(cmd)) {\n             String pkg = intent.getStringExtra(KEY_PKG);\n             if (TextUtils.isEmpty(pkg)) {\n-                showTips(context, \"Please give me the update package!!\");\n+                showTips(context, \"Please tell me the update package!!\");\n                 return;\n             }\n \n@@ -71,6 +74,13 @@ public void onReceive(Context context, Intent intent) {\n             } catch (PackageManager.NameNotFoundException e) {\n                 showTips(context, \"Can not found \" + pkg + \" outside!\");\n             }\n+        } else if (CMD_LAUNCH.equalsIgnoreCase(cmd)) {\n+            String pkg = intent.getStringExtra(KEY_PKG);\n+            if (TextUtils.isEmpty(pkg)) {\n+                showTips(context, \"Please tell me the launch package!!\");\n+                return;\n+            }\n+            LoadingActivity.launch(context, pkg, 0);\n         }\n     }\n ",
      "parent_sha": "94cc73ab3c8c2b6a0e91c7297d588c917b4c2d48"
    }
  },
  {
    "oid": "5dc95a8d21eb9ccdae130620345fc4ee335dafc8",
    "message": "Fix: null ptr.",
    "date": "2017-07-21T16:28:32Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/5dc95a8d21eb9ccdae130620345fc4ee335dafc8",
    "details": {
      "sha": "fbebc75bc786f336192359b2f4a7cc636cc5634e",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/server/am/VActivityManagerService.java",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/5dc95a8d21eb9ccdae130620345fc4ee335dafc8/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fam%2FVActivityManagerService.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/5dc95a8d21eb9ccdae130620345fc4ee335dafc8/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fam%2FVActivityManagerService.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fam%2FVActivityManagerService.java?ref=5dc95a8d21eb9ccdae130620345fc4ee335dafc8",
      "patch": "@@ -219,7 +219,7 @@ private void processDead(ProcessRecord record) {\n             Iterator<ServiceRecord> iterator = mHistory.iterator();\n             while (iterator.hasNext()) {\n                 ServiceRecord r = iterator.next();\n-                if (r.process.pid == record.pid) {\n+                if (r.process != null && r.process.pid == record.pid) {\n                     iterator.remove();\n                 }\n             }",
      "parent_sha": "0d16f1988ca120f5aa6a0b6305cf7ffd5c4defa9"
    }
  },
  {
    "oid": "95904fa186b38d8716df333628e70c47cb2d21aa",
    "message": "Fix StubPendingService: use realIntent to start service",
    "date": "2017-05-03T12:06:42Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/95904fa186b38d8716df333628e70c47cb2d21aa",
    "details": {
      "sha": "62aa6e75d7014adec3eb62840e2a6903de566b8c",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/stub/StubPendingService.java",
      "status": "modified",
      "additions": 9,
      "deletions": 1,
      "changes": 10,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/95904fa186b38d8716df333628e70c47cb2d21aa/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fstub%2FStubPendingService.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/95904fa186b38d8716df333628e70c47cb2d21aa/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fstub%2FStubPendingService.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fstub%2FStubPendingService.java?ref=95904fa186b38d8716df333628e70c47cb2d21aa",
      "patch": "@@ -1,5 +1,7 @@\n package com.lody.virtual.client.stub;\n \n+import com.lody.virtual.client.ipc.VActivityManager;\n+\n import android.app.Service;\n import android.content.Intent;\n import android.os.IBinder;\n@@ -18,7 +20,13 @@ public IBinder onBind(Intent intent) {\n     @Override\n     public int onStartCommand(Intent intent, int flags, int startId) {\n         // _VA_|_from_inner_ marked\n-        startService(intent);\n+        if (intent != null) {\n+            Intent realIntent = intent.getParcelableExtra(\"_VA_|_intent_\");\n+            int userId = intent.getIntExtra(\"_VA_|_user_id_\", 0);\n+            if (realIntent != null) {\n+                VActivityManager.get().startService(null, realIntent, null, userId);\n+            }\n+        }\n         stopSelf();\n         return START_NOT_STICKY;\n     }",
      "parent_sha": "9dce1a01b267ed5ea9d85004cd9d4802aca8b323"
    }
  },
  {
    "oid": "25e540133722c26ae8d2738447e1db0d68c4768c",
    "message": "fix first start activity with flag=0x24000000",
    "date": "2017-03-31T10:52:34Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/25e540133722c26ae8d2738447e1db0d68c4768c",
    "details": {
      "sha": "a7f9970b8bcbed6f6b0c71c33c4baa0907536286",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/server/am/ActivityStack.java",
      "status": "modified",
      "additions": 9,
      "deletions": 1,
      "changes": 10,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/25e540133722c26ae8d2738447e1db0d68c4768c/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fam%2FActivityStack.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/25e540133722c26ae8d2738447e1db0d68c4768c/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fam%2FActivityStack.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fam%2FActivityStack.java?ref=25e540133722c26ae8d2738447e1db0d68c4768c",
      "patch": "@@ -327,7 +327,7 @@ int startActivityLocked(int userId, Intent intent, ActivityInfo info, IBinder re\n                     deliverNewIntentLocked(sourceRecord, topRecord, intent);\n                     delivered = true;\n                 }\n-                if (isClearTop_SingleTop) {\n+                if (isClearTop_SingleTop && hasActivity(topRecord, intent.getComponent())) {\n                     topRecord.marked = false;\n                     deliverNewIntentLocked(sourceRecord, topRecord, intent);\n                     delivered = true;\n@@ -612,6 +612,14 @@ ComponentName getActivityClassForToken(int userId, IBinder token) {\n         }\n     }\n \n+    private boolean hasActivity(ActivityRecord topRecord, ComponentName component) {\n+        for (ActivityRecord ar : topRecord.task.activities) {\n+            if (component.equals(ar.component)) {\n+                return true;\n+            }\n+        }\n+        return false;\n+    }\n \n     private enum ClearTarget {\n         NOTHING,",
      "parent_sha": "e19c74f45ff9262b94b91cfa993774c5cadf6161"
    }
  },
  {
    "oid": "5c9a95ff0cce42dd3ab55aa40c0bd09369d1ca09",
    "message": "Android 12: Fix junit\n\nSigned-off-by: tiann <twsxtd@gmail.com>",
    "date": "2022-04-12T08:39:02Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/5c9a95ff0cce42dd3ab55aa40c0bd09369d1ca09",
    "details": {
      "sha": "0b5ee33d6e9db49bf66f320b3c8edaa8272a6c36",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/VClientImpl.java",
      "status": "modified",
      "additions": 8,
      "deletions": 4,
      "changes": 12,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/5c9a95ff0cce42dd3ab55aa40c0bd09369d1ca09/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2FVClientImpl.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/5c9a95ff0cce42dd3ab55aa40c0bd09369d1ca09/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2FVClientImpl.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2FVClientImpl.java?ref=5c9a95ff0cce42dd3ab55aa40c0bd09369d1ca09",
      "patch": "@@ -26,7 +26,6 @@\n import android.os.StrictMode;\n import android.system.ErrnoException;\n import android.system.Os;\n-import android.util.Log;\n \n import com.lody.virtual.client.core.CrashHandler;\n import com.lody.virtual.client.core.InvocationStubManager;\n@@ -45,6 +44,7 @@\n import com.lody.virtual.client.stub.VASettings;\n import com.lody.virtual.helper.compat.BuildCompat;\n import com.lody.virtual.helper.compat.StorageManagerCompat;\n+import com.lody.virtual.helper.utils.Reflect;\n import com.lody.virtual.helper.utils.VLog;\n import com.lody.virtual.os.VEnvironment;\n import com.lody.virtual.os.VUserHandle;\n@@ -62,6 +62,7 @@\n import java.util.Map;\n import java.util.Set;\n \n+import dalvik.system.DelegateLastClassLoader;\n import me.weishu.exposed.ExposedBridge;\n import mirror.android.app.ActivityThread;\n import mirror.android.app.ActivityThreadNMR1;\n@@ -71,13 +72,13 @@\n import mirror.android.content.ContentProviderHolderOreo;\n import mirror.android.providers.Settings;\n import mirror.android.renderscript.RenderScriptCacheDir;\n+import mirror.android.security.net.config.ApplicationConfig;\n import mirror.android.view.HardwareRenderer;\n import mirror.android.view.RenderScript;\n import mirror.android.view.ThreadedRenderer;\n import mirror.com.android.internal.content.ReferrerIntent;\n import mirror.dalvik.system.VMRuntime;\n import mirror.java.lang.ThreadGroupN;\n-import mirror.android.security.net.config.ApplicationConfig;\n \n import static com.lody.virtual.os.VUserHandle.getUserId;\n \n@@ -346,8 +347,11 @@ private void bindApplicationNoCheck(String packageName, String processName, Cond\n             VLog.w(TAG, \"Xposed is disable..\");\n         }\n \n-        ClassLoader call = LoadedApk.getClassLoader.call(data.info);\n-        Log.i(\"mylog\", \"classloader: \" + call + \" parent: \" + call.getParent());\n+        ClassLoader cl = LoadedApk.getClassLoader.call(data.info);\n+        if (BuildCompat.isS()) {\n+            ClassLoader parent = cl.getParent();\n+            Reflect.on(cl).set(\"parent\", new DelegateLastClassLoader(\"/system/framework/android.test.base.jar\", parent));\n+        }\n \n         if (Build.VERSION.SDK_INT >= 30)\n             ApplicationConfig.setDefaultInstance.call(new Object[] { null });",
      "parent_sha": "a2a5244c0c29ae42502f5a28f8d63cc8293a1693"
    }
  },
  {
    "oid": "451ff8b12c177659688c3afac9b8bcf8b71e6dd9",
    "message": "\u9002\u914d6.0",
    "date": "2016-07-17T04:05:57Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/451ff8b12c177659688c3afac9b8bcf8b71e6dd9",
    "details": {
      "sha": "d94f08457f03fa5a0d4366edd0641b3ea01656b7",
      "filename": "VirtualApp/app/src/main/java/io/virtualapp/ui/NotificationHandler.java",
      "status": "modified",
      "additions": 51,
      "deletions": 39,
      "changes": 90,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/451ff8b12c177659688c3afac9b8bcf8b71e6dd9/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fui%2FNotificationHandler.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/451ff8b12c177659688c3afac9b8bcf8b71e6dd9/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fui%2FNotificationHandler.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fui%2FNotificationHandler.java?ref=451ff8b12c177659688c3afac9b8bcf8b71e6dd9",
      "patch": "@@ -71,12 +71,21 @@ private void init(Context context) {\n                 systemUi = context.createPackageContext(\"com.android.systemui\", Context.CONTEXT_IGNORE_SECURITY);\n             } catch (PackageManager.NameNotFoundException e) {\n             }\n-            notification_side_padding = getDimem(context, systemUi, \"notification_side_padding\", R.dimen.notification_side_padding);\n+            //notification_row_min_height\n+            //notification_row_max_height\n+            if (Build.VERSION.SDK_INT <= 19) {\n+                notification_side_padding = 0;\n+            } else {\n+                notification_side_padding = getDimem(context, systemUi, \"notification_side_padding\", R.dimen.notification_side_padding);\n+            }\n             notification_panel_width = getDimem(context, systemUi, \"notification_panel_width\", R.dimen.notification_panel_width);\n             if (notification_panel_width <= 0) {\n                 notification_panel_width = context.getResources().getDisplayMetrics().widthPixels;\n             }\n-            notification_min_height = getDimem(context, systemUi, \"notification_min_height\", R.dimen.notification_min_height);\n+            notification_min_height = 0;// getDimem(context,systemUi, \"notification_row_min_height\", 0);\n+            if (notification_min_height == 0) {\n+                notification_min_height = getDimem(context, systemUi, \"notification_min_height\", R.dimen.notification_min_height);\n+            }\n             notification_max_height = getDimem(context, systemUi, \"notification_max_height\", R.dimen.notification_max_height);\n             notification_mid_height = getDimem(context, systemUi, \"notification_mid_height\", R.dimen.notification_mid_height);\n             notification_padding = getDimem(context, systemUi, \"notification_padding\", R.dimen.notification_padding);\n@@ -90,14 +99,14 @@ public NotificationHandler() {\n     private int getDimem(Context context, Context sysContext, String name, int defId) {\n         if (sysContext == null) {\n             Log.w(\"kk\", \"get my\");\n-            return Math.round(context.getResources().getDimension(defId));\n+            return defId == 0 ? 0 : Math.round(context.getResources().getDimension(defId));\n         }\n         int id = sysContext.getResources().getIdentifier(name, \"dimen\", \"com.android.systemui\");\n         if (id != 0) {\n             return Math.round(sysContext.getResources().getDimension(id));\n         } else {\n             Log.w(\"kk\", \"get my 2\");\n-            return Math.round(context.getResources().getDimension(defId));\n+            return defId == 0 ? 0 : Math.round(context.getResources().getDimension(defId));\n         }\n     }\n \n@@ -110,10 +119,12 @@ public boolean dealNotification(Context hostContext, String packageName, Object.\n                 if (isPluginNotification(notification)) {\n                     if (shouldBlock(notification)) {\n                         //\u81ea\u5b9a\u4e49\u5e03\u5c40\u901a\u77e5\u680f\n+                        Log.e(\"kk\", \"replaceNotification\");\n                         args[i] = replaceNotification(hostContext, packageName, notification);\n                         return true;\n                     } else {\n                         //\u8fd9\u91cc\u8981\u4fee\u6539\u901a\u77e5\u3002\n+                        Log.e(\"kk\", \"replaceNotification\");\n                         hackNotification(notification);\n                         return true;\n                     }\n@@ -259,44 +270,45 @@ private Notification replaceNotification(Context context, String packageName, No\n                     builder.setLargeIcon(newIcon);\n                 }\n             }\n-        } else {\n-            if (!DRAW_NOTIFICATION) {\n-                ApplicationInfo applicationInfo = null;\n-                try {\n-                    applicationInfo = VirtualCore.getCore().getPackageManager().getApplicationInfo(packageName, 0);\n-                } catch (PackageManager.NameNotFoundException e) {\n-                }\n-                if (applicationInfo != null) {\n-                    Drawable icon = VirtualCore.getCore().getPackageManager().getApplicationIcon(applicationInfo);\n-                    CharSequence title = VirtualCore.getCore().getPackageManager().getApplicationLabel(applicationInfo);\n-                    if (icon instanceof BitmapDrawable) {\n-                        builder.setLargeIcon(((BitmapDrawable) icon).getBitmap());\n-                    }\n-                    builder.setContentTitle(title);\n+        }else{\n+            builder.setSmallIcon(context.getApplicationInfo().icon);\n+        }\n+        if (!DRAW_NOTIFICATION) {\n+            ApplicationInfo applicationInfo = null;\n+            try {\n+                applicationInfo = VirtualCore.getCore().getPackageManager().getApplicationInfo(packageName, 0);\n+            } catch (PackageManager.NameNotFoundException e) {\n+            }\n+            if (applicationInfo != null) {\n+                Drawable icon = VirtualCore.getCore().getPackageManager().getApplicationIcon(applicationInfo);\n+                CharSequence title = VirtualCore.getCore().getPackageManager().getApplicationLabel(applicationInfo);\n+                if (icon instanceof BitmapDrawable) {\n+                    builder.setLargeIcon(((BitmapDrawable) icon).getBitmap());\n                 }\n-            } else {\n-                RemoteViews remoteViews = new RemoteViews(context.getPackageName(), R.layout.custom_notification);\n-                //TODO \u7ed8\u5236\u56fe\u7247\uff0c\u904d\u5386action\u8fd9\u53ea\u5185\u5bb9\n-                Bitmap bmp = null;\n-                try {\n-                    if (notification.contentView != null) {\n-                        bmp = createBitmap(notification.contentView, false);\n-                    } else {\n-                        bmp = createBitmap(notification.bigContentView, true);\n-                    }\n-                } catch (PackageManager.NameNotFoundException e) {\n+                builder.setContentTitle(title);\n+            }\n+        } else {\n+            RemoteViews remoteViews = new RemoteViews(context.getPackageName(), R.layout.custom_notification);\n+            //TODO \u7ed8\u5236\u56fe\u7247\uff0c\u904d\u5386action\u8fd9\u53ea\u5185\u5bb9\n+            Bitmap bmp = null;\n+            try {\n+                if (notification.contentView != null) {\n+                    bmp = createBitmap(notification.contentView, false);\n+                } else {\n+                    bmp = createBitmap(notification.bigContentView, true);\n                 }\n-                remoteViews.setImageViewBitmap(R.id.im_main, bmp);\n-                //TODO \u533a\u57df\u70b9\u51fb\n-                builder.setContent(remoteViews);\n+            } catch (PackageManager.NameNotFoundException e) {\n             }\n-            //com.android.internal.R.id.icon\n-            builder.setSmallIcon(context.getApplicationInfo().icon);\n-            builder.setContentIntent(notification.contentIntent);\n-            builder.setDeleteIntent(notification.deleteIntent);\n-            builder.setFullScreenIntent(notification.fullScreenIntent,\n-                    (notification.flags & Notification.FLAG_HIGH_PRIORITY) != 0);\n+            remoteViews.setImageViewBitmap(R.id.im_main, bmp);\n+            //TODO \u533a\u57df\u70b9\u51fb\n+            builder.setContent(remoteViews);\n         }\n+        //com.android.internal.R.id.icon\n+        builder.setContentIntent(notification.contentIntent);\n+        builder.setDeleteIntent(notification.deleteIntent);\n+        builder.setFullScreenIntent(notification.fullScreenIntent,\n+                (notification.flags & Notification.FLAG_HIGH_PRIORITY) != 0);\n+\n         Notification notification1;\n         if (Build.VERSION.SDK_INT >= 16) {\n             notification1 = builder.build();\n@@ -320,7 +332,7 @@ private Bitmap createBitmap(RemoteViews remoteViews, boolean isBig) throws Packa\n         final Context context = VirtualCore.getCore().getContext().createPackageContext(aPackage, Context.CONTEXT_IGNORE_SECURITY | Context.CONTEXT_INCLUDE_CODE);\n //        ViewGroup view = (ViewGroup) LayoutInflater.from(context).inflate(remoteViews.getLayoutId(), null);\n         //TODO \u9700\u8981\u9002\u914d\n-        int sp =  notification_side_padding;// + notification_padding);\n+        int sp = notification_side_padding;// + notification_padding);\n         int width = notification_panel_width - sp * 2;\n         int height = isBig ? notification_max_height : notification_min_height;\n         FrameLayout frameLayout = new FrameLayout(context);",
      "parent_sha": "087c9948f972b53e5aaa70d56843587d53547d3b"
    }
  },
  {
    "oid": "fda8d0a66268e082d4393f30a1ca6c464c2b61e1",
    "message": "Remove storage scan fragment\n\nSigned-off-by: tiann <twsxtd@gmail.com>",
    "date": "2020-07-27T12:14:58Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/fda8d0a66268e082d4393f30a1ca6c464c2b61e1",
    "details": {
      "sha": "55e0ff45e16f998731ff01d73eb2bdda8906eb10",
      "filename": "VirtualApp/app/src/main/java/io/virtualapp/home/adapters/AppPagerAdapter.java",
      "status": "modified",
      "additions": 1,
      "deletions": 32,
      "changes": 33,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/fda8d0a66268e082d4393f30a1ca6c464c2b61e1/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2Fadapters%2FAppPagerAdapter.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/fda8d0a66268e082d4393f30a1ca6c464c2b61e1/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2Fadapters%2FAppPagerAdapter.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fhome%2Fadapters%2FAppPagerAdapter.java?ref=fda8d0a66268e082d4393f30a1ca6c464c2b61e1",
      "patch": "@@ -1,23 +1,15 @@\n package io.virtualapp.home.adapters;\n \n-import android.content.Context;\n-import android.os.Build;\n-import android.os.Environment;\n-import android.os.storage.StorageManager;\n-import android.os.storage.StorageVolume;\n import android.support.v4.app.Fragment;\n import android.support.v4.app.FragmentManager;\n import android.support.v4.app.FragmentPagerAdapter;\n \n-import com.lody.virtual.helper.utils.DeviceUtil;\n-import com.lody.virtual.helper.utils.Reflect;\n-\n import java.io.File;\n import java.util.ArrayList;\n import java.util.List;\n \n-import io.virtualapp.XApp;\n import io.virtualapp.R;\n+import io.virtualapp.XApp;\n import io.virtualapp.home.ListAppFragment;\n \n /**\n@@ -31,29 +23,6 @@ public AppPagerAdapter(FragmentManager fm) {\n         super(fm);\n         titles.add(XApp.getApp().getResources().getString(R.string.clone_apps));\n         dirs.add(null);\n-        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.N) {\n-            Context ctx = XApp.getApp();\n-            StorageManager storage = (StorageManager) ctx.getSystemService(Context.STORAGE_SERVICE);\n-            for (StorageVolume volume : storage.getStorageVolumes()) {\n-                //Why the fuck are getPathFile and getUserLabel hidden?!\n-                //StorageVolume is kinda useless without those...\n-                File dir = Reflect.on(volume).call(\"getPathFile\").get();\n-                String label = Reflect.on(volume).call(\"getUserLabel\").get();\n-                if (dir.listFiles() != null) {\n-                    titles.add(label);\n-                    dirs.add(dir);\n-                }\n-            }\n-        } else {\n-            // Fallback: only support the default storage sources\n-            if (!DeviceUtil.isMeizuBelowN()) {\n-                File storageFir = Environment.getExternalStorageDirectory();\n-                if (storageFir != null && storageFir.isDirectory()) {\n-                    titles.add(XApp.getApp().getResources().getString(R.string.external_storage));\n-                    dirs.add(storageFir);\n-                }\n-            }\n-        }\n     }\n \n     @Override",
      "parent_sha": "89016a58d335776d832ae110e800a2c05f742ff8"
    }
  },
  {
    "oid": "2b8f1aee80ae3ece7637b3afaf98a3cbdc5b88a6",
    "message": "Fix",
    "date": "2017-04-11T14:06:29Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/2b8f1aee80ae3ece7637b3afaf98a3cbdc5b88a6",
    "details": {
      "sha": "41b15c8d7e7718a9b21dd8a245d710d50871de9c",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/hook/proxies/mount/MethodProxies.java",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/2b8f1aee80ae3ece7637b3afaf98a3cbdc5b88a6/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fproxies%2Fmount%2FMethodProxies.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/2b8f1aee80ae3ece7637b3afaf98a3cbdc5b88a6/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fproxies%2Fmount%2FMethodProxies.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fproxies%2Fmount%2FMethodProxies.java?ref=2b8f1aee80ae3ece7637b3afaf98a3cbdc5b88a6",
      "patch": "@@ -64,7 +64,7 @@ public Object call(Object who, Method method, Object... args) throws Throwable {\n                 path = (String) args[1];\n             }\n             File file = new File(path);\n-            return file.exists() && file.mkdirs() ? 0 : -1;\n+            return file.exists() || file.mkdirs() ? 0 : -1;\n         }\n     }\n }",
      "parent_sha": "c5da0537f4c4a7e099ad1caa6fc5bee1959ce0fb"
    }
  },
  {
    "oid": "3e9c5e71d55def26210546f3480ee0d30f6d3d92",
    "message": "[VXP]: fix display error of installer activity.",
    "date": "2018-06-06T06:20:18Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/3e9c5e71d55def26210546f3480ee0d30f6d3d92",
    "details": {
      "sha": "2dad1b115742a69ace74f032a7dd6c8805a9d819",
      "filename": "VirtualApp/app/src/main/java/io/virtualapp/sys/InstallerActivity.java",
      "status": "modified",
      "additions": 8,
      "deletions": 8,
      "changes": 16,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/3e9c5e71d55def26210546f3480ee0d30f6d3d92/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fsys%2FInstallerActivity.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/3e9c5e71d55def26210546f3480ee0d30f6d3d92/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fsys%2FInstallerActivity.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fsys%2FInstallerActivity.java?ref=3e9c5e71d55def26210546f3480ee0d30f6d3d92",
      "patch": "@@ -239,12 +239,7 @@ private void handleSystemIntent(Intent intent) {\n         }\n         String toInstalledVersion = packageArchiveInfo.versionName;\n         int toInstalledVersionCode = packageArchiveInfo.versionCode;\n-        CharSequence label;\n-        try {\n-            label = packageArchiveInfo.applicationInfo.loadLabel(packageManager);\n-        } catch (Throwable e) {\n-            label = packageArchiveInfo.packageName;\n-        }\n+        CharSequence label = packageArchiveInfo.packageName;\n \n         if (installedAppInfo != null) {\n             String currentVersion;\n@@ -254,6 +249,8 @@ private void handleSystemIntent(Intent intent) {\n             currentVersion = applicationInfo.versionName;\n             currentVersionCode = applicationInfo.versionCode;\n \n+            label = applicationInfo.applicationInfo.loadLabel(packageManager);\n+\n             String multiVersionUpdate = getResources().getString(currentVersionCode == toInstalledVersionCode ? R.string.multi_version_cover : (\n                     currentVersionCode < toInstalledVersionCode ? R.string.multi_version_upgrade : R.string.multi_version_downgrade\n             ));\n@@ -266,6 +263,7 @@ private void handleSystemIntent(Intent intent) {\n             rightString = getResources().getString(R.string.install);\n         }\n \n+        final CharSequence apkName = label;\n         mTips.setText(tipsText);\n         mLeft.setText(leftString);\n         mRight.setText(rightString);\n@@ -283,13 +281,15 @@ private void handleSystemIntent(Intent intent) {\n             }).done((res) -> {\n                 // install success\n                 mTips.setVisibility(View.GONE);\n+                mProgressText.setVisibility(View.VISIBLE);\n+                mProgressText.setText(getResources().getString(R.string.add_app_laoding_complete, apkName));\n                 mProgressBar.setVisibility(View.GONE);\n                 mRight.setEnabled(true);\n                 mRight.setText(res.isSuccess ? R.string.install_complete : R.string.install_fail);\n                 mRight.setOnClickListener((vv) -> finish());\n             }).fail((res) -> {\n-                mTips.setVisibility(View.VISIBLE);\n-                mTips.setText(R.string.install_fail);\n+                mProgressText.setVisibility(View.VISIBLE);\n+                mProgressText.setText(R.string.install_fail);\n                 mRight.setEnabled(true);\n                 mProgressBar.setVisibility(View.GONE);\n                 mRight.setText(android.R.string.ok);",
      "parent_sha": "9019873684b38b20b750dec1ba4d00ecbf394d4e"
    }
  },
  {
    "oid": "9cca0a8b26d1f24abfe24131171d49a7fccfa821",
    "message": "Feature: If a contentProvider is not enabled, we shouldn't install it.",
    "date": "2016-07-26T09:33:35Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/9cca0a8b26d1f24abfe24131171d49a7fccfa821",
    "details": {
      "sha": "9c6d3c18310a0234b277aa40c488ab4d008a97e7",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/core/AppSandBox.java",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/9cca0a8b26d1f24abfe24131171d49a7fccfa821/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fcore%2FAppSandBox.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/9cca0a8b26d1f24abfe24131171d49a7fccfa821/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fcore%2FAppSandBox.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fcore%2FAppSandBox.java?ref=9cca0a8b26d1f24abfe24131171d49a7fccfa821",
      "patch": "@@ -118,7 +118,7 @@ private static void installLocked(String procName, String pkg) {\n \t\t\tif (pkgInfo.providers != null) {\n \t\t\t\tproviders = new ArrayList<>(pkgInfo.providers.length);\n \t\t\t\tfor (ProviderInfo providerInfo : pkgInfo.providers) {\n-\t\t\t\t\tif (providerInfo.multiprocess || TextUtils.equals(procName, providerInfo.processName)) {\n+\t\t\t\t\tif (providerInfo.enabled && providerInfo.multiprocess || TextUtils.equals(procName, providerInfo.processName)) {\n \t\t\t\t\t\tproviders.add(providerInfo);\n \t\t\t\t\t}\n \t\t\t\t}",
      "parent_sha": "7e0afdf2951a3348cc41aa465797a8b298ab7986"
    }
  },
  {
    "oid": "214a0ef953a98aac0cf87e489e431da600cf1600",
    "message": "FIX: when the app has multiple MAIN entry, the launch intent will select the first always, which maybe an disabled component. We should always select the enabled one.",
    "date": "2019-04-05T04:57:38Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/214a0ef953a98aac0cf87e489e431da600cf1600",
    "details": {
      "sha": "4cff92b84f20c4b3be8909c4fe48eaf4d8a279be",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/core/VirtualCore.java",
      "status": "modified",
      "additions": 16,
      "deletions": 2,
      "changes": 18,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/214a0ef953a98aac0cf87e489e431da600cf1600/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fcore%2FVirtualCore.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/214a0ef953a98aac0cf87e489e431da600cf1600/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fcore%2FVirtualCore.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fcore%2FVirtualCore.java?ref=214a0ef953a98aac0cf87e489e431da600cf1600",
      "patch": "@@ -443,10 +443,24 @@ public Intent getLaunchIntent(String packageName, int userId) {\n         if (ris == null || ris.size() <= 0) {\n             return null;\n         }\n+\n+        ActivityInfo activityInfo = null;\n+        for (ResolveInfo resolveInfo : ris) {\n+            if (resolveInfo.activityInfo.enabled) {\n+                // select the first enabled component\n+                activityInfo = resolveInfo.activityInfo;\n+                break;\n+            }\n+        }\n+\n+        if (activityInfo == null) {\n+            activityInfo = ris.get(0).activityInfo;\n+        }\n+\n         Intent intent = new Intent(intentToResolve);\n         intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\n-        intent.setClassName(ris.get(0).activityInfo.packageName,\n-                ris.get(0).activityInfo.name);\n+        intent.setClassName(activityInfo.packageName,\n+                activityInfo.name);\n         return intent;\n     }\n ",
      "parent_sha": "c6e9e053e4b4558ee05e2c6f50fdaa2cdf0674eb"
    }
  },
  {
    "oid": "af97668dd38bc06b9fd14e6eb3d8ac9d13492d79",
    "message": "Fix: optimized the code.",
    "date": "2016-08-01T05:29:04Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/af97668dd38bc06b9fd14e6eb3d8ac9d13492d79",
    "details": {
      "sha": "7565c0e1243f4c55e48653b1e4227443c0f72a39",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/service/am/VActivityService.java",
      "status": "modified",
      "additions": 5,
      "deletions": 5,
      "changes": 10,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/af97668dd38bc06b9fd14e6eb3d8ac9d13492d79/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fservice%2Fam%2FVActivityService.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/af97668dd38bc06b9fd14e6eb3d8ac9d13492d79/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fservice%2Fam%2FVActivityService.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fservice%2Fam%2FVActivityService.java?ref=af97668dd38bc06b9fd14e6eb3d8ac9d13492d79",
      "patch": "@@ -230,13 +230,13 @@ private VActRedirectResult redirectTargetActivityLocked(VRedirectActRequest requ\n \t\t\t\tresultFlags |= Intent.FLAG_ACTIVITY_NO_USER_ACTION;\n \t\t\t}\n \t\t\tif ((launchFlags & Intent.FLAG_ACTIVITY_CLEAR_TOP) != 0) {\n+\t\t\t\t// A -> B -> C -> D\n+\t\t\t\t// D -> A (FLAG_ACTIVITY_CLEAR_TOP)\n+\t\t\t\t// Finish : B, C, D\n+\t\t\t\t// onNewIntent : A\n \t\t\t\tActivityTaskRecord task = mMainStack.findTask(taskAffinity);\n-\t\t\t\tif (task.isInTask(targetActInfo) && !task.isOnTop(targetActInfo)) {\n+\t\t\t\tif (task != null && task.size() >= 2 && task.isInTask(targetActInfo) && !task.isOnTop(targetActInfo)) {\n \t\t\t\t\tList<ActivityRecord> activityList = task.activityList;\n-\t\t\t\t\t// A -> B -> C -> D\n-\t\t\t\t\t// D -> A (FLAG_ACTIVITY_CLEAR_TOP)\n-\t\t\t\t\t// Finish : B, C, D\n-\t\t\t\t\t// onNewIntent : A\n \t\t\t\t\tListIterator<ActivityRecord> iterator = activityList.listIterator();\n \t\t\t\t\twhile (iterator.hasNext()) {\n \t\t\t\t\t\tActivityRecord current = iterator.next();",
      "parent_sha": "285f6064fb2deb13b2d2b797c38fddfb69d22e42"
    }
  },
  {
    "oid": "454f561c1646578bed4cf3588bac42528ea3d029",
    "message": "Fix: task should be restart when task is not exist.",
    "date": "2016-09-21T05:29:06Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/454f561c1646578bed4cf3588bac42528ea3d029",
    "details": {
      "sha": "4346bf7c0fdfc916434a90903ccb0467d436c57f",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/server/am/ActivityStack.java",
      "status": "modified",
      "additions": 5,
      "deletions": 3,
      "changes": 8,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/454f561c1646578bed4cf3588bac42528ea3d029/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fam%2FActivityStack.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/454f561c1646578bed4cf3588bac42528ea3d029/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fam%2FActivityStack.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fam%2FActivityStack.java?ref=454f561c1646578bed4cf3588bac42528ea3d029",
      "patch": "@@ -316,10 +316,12 @@ int startActivityLocked(int userId, Intent intent, ActivityInfo info, IBinder re\n \t\t\t\t\tscheduleFinishMarkedActivity();\n \t\t\t\t}\n \t\t\t}\n+\t\t\tif (reuseTask.isFinishing()) {\n+\t\t\t\tstartActivityInNewTaskLocked(userId, intent, info, options);\n+\t\t\t\tdelivered = true;\n+\t\t\t}\n \t\t\tif (!startTaskToFront) {\n-\t\t\t\tif (reuseTask.isFinishing()) {\n-\t\t\t\t\tstartActivityInNewTaskLocked(userId, intent, info, options);\n-\t\t\t\t} else if (!delivered) {\n+\t\t\t\t if (!delivered) {\n \t\t\t\t\tdestIntent = startActivityProcess(userId, sourceRecord, intent, info);\n \t\t\t\t\tif (destIntent != null) {\n \t\t\t\t\t\tstartActivityFromSourceTask(reuseTask, destIntent, info, resultWho, requestCode, options);",
      "parent_sha": "784824acbad8f1a90d429e2c70be313a5a8b3c4f"
    }
  },
  {
    "oid": "55003bfc4950d6adcd9e7d2df6d5679a017850b2",
    "message": "[VXP]: do not crash when send broadcast.",
    "date": "2018-06-06T06:14:43Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/55003bfc4950d6adcd9e7d2df6d5679a017850b2",
    "details": {
      "sha": "ef1d6fbb7243d186b413cfb92c2a995215ea3fe8",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/core/VirtualCore.java",
      "status": "modified",
      "additions": 5,
      "deletions": 1,
      "changes": 6,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/55003bfc4950d6adcd9e7d2df6d5679a017850b2/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fcore%2FVirtualCore.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/55003bfc4950d6adcd9e7d2df6d5679a017850b2/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fcore%2FVirtualCore.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fcore%2FVirtualCore.java?ref=55003bfc4950d6adcd9e7d2df6d5679a017850b2",
      "patch": "@@ -502,7 +502,11 @@ public boolean createShortcut(int userId, String packageName, Intent splash, OnE\n         addIntent.putExtra(Intent.EXTRA_SHORTCUT_NAME, name);\n         addIntent.putExtra(Intent.EXTRA_SHORTCUT_ICON, icon);\n         addIntent.setAction(\"com.android.launcher.action.INSTALL_SHORTCUT\");\n-        context.sendBroadcast(addIntent);\n+        try {\n+            context.sendBroadcast(addIntent);\n+        } catch (Throwable ignored) {\n+            return false;\n+        }\n         return true;\n     }\n ",
      "parent_sha": "6f284d38bf4a8c27e5fc834667fa5fe8c0e73833"
    }
  },
  {
    "oid": "8c450d18d54ee518f909f9b20e1998cbdc306945",
    "message": "fix java.lang.IllegalArgumentException: Receiver not registered",
    "date": "2016-11-03T02:24:55Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/8c450d18d54ee518f909f9b20e1998cbdc306945",
    "details": {
      "sha": "f3df0e41f8a1592e61b9ee368aa47a5741ebae57",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/server/am/StaticBroadcastSystem.java",
      "status": "modified",
      "additions": 6,
      "deletions": 5,
      "changes": 11,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/8c450d18d54ee518f909f9b20e1998cbdc306945/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fam%2FStaticBroadcastSystem.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/8c450d18d54ee518f909f9b20e1998cbdc306945/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fam%2FStaticBroadcastSystem.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fam%2FStaticBroadcastSystem.java?ref=8c450d18d54ee518f909f9b20e1998cbdc306945",
      "patch": "@@ -1,5 +1,10 @@\n package com.lody.virtual.server.am;\n \n+import com.lody.virtual.client.env.SpecialComponentList;\n+import com.lody.virtual.helper.proto.AppSetting;\n+import com.lody.virtual.helper.utils.collection.ArrayMap;\n+import com.lody.virtual.server.pm.VAppManagerService;\n+\n import android.content.BroadcastReceiver;\n import android.content.Context;\n import android.content.Intent;\n@@ -8,11 +13,6 @@\n import android.content.pm.PackageParser;\n import android.os.Handler;\n \n-import com.lody.virtual.client.env.SpecialComponentList;\n-import com.lody.virtual.helper.proto.AppSetting;\n-import com.lody.virtual.helper.utils.collection.ArrayMap;\n-import com.lody.virtual.server.pm.VAppManagerService;\n-\n import java.util.ArrayList;\n import java.util.List;\n import java.util.ListIterator;\n@@ -85,6 +85,7 @@ public void stopApp(String packageName) {\n \t\t\t\tmContext.unregisterReceiver(r);\n \t\t\t}\n \t\t}\n+\t\tmReceivers.remove(packageName);\n \t}\n \n \tprivate static final class StaticScheduler extends Handler {",
      "parent_sha": "3e50724e3ba132ece4ac089c6b53b5a686fd9509"
    }
  },
  {
    "oid": "b9b1eb96bf5b0444c420d4c9b629e947080736a6",
    "message": "Fix: MediaRouter problem.",
    "date": "2016-08-31T13:40:18Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/b9b1eb96bf5b0444c420d4c9b629e947080736a6",
    "details": {
      "sha": "443574a77a9b3c6867512dffd5f1de396f769e2d",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/hook/binders/MediaRouterBinderDelegate.java",
      "status": "modified",
      "additions": 4,
      "deletions": 1,
      "changes": 5,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/b9b1eb96bf5b0444c420d4c9b629e947080736a6/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fbinders%2FMediaRouterBinderDelegate.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/b9b1eb96bf5b0444c420d4c9b629e947080736a6/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fbinders%2FMediaRouterBinderDelegate.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fbinders%2FMediaRouterBinderDelegate.java?ref=b9b1eb96bf5b0444c420d4c9b629e947080736a6",
      "patch": "@@ -20,6 +20,9 @@ public class MediaRouterBinderDelegate extends HookBinderDelegate {\n     @Override\n     public IInterface createInterface() {\n         IBinder binder = ServiceManager.getService.call(Context.MEDIA_ROUTER_SERVICE);\n-        return IMediaRouterService.Stub.asInterface.call(binder);\n+        if (IMediaRouterService.Stub.asInterface != null) {\n+            return IMediaRouterService.Stub.asInterface.call(binder);\n+        }\n+        return null;\n     }\n }",
      "parent_sha": "ec6aa4febe335f1c41d56c9d282a4443ed6b96de"
    }
  },
  {
    "oid": "a324c9a5845ee655a0ee4a2eeb2e6c24cd37d26d",
    "message": "Fix: getContentProvider maybe access a null value.",
    "date": "2016-08-07T12:44:46Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/a324c9a5845ee655a0ee4a2eeb2e6c24cd37d26d",
    "details": {
      "sha": "738cdfe664510cafeefeda519ea5b4325eab7595",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/hook/patchs/am/Hook_GetContentProvider.java",
      "status": "modified",
      "additions": 11,
      "deletions": 8,
      "changes": 19,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/a324c9a5845ee655a0ee4a2eeb2e6c24cd37d26d/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fam%2FHook_GetContentProvider.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/a324c9a5845ee655a0ee4a2eeb2e6c24cd37d26d/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fam%2FHook_GetContentProvider.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fam%2FHook_GetContentProvider.java?ref=a324c9a5845ee655a0ee4a2eeb2e6c24cd37d26d",
      "patch": "@@ -1,20 +1,20 @@\n package com.lody.virtual.client.hook.patchs.am;\n \n-import java.lang.reflect.InvocationTargetException;\n-import java.lang.reflect.Method;\n-import java.lang.reflect.Proxy;\n+import android.app.IActivityManager;\n+import android.app.IApplicationThread;\n+import android.content.IContentProvider;\n+import android.content.pm.ProviderInfo;\n+import android.os.IBinder;\n \n import com.lody.virtual.client.hook.base.Hook;\n import com.lody.virtual.client.hook.providers.ProviderHook;\n import com.lody.virtual.client.local.VActivityManager;\n import com.lody.virtual.client.local.VPackageManager;\n import com.lody.virtual.helper.utils.ComponentUtils;\n \n-import android.app.IActivityManager;\n-import android.app.IApplicationThread;\n-import android.content.IContentProvider;\n-import android.content.pm.ProviderInfo;\n-import android.os.IBinder;\n+import java.lang.reflect.InvocationTargetException;\n+import java.lang.reflect.Method;\n+import java.lang.reflect.Proxy;\n \n /**\n  * @author Lody\n@@ -59,6 +59,9 @@ public Object onHook(Object who, Method method, Object... args) throws Throwable\n \t\tif (holder == null) {\n \t\t\treturn null;\n \t\t}\n+\t\tif (holder.provider == null) {\n+\t\t\treturn holder;\n+\t\t}\n \t\tProviderHook.HookFetcher fetcher = ProviderHook.fetchHook(name);\n \t\tif (fetcher != null) {\n \t\t\tIContentProvider provider = holder.provider;",
      "parent_sha": "a685146b2bf20fdd704d357d9f7c81c0006f8b3c"
    }
  },
  {
    "oid": "ed83c4567332f4c86b89e7a51d8b9e00d0dd0266",
    "message": "Fix: Alerm may produce crash.",
    "date": "2016-07-28T07:21:51Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/ed83c4567332f4c86b89e7a51d8b9e00d0dd0266",
    "details": {
      "sha": "d244a36e5c1a0f4cec4d49a6d69e474bf442fc1d",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/core/PatchManager.java",
      "status": "modified",
      "additions": 4,
      "deletions": 2,
      "changes": 6,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/ed83c4567332f4c86b89e7a51d8b9e00d0dd0266/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fcore%2FPatchManager.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/ed83c4567332f4c86b89e7a51d8b9e00d0dd0266/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fcore%2FPatchManager.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fcore%2FPatchManager.java?ref=ed83c4567332f4c86b89e7a51d8b9e00d0dd0266",
      "patch": "@@ -8,6 +8,7 @@\n import com.lody.virtual.client.hook.base.PatchObject;\n import com.lody.virtual.client.hook.delegate.AppInstrumentation;\n import com.lody.virtual.client.hook.patchs.account.AccountManagerPatch;\n+import com.lody.virtual.client.hook.patchs.alerm.AlarmManagerPatch;\n import com.lody.virtual.client.hook.patchs.am.ActivityManagerPatch;\n import com.lody.virtual.client.hook.patchs.am.HCallbackHook;\n import com.lody.virtual.client.hook.patchs.appops.AppOpsManagerPatch;\n@@ -104,7 +105,8 @@ public void injectAll() throws Throwable {\n \tprivate void injectInternal() throws Throwable {\n \t\taddPatch(new ActivityManagerPatch());\n \t\taddPatch(new PackageManagerPatch());\n-\n+\t\taddPatch(new DropBoxManagerPatch());\n+\t\t\n \t\tif (VirtualCore.getCore().isVAppProcess()) {\n \t\t\t// ## Fuck the MIUI Security\n \t\t\tif (MIUISecurityManagerPatch.needInject()) {\n@@ -125,9 +127,9 @@ private void injectInternal() throws Throwable {\n \t\t\taddPatch(new TelephonyRegistryPatch());\n \t\t\taddPatch(new AppWidgetManagerPatch());\n \t\t\taddPatch(new AccountManagerPatch());\n-\t\t\taddPatch(new DropBoxManagerPatch());\n \t\t\taddPatch(new AudioManagerPatch());\n \t\t\taddPatch(new SearchManagerPatch());\n+\t\t\taddPatch(new AlarmManagerPatch());\n \n \t\t\tif (Build.VERSION.SDK_INT >= JELLY_BEAN_MR2) {\n \t\t\t\taddPatch(new VibratorPatch());",
      "parent_sha": "bade1210a34062c0fd887339788edb95b72de858"
    }
  },
  {
    "oid": "4060cf54e85fe2e1eaf7d14c521c4d2eb79d9051",
    "message": "Revert \"Extracting common method of stopService\"",
    "date": "2017-06-17T04:22:29Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/4060cf54e85fe2e1eaf7d14c521c4d2eb79d9051",
    "details": {
      "sha": "3be9deb060b7f3d3ce56fcda2a9b2e14e2e11efe",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/server/am/VActivityManagerService.java",
      "status": "modified",
      "additions": 55,
      "deletions": 58,
      "changes": 113,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/4060cf54e85fe2e1eaf7d14c521c4d2eb79d9051/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fam%2FVActivityManagerService.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/4060cf54e85fe2e1eaf7d14c521c4d2eb79d9051/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fam%2FVActivityManagerService.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fam%2FVActivityManagerService.java?ref=4060cf54e85fe2e1eaf7d14c521c4d2eb79d9051",
      "patch": "@@ -413,8 +413,54 @@ public int stopService(IBinder caller, Intent service, String resolvedType, int\n             if (r == null) {\n                 return 0;\n             }\n+            if (!r.hasAutoCreateConnections()) {\n+\n+                // Report to all of the connections that the service is no longer\n+                // available.\n+                if (r.connections != null && r.connections.values() != null) {\n+                    Iterator<ArrayList<ConnectionRecord>> crs = r.connections.values().iterator();\n+                    while (crs.hasNext()) {\n+                        ArrayList<ConnectionRecord> c = crs.next();\n+                        for (int i = 0; i < c.size(); i++) {\n+                            ConnectionRecord cr = c.get(i);\n+                            // There is still a connection to the service that is\n+                            // being brought down.  Mark it as dead.\n+                            cr.serviceDead = true;\n+                            try {\n+                                cr.conn.connected(r.name, null);\n+                            } catch (Exception e) {\n+\n+                            }\n+                        }\n+                    }\n+                }\n \n-            stopServiceCommon(r);\n+                // Tell the service that it has been unbound.\n+                if (r.process != null && r.process.appThread != null) {\n+                    Set<Map.Entry<Intent.FilterComparison, ServiceRecord.IntentBindRecord>> entrySet\n+                            = r.bindings.entrySet();\n+                    for (Map.Entry<Intent.FilterComparison, ServiceRecord.IntentBindRecord> entry\n+                            : entrySet) {\n+                        ServiceRecord.IntentBindRecord ibr = entry.getValue();\n+                        if (ibr.hasBound) {\n+                            try {\n+                                ibr.hasBound = false;\n+                                IApplicationThreadCompat.scheduleUnbindService(r.process.appThread,\n+                                        r, ibr.intent);\n+                            } catch (Exception e) {\n+\n+                            }\n+                        }\n+                    }\n+                }\n+\n+                try {\n+                    IApplicationThreadCompat.scheduleStopService(r.process.appThread, r);\n+                } catch (RemoteException e) {\n+                    e.printStackTrace();\n+                }\n+                mHistory.remove(r);\n+            }\n             return 1;\n         }\n     }\n@@ -424,67 +470,18 @@ public boolean stopServiceToken(ComponentName className, IBinder token, int star\n         synchronized (this) {\n             ServiceRecord r = (ServiceRecord) token;\n             if (r != null && (r.startId == startId || startId == -1)) {\n-                stopServiceCommon(r);\n-                return true;\n-            }\n-            return false;\n-        }\n-    }\n-\n-    /**\n-     * Extracting common method of stopService(see bringDownServiceIfNeededLocked in android source)\n-     * @param r\n-     */\n-    private void stopServiceCommon(ServiceRecord r) {\n-        if (r.hasAutoCreateConnections()) {\n-            return;\n-        }\n-\n-        // Report to all of the connections that the service is no longer\n-        // available.\n-        if (r.connections != null && r.connections.values() != null) {\n-            Iterator<ArrayList<ConnectionRecord>> crs = r.connections.values().iterator();\n-            while (crs.hasNext()) {\n-                ArrayList<ConnectionRecord> c = crs.next();\n-                for (int i = 0; i < c.size(); i++) {\n-                    ConnectionRecord cr = c.get(i);\n-                    // There is still a connection to the service that is\n-                    // being brought down.  Mark it as dead.\n-                    cr.serviceDead = true;\n-                    try {\n-                        cr.conn.connected(r.name, null);\n-                    } catch (Exception e) {\n-\n-                    }\n+                try {\n+                    IApplicationThreadCompat.scheduleStopService(r.process.appThread, r);\n+                } catch (RemoteException e) {\n+                    e.printStackTrace();\n                 }\n-            }\n-        }\n-\n-        // Tell the service that it has been unbound.\n-        if (r.process != null && r.process.appThread != null) {\n-            Set<Map.Entry<Intent.FilterComparison, ServiceRecord.IntentBindRecord>> entrySet\n-                    = r.bindings.entrySet();\n-            for (Map.Entry<Intent.FilterComparison, ServiceRecord.IntentBindRecord> entry\n-                    : entrySet) {\n-                ServiceRecord.IntentBindRecord ibr = entry.getValue();\n-                if (ibr.hasBound) {\n-                    try {\n-                        ibr.hasBound = false;\n-                        IApplicationThreadCompat.scheduleUnbindService(r.process.appThread,\n-                                r, ibr.intent);\n-                    } catch (Exception e) {\n-\n-                    }\n+                if (Build.VERSION.SDK_INT < Build.VERSION_CODES.LOLLIPOP) {\n+                    mHistory.remove(r);\n                 }\n+                return true;\n             }\n+            return false;\n         }\n-\n-        try {\n-            IApplicationThreadCompat.scheduleStopService(r.process.appThread, r);\n-        } catch (RemoteException e) {\n-            e.printStackTrace();\n-        }\n-        mHistory.remove(r);\n     }\n \n     @Override",
      "parent_sha": "32dde12be71f0716bcf99499421649f25fd0fb62"
    }
  },
  {
    "oid": "bad79f16c78c8aea6997190c60a3388af66dda07",
    "message": "Fix: issue #118.",
    "date": "2016-09-21T09:55:49Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/bad79f16c78c8aea6997190c60a3388af66dda07",
    "details": {
      "sha": "9e664dee918c460e5f6e1609362d6c116e1cdc34",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/hook/patchs/appops/AppOpsManagerPatch.java",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/bad79f16c78c8aea6997190c60a3388af66dda07/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fappops%2FAppOpsManagerPatch.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/bad79f16c78c8aea6997190c60a3388af66dda07/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fappops%2FAppOpsManagerPatch.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fappops%2FAppOpsManagerPatch.java?ref=bad79f16c78c8aea6997190c60a3388af66dda07",
      "patch": "@@ -47,7 +47,7 @@ protected void onBindHooks() {\n \t\taddHook(new BaseHook(\"setMode\", 1, 2));\n \t\taddHook(new BaseHook(\"checkAudioOperation\", 2, 3));\n \t\taddHook(new BaseHook(\"setAudioRestriction\", 2, -1));\n-\t\taddHook(new ReplaceCallingPkgHook(\"noteProxyOperation\"));\n+\t\taddHook(new BaseHook(\"noteProxyOperation\", 2, 3));\n \t\taddHook(new ReplaceLastPkgHook(\"resetAllModes\"));\n \t}\n ",
      "parent_sha": "61da7c57e482c8231cf0df4d90dec48a55eceae1"
    }
  },
  {
    "oid": "bf3dd532a0e2350261c17d5a4c0f87ce2b9f3032",
    "message": "Fix: getIntentSender bug.",
    "date": "2017-01-16T02:12:38Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/bf3dd532a0e2350261c17d5a4c0f87ce2b9f3032",
    "details": {
      "sha": "ee82044ed74792995a640edc1e7aee3fcd32bdb0",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/hook/patchs/am/GetIntentSender.java",
      "status": "modified",
      "additions": 83,
      "deletions": 81,
      "changes": 164,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/bf3dd532a0e2350261c17d5a4c0f87ce2b9f3032/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fam%2FGetIntentSender.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/bf3dd532a0e2350261c17d5a4c0f87ce2b9f3032/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fam%2FGetIntentSender.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fam%2FGetIntentSender.java?ref=bf3dd532a0e2350261c17d5a4c0f87ce2b9f3032",
      "patch": "@@ -21,88 +21,90 @@\n  */\n /* package */ class GetIntentSender extends BaseStartActivity {\n \n-\t@Override\n-\tpublic String getName() {\n-\t\treturn \"getIntentSender\";\n-\t}\n-\n-\t@Override\n-\tpublic Object call(Object who, Method method, Object... args) throws Throwable {\n-\t\tString creator = (String) args[1];\n-\t\targs[1] = getHostPkg();\n-\t\tString[] resolvedTypes = (String[]) args[6];\n-\t\tint type = (int) args[0];\n-\t\tif (args[5] instanceof Intent[]) {\n-\t\t\tIntent[] intents = (Intent[]) args[5];\n-\t\t\tif (intents.length > 0) {\n-\t\t\t\tIntent intent = intents[intents.length - 1];\n-\t\t\t\tif (resolvedTypes != null && resolvedTypes.length > 0) {\n-\t\t\t\t\tintent.setDataAndType(intent.getData(), resolvedTypes[resolvedTypes.length - 1]);\n-\t\t\t\t}\n-\t\t\t\tIntent proxyIntent = redirectIntentSender(type, creator, intent);\n-\t\t\t\tif (proxyIntent != null) {\n-\t\t\t\t\tintents[intents.length - 1] = proxyIntent;\n-\t\t\t\t}\n-\t\t\t}\n-\t\t}\n-\t\tif (args.length > 7 && args[7] instanceof Integer) {\n+    @Override\n+    public String getName() {\n+        return \"getIntentSender\";\n+    }\n+\n+    @Override\n+    public Object call(Object who, Method method, Object... args) throws Throwable {\n+        String creator = (String) args[1];\n+        args[1] = getHostPkg();\n+        String[] resolvedTypes = (String[]) args[6];\n+        int type = (int) args[0];\n+        if (args[5] instanceof Intent[]) {\n+            Intent[] intents = (Intent[]) args[5];\n+            if (intents.length > 0) {\n+                Intent intent = intents[intents.length - 1];\n+                if (resolvedTypes != null && resolvedTypes.length > 0) {\n+                    intent.setDataAndType(intent.getData(), resolvedTypes[resolvedTypes.length - 1]);\n+                }\n+                Intent proxyIntent = redirectIntentSender(type, creator, intent);\n+                if (proxyIntent != null) {\n+                    intents[intents.length - 1] = proxyIntent;\n+                }\n+            }\n+        }\n+        if (args.length > 7 && args[7] instanceof Integer) {\n             args[7] = PendingIntent.FLAG_UPDATE_CURRENT;\n         }\n-\t\targs[6] = new String[] {null};\n-\t\tIInterface sender = (IInterface) method.invoke(who, args);\n-\t\tif (Build.VERSION.SDK_INT < Build.VERSION_CODES.JELLY_BEAN_MR2 && sender != null && creator != null) {\n-\t\t\tVActivityManager.get().addPendingIntent(sender.asBinder(), creator);\n-\t\t}\n-\t\treturn sender;\n-\t}\n-\n-\tprivate Intent redirectIntentSender(int type, String creator, Intent intent) {\n-\t\tIntent newIntent = intent.cloneFilter();\n-\t\tboolean ok = false;\n-\n-\t\tswitch (type) {\n-\t\t\tcase ActivityManagerCompat.INTENT_SENDER_ACTIVITY: {\n-\n-\t\t\t\tComponentInfo info = VirtualCore.get().resolveActivityInfo(intent, VUserHandle.myUserId());\n-\t\t\t\tif (info != null) {\n-\t\t\t\t\tok = true;\n-\t\t\t\t\tnewIntent.setClass(getHostContext(), StubPendingActivity.class);\n-\t\t\t\t\tnewIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\n-\t\t\t\t}\n-\n-\t\t\t} break;\n-\n-\t\t\tcase ActivityManagerCompat.INTENT_SENDER_SERVICE: {\n-\t\t\t\tComponentInfo info = VirtualCore.get().resolveServiceInfo(intent, VUserHandle.myUserId());\n-\t\t\t\tif (info != null) {\n-\t\t\t\t\tok= true;\n-\t\t\t\t\tnewIntent.setClass(getHostContext(), StubPendingService.class);\n-\t\t\t\t}\n-\n-\t\t\t} break;\n-\n-\t\t\tcase ActivityManagerCompat.INTENT_SENDER_BROADCAST: {\n-\t\t\t\tok = true;\n-\t\t\t\tnewIntent.setClass(getHostContext(), StubPendingReceiver.class);\n-\t\t\t} break;\n-\n-\t\t}\n-\n-\t\tif (!ok) {\n-\t\t\treturn null;\n-\t\t}\n-\n-\t\tnewIntent.putExtra(\"_VA_|_user_id_\", VUserHandle.myUserId());\n-\t\tnewIntent.putExtra(\"_VA_|_intent_\", intent);\n-\t\tnewIntent.putExtra(\"_VA_|_creator_\", creator);\n-\t\tnewIntent.putExtra(\"_VA_|_from_inner_\", true);\n-\n-\t\treturn newIntent;\n-\t}\n-\n-\t@Override\n-\tpublic boolean isEnable() {\n-\t\treturn isAppProcess();\n-\t}\n+        IInterface sender = (IInterface) method.invoke(who, args);\n+        if (Build.VERSION.SDK_INT < Build.VERSION_CODES.JELLY_BEAN_MR2 && sender != null && creator != null) {\n+            VActivityManager.get().addPendingIntent(sender.asBinder(), creator);\n+        }\n+        return sender;\n+    }\n+\n+    private Intent redirectIntentSender(int type, String creator, Intent intent) {\n+        Intent newIntent = intent.cloneFilter();\n+        boolean ok = false;\n+\n+        switch (type) {\n+            case ActivityManagerCompat.INTENT_SENDER_ACTIVITY: {\n+\n+                ComponentInfo info = VirtualCore.get().resolveActivityInfo(intent, VUserHandle.myUserId());\n+                if (info != null) {\n+                    ok = true;\n+                    newIntent.setClass(getHostContext(), StubPendingActivity.class);\n+                    newIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\n+                }\n+\n+            }\n+            break;\n+\n+            case ActivityManagerCompat.INTENT_SENDER_SERVICE: {\n+                ComponentInfo info = VirtualCore.get().resolveServiceInfo(intent, VUserHandle.myUserId());\n+                if (info != null) {\n+                    ok = true;\n+                    newIntent.setClass(getHostContext(), StubPendingService.class);\n+                }\n+\n+            }\n+            break;\n+\n+            case ActivityManagerCompat.INTENT_SENDER_BROADCAST: {\n+                ok = true;\n+                newIntent.setClass(getHostContext(), StubPendingReceiver.class);\n+            }\n+            break;\n+\n+        }\n+\n+        if (!ok) {\n+            return null;\n+        }\n+\n+        newIntent.putExtra(\"_VA_|_user_id_\", VUserHandle.myUserId());\n+        newIntent.putExtra(\"_VA_|_intent_\", intent);\n+        newIntent.putExtra(\"_VA_|_creator_\", creator);\n+        newIntent.putExtra(\"_VA_|_from_inner_\", true);\n+\n+        return newIntent;\n+    }\n+\n+    @Override\n+    public boolean isEnable() {\n+        return isAppProcess();\n+    }\n \n }",
      "parent_sha": "fd52303c1fa7b50cd791e4780572c8319d951949"
    }
  },
  {
    "oid": "ca9a7ae0c6fc21f952d057cab7fea60c9235fab8",
    "message": "[Exposed] Do not use interpreter mode temporarily.",
    "date": "2018-06-06T05:58:25Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/ca9a7ae0c6fc21f952d057cab7fea60c9235fab8",
    "details": {
      "sha": "be363e172696965104a4c1bca9478e618f79f6b4",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/server/pm/VAppManagerService.java",
      "status": "modified",
      "additions": 11,
      "deletions": 13,
      "changes": 24,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/ca9a7ae0c6fc21f952d057cab7fea60c9235fab8/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fpm%2FVAppManagerService.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/ca9a7ae0c6fc21f952d057cab7fea60c9235fab8/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fpm%2FVAppManagerService.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fpm%2FVAppManagerService.java?ref=ca9a7ae0c6fc21f952d057cab7fea60c9235fab8",
      "patch": "@@ -8,8 +8,6 @@\n \n import com.lody.virtual.client.core.InstallStrategy;\n import com.lody.virtual.client.core.VirtualCore;\n-import com.lody.virtual.client.env.VirtualRuntime;\n-import com.lody.virtual.helper.ArtDexOptimizer;\n import com.lody.virtual.helper.collection.IntArray;\n import com.lody.virtual.helper.compat.NativeLibraryHelperCompat;\n import com.lody.virtual.helper.utils.ArrayUtils;\n@@ -238,17 +236,17 @@ public synchronized InstallResult installPackage(String path, int flags, boolean\n         PackageCacheManager.put(pkg, ps);\n         mPersistenceLayer.save();\n         if (!dependSystem) {\n-            boolean runDexOpt = false;\n-            if (VirtualRuntime.isArt()) {\n-                try {\n-                    ArtDexOptimizer.interpretDex2Oat(ps.apkPath, VEnvironment.getOdexFile(ps.packageName).getPath());\n-                } catch (IOException e) {\n-                    e.printStackTrace();\n-                    runDexOpt = true;\n-                }\n-            } else {\n-                runDexOpt = true;\n-            }\n+            boolean runDexOpt = true;\n+//            if (VirtualRuntime.isArt()) {\n+//                try {\n+//                    ArtDexOptimizer.interpretDex2Oat(ps.apkPath, VEnvironment.getOdexFile(ps.packageName).getPath());\n+//                } catch (IOException e) {\n+//                    e.printStackTrace();\n+//                    runDexOpt = true;\n+//                }\n+//            } else {\n+//                runDexOpt = true;\n+//            }\n             if (runDexOpt) {\n                 try {\n                     DexFile.loadDex(ps.apkPath, VEnvironment.getOdexFile(ps.packageName).getPath(), 0).close();",
      "parent_sha": "fadd440742276d4c9e77816c813e896580a3322b"
    }
  },
  {
    "oid": "fbf74fd8516d4980e6228dfe0becb9abda072fdf",
    "message": "Fix:\u6dfb\u52a0\u7cfb\u7edf\u548cVirtualApp\u7684\u5b89\u88c5\u5378\u8f7d\u5e7f\u64ad\u3002",
    "date": "2016-08-05T06:41:50Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/fbf74fd8516d4980e6228dfe0becb9abda072fdf",
    "details": {
      "sha": "74dd508cdd6f503b9a219134f6b4850b5ee86f12",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/service/pm/VAppService.java",
      "status": "modified",
      "additions": 256,
      "deletions": 219,
      "changes": 475,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/fbf74fd8516d4980e6228dfe0becb9abda072fdf/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fservice%2Fpm%2FVAppService.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/fbf74fd8516d4980e6228dfe0becb9abda072fdf/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fservice%2Fpm%2FVAppService.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fservice%2Fpm%2FVAppService.java?ref=fbf74fd8516d4980e6228dfe0becb9abda072fdf",
      "patch": "@@ -1,18 +1,22 @@\n package com.lody.virtual.service.pm;\n \n+import android.content.Intent;\n+import android.net.Uri;\n import android.os.RemoteCallbackList;\n import android.os.RemoteException;\n import android.util.DisplayMetrics;\n \n import com.lody.virtual.client.core.InstallStrategy;\n import com.lody.virtual.client.core.VirtualCore;\n+import com.lody.virtual.client.service.ServiceManagerNative;\n import com.lody.virtual.helper.compat.NativeLibraryHelperCompat;\n import com.lody.virtual.helper.proto.AppInfo;\n import com.lody.virtual.helper.proto.InstallResult;\n import com.lody.virtual.helper.utils.FileIO;\n import com.lody.virtual.helper.utils.VLog;\n import com.lody.virtual.service.AppFileSystem;\n import com.lody.virtual.service.IAppManager;\n+import com.lody.virtual.service.am.VReceiverService;\n import com.lody.virtual.service.interfaces.IAppObserver;\n import com.lody.virtual.service.process.VProcessService;\n \n@@ -23,226 +27,259 @@\n \n /**\n  * @author Lody\n- *\n  */\n public class VAppService extends IAppManager.Stub {\n \n-\tprivate static final String TAG = VAppService.class.getSimpleName();\n-\n-\tprivate static final AtomicReference<VAppService> gService = new AtomicReference<>();\n-\n-\tprivate RemoteCallbackList<IAppObserver> remoteCallbackList = new RemoteCallbackList<IAppObserver>();\n-\n-\tpublic static VAppService getService() {\n-\t\treturn gService.get();\n-\t}\n-\n-\tprivate static void ensureFoldersCreated(File... folders) {\n-\t\tfor (File folder : folders) {\n-\t\t\tif (!folder.exists() && !folder.mkdirs()) {\n-\t\t\t\tVLog.w(TAG, \"Warning: unable to create folder : \" + folder.getPath());\n-\t\t\t}\n-\t\t}\n-\t}\n-\n-\tprivate static PackageParser.Package parsePackage(File apk, int flags) {\n-\t\tPackageParser parser = new PackageParser(apk.getPath());\n-\t\tDisplayMetrics metrics = new DisplayMetrics();\n-\t\tmetrics.setToDefaults();\n-\t\treturn parser.parsePackage(apk, apk.getPath(), metrics, flags);\n-\t}\n-\n-\tpublic static void systemReady() {\n-\t\tVAppService instance = new VAppService();\n-\t\tgService.set(instance);\n-\t\tinstance.preloadAllApps();\n-\t}\n-\n-\tpublic void preloadAllApps() {\n-\t\tList<File> appList = AppFileSystem.getDefault().getAllApps();\n-\t\tfor (File app : appList) {\n-\t\t\tInstallResult res = install(app.getPath(),\n-\t\t\t\t\tInstallStrategy.TERMINATE_IF_EXIST | InstallStrategy.DEPEND_SYSTEM_IF_EXIST, true);\n-\t\t\tif (!res.isSuccess) {\n-\t\t\t\tFileIO.deleteDir(app);\n-\t\t\t}\n-\t\t}\n-\t}\n-\n-\t@Override\n-\tpublic InstallResult installApp(String apkPath, int flags) {\n-\t\treturn install(apkPath, flags, false);\n-\t}\n-\n-\tprivate synchronized InstallResult install(String apkPath, int flags, boolean onlyScan) {\n-\t\tif (apkPath == null) {\n-\t\t\treturn InstallResult.makeFailure(\"Not given the apk path.\");\n-\t\t}\n-\t\tFile apk = new File(apkPath);\n-\t\tif (!apk.exists() || !apk.isFile()) {\n-\t\t\treturn InstallResult.makeFailure(\"APK File is not exist.\");\n-\t\t}\n-\t\tPackageParser.Package pkg = parsePackage(apk, 0);\n-\t\tif (pkg == null) {\n-\t\t\treturn InstallResult.makeFailure(\"Unable to parse the package.\");\n-\t\t}\n-\t\tInstallResult res = new InstallResult();\n-\t\tres.packageName = pkg.packageName;\n-\t\tPackageParser.Package existOne = PackageCache.get(pkg.packageName);\n-\t\tif (existOne != null) {\n-\t\t\tif ((flags & InstallStrategy.IGNORE_NEW_VERSION) != 0) {\n-\t\t\t\tres.isUpdate = true;\n-\t\t\t\treturn res;\n-\t\t\t}\n-\t\t\tif (!canUpdate(existOne, pkg, flags)) {\n-\t\t\t\treturn InstallResult.makeFailure(\"Unable to update the Apk.\");\n-\t\t\t}\n-\t\t\tres.isUpdate = true;\n-\t\t}\n-\n-\t\tFile libDir = AppFileSystem.getDefault().getAppLibFolder(pkg.packageName);\n-\t\tboolean dependSystem = (flags & InstallStrategy.DEPEND_SYSTEM_IF_EXIST) != 0\n-\t\t\t\t&& VirtualCore.getCore().isOutsideInstalled(pkg.packageName);\n-\n-\t\tif (!onlyScan) {\n-\t\t\tif (res.isUpdate) {\n-\t\t\t\tFileIO.deleteDir(libDir);\n-\t\t\t}\n-\t\t\tif (!libDir.exists() && !libDir.mkdirs()) {\n-\t\t\t\treturn InstallResult.makeFailure(\"Unable to create lib dir.\");\n-\t\t\t}\n-\t\t\tint libRes = NativeLibraryHelperCompat.copyNativeBinaries(new File(apkPath), libDir);\n-\t\t\tif (libRes < 0) {\n-\t\t\t\treturn InstallResult.makeFailure(\"This APK's native lib is not support your device.\");\n-\t\t\t}\n-\n-\t\t\tif (!dependSystem) {\n-\t\t\t\tFile storeFile = AppFileSystem.getDefault().getAppApkFile(pkg.packageName);\n-\t\t\t\tFile parentFolder = storeFile.getParentFile();\n-\t\t\t\tif (!parentFolder.exists() && !parentFolder.mkdirs()) {\n-\t\t\t\t\tVLog.w(TAG, \"Warning: unable to create folder : \" + storeFile.getPath());\n-\t\t\t\t} else if (storeFile.exists() && !storeFile.delete()) {\n-\t\t\t\t\tVLog.w(TAG, \"Warning: unable to delete file : \" + storeFile.getPath());\n-\t\t\t\t}\n-\t\t\t\tFileIO.copyFile(apk, storeFile);\n-\t\t\t\tapk = storeFile;\n-\t\t\t}\n-\t\t}\n-\t\tif (existOne != null) {\n-\t\t\tPackageCache.remove(pkg.packageName);\n-\t\t}\n-\t\tAppFileSystem fileSystem = AppFileSystem.getDefault();\n-\t\tAppInfo appInfo = new AppInfo();\n-\t\tappInfo.dependSystem = dependSystem;\n-\t\tappInfo.apkPath = apk.getPath();\n-\t\tappInfo.packageName = pkg.packageName;\n-\t\tappInfo.applicationInfo = pkg.applicationInfo;\n-\n-\t\tFile dataFolder = fileSystem.getAppPackageFolder(pkg.packageName);\n-\t\tFile libFolder = fileSystem.getAppLibFolder(pkg.packageName);\n-\t\tFile dvmCacheFolder = fileSystem.getAppDVMCacheFolder(pkg.packageName);\n-\t\tFile cacheFolder = fileSystem.getAppCacheFolder(pkg.packageName);\n-\n-\t\tensureFoldersCreated(dataFolder, libFolder, dvmCacheFolder, cacheFolder);\n-\n-\t\tappInfo.dataDir = dataFolder.getPath();\n-\t\tappInfo.libDir = libFolder.getPath();\n-\t\tappInfo.cacheDir = cacheFolder.getPath();\n-\t\tappInfo.odexDir = dvmCacheFolder.getPath();\n-\t\tPackageCache.put(pkg, appInfo);\n-\t\tnotifyAppInstalled(pkg.packageName);\n-\t\tres.isSuccess = true;\n-\t\treturn res;\n-\t}\n-\n-\tprivate boolean canUpdate(PackageParser.Package existOne, PackageParser.Package newOne, int flags) {\n-\t\tif ((flags & InstallStrategy.COMPARE_VERSION) != 0) {\n-\t\t\tif (existOne.mVersionCode < newOne.mVersionCode) {\n-\t\t\t\treturn true;\n-\t\t\t}\n-\t\t}\n-\t\tif ((flags & InstallStrategy.TERMINATE_IF_EXIST) != 0) {\n-\t\t\treturn false;\n-\t\t}\n-\t\tif ((flags & InstallStrategy.UPDATE_IF_EXIST) != 0) {\n-\t\t\treturn true;\n-\t\t}\n-\t\treturn false;\n-\t}\n-\n-\tpublic boolean uninstallApp(String pkg) {\n-\t\tsynchronized (PackageCache.sPackageCaches) {\n-\t\t\tif (isAppInstalled(pkg)) {\n-\t\t\t\tVProcessService.getService().killAppByPkg(pkg);\n-\t\t\t\tFileIO.deleteDir(AppFileSystem.getDefault().getAppPackageFolder(pkg));\n-\t\t\t\tPackageCache.remove(pkg);\n-\t\t\t\tnotifyAppUninstalled(pkg);\n-\t\t\t\treturn true;\n-\t\t\t}\n-\t\t}\n-\t\treturn false;\n-\t}\n-\n-\tpublic List<AppInfo> getAllApps() {\n-\t\treturn new ArrayList<>(PackageCache.sAppInfos.values());\n-\t}\n-\n-\tpublic int getAppCount() {\n-\t\treturn PackageCache.sAppInfos.size();\n-\t}\n-\n-\tpublic boolean isAppInstalled(String pkg) {\n-\t\treturn pkg != null && PackageCache.sPackageCaches.get(pkg) != null;\n-\t}\n-\n-\tprivate void notifyAppInstalled(String pkgName) {\n-\t\tint N = remoteCallbackList.beginBroadcast();\n-\t\twhile (N-- > 0) {\n-\t\t\ttry {\n-\t\t\t\tremoteCallbackList.getBroadcastItem(N).onNewApp(pkgName);\n-\t\t\t} catch (RemoteException e) {\n-\t\t\t\t// Ignore\n-\t\t\t}\n-\t\t}\n-\t\tremoteCallbackList.finishBroadcast();\n-\t}\n-\n-\tprivate void notifyAppUninstalled(String pkgName) {\n-\t\tint N = remoteCallbackList.beginBroadcast();\n-\t\twhile (N-- > 0) {\n-\t\t\ttry {\n-\t\t\t\tremoteCallbackList.getBroadcastItem(N).onRemoveApp(pkgName);\n-\t\t\t} catch (RemoteException e) {\n-\t\t\t\t// Ignore\n-\t\t\t}\n-\t\t}\n-\t\tremoteCallbackList.finishBroadcast();\n-\t}\n-\n-\t@Override\n-\tpublic void registerObserver(IAppObserver observer) {\n-\t\ttry {\n-\t\t\tremoteCallbackList.register(observer);\n-\t\t} catch (Throwable e) {\n-\t\t\t// Ignore\n-\t\t}\n-\t}\n-\n-\t@Override\n-\tpublic void unregisterObserver(IAppObserver observer) {\n-\t\ttry {\n-\t\t\tremoteCallbackList.unregister(observer);\n-\t\t} catch (Throwable e) {\n-\t\t\t// Ignore\n-\t\t}\n-\t}\n-\n-\tpublic AppInfo findAppInfo(String pkg) {\n-\t\tsynchronized (PackageCache.class) {\n-\t\t\tif (pkg != null) {\n-\t\t\t\treturn PackageCache.sAppInfos.get(pkg);\n-\t\t\t}\n-\t\t\treturn null;\n-\t\t}\n-\t}\n+  private static final String TAG = VAppService.class.getSimpleName();\n+\n+  private static final AtomicReference<VAppService> gService = new AtomicReference<>();\n+\n+  private RemoteCallbackList<IAppObserver> remoteCallbackList = new RemoteCallbackList<IAppObserver>();\n+\n+  public static VAppService getService() {\n+    return gService.get();\n+  }\n+\n+  private static void ensureFoldersCreated(File... folders) {\n+    for (File folder : folders) {\n+      if (!folder.exists() && !folder.mkdirs()) {\n+        VLog.w(TAG, \"Warning: unable to create folder : \" + folder.getPath());\n+      }\n+    }\n+  }\n+\n+  private static PackageParser.Package parsePackage(File apk, int flags) {\n+    PackageParser parser = new PackageParser(apk.getPath());\n+    DisplayMetrics metrics = new DisplayMetrics();\n+    metrics.setToDefaults();\n+    return parser.parsePackage(apk, apk.getPath(), metrics, flags);\n+  }\n+\n+  public static void systemReady() {\n+    VAppService instance = new VAppService();\n+    gService.set(instance);\n+    instance.preloadAllApps();\n+  }\n+\n+  public void preloadAllApps() {\n+    List<File> appList = AppFileSystem.getDefault().getAllApps();\n+    for (File app : appList) {\n+      InstallResult res = install(app.getPath(),\n+              InstallStrategy.TERMINATE_IF_EXIST | InstallStrategy.DEPEND_SYSTEM_IF_EXIST, true);\n+      if (!res.isSuccess) {\n+        FileIO.deleteDir(app);\n+      }\n+    }\n+  }\n+\n+  @Override\n+  public InstallResult installApp(String apkPath, int flags) {\n+    return install(apkPath, flags, false);\n+  }\n+\n+  private synchronized InstallResult install(String apkPath, int flags, boolean onlyScan) {\n+    if (apkPath == null) {\n+      return InstallResult.makeFailure(\"Not given the apk path.\");\n+    }\n+    File apk = new File(apkPath);\n+    if (!apk.exists() || !apk.isFile()) {\n+      return InstallResult.makeFailure(\"APK File is not exist.\");\n+    }\n+    PackageParser.Package pkg = parsePackage(apk, 0);\n+    if (pkg == null) {\n+      return InstallResult.makeFailure(\"Unable to parse the package.\");\n+    }\n+    InstallResult res = new InstallResult();\n+    res.packageName = pkg.packageName;\n+    PackageParser.Package existOne = PackageCache.get(pkg.packageName);\n+    if (existOne != null) {\n+      if ((flags & InstallStrategy.IGNORE_NEW_VERSION) != 0) {\n+        res.isUpdate = true;\n+        return res;\n+      }\n+      if (!canUpdate(existOne, pkg, flags)) {\n+        return InstallResult.makeFailure(\"Unable to update the Apk.\");\n+      }\n+      res.isUpdate = true;\n+    }\n+\n+    File libDir = AppFileSystem.getDefault().getAppLibFolder(pkg.packageName);\n+    boolean dependSystem = (flags & InstallStrategy.DEPEND_SYSTEM_IF_EXIST) != 0\n+            && VirtualCore.getCore().isOutsideInstalled(pkg.packageName);\n+\n+    if (!onlyScan) {\n+      if (res.isUpdate) {\n+        FileIO.deleteDir(libDir);\n+      }\n+      if (!libDir.exists() && !libDir.mkdirs()) {\n+        return InstallResult.makeFailure(\"Unable to create lib dir.\");\n+      }\n+      int libRes = NativeLibraryHelperCompat.copyNativeBinaries(new File(apkPath), libDir);\n+      if (libRes < 0) {\n+        return InstallResult.makeFailure(\"This APK's native lib is not support your device.\");\n+      }\n+\n+      if (!dependSystem) {\n+        File storeFile = AppFileSystem.getDefault().getAppApkFile(pkg.packageName);\n+        File parentFolder = storeFile.getParentFile();\n+        if (!parentFolder.exists() && !parentFolder.mkdirs()) {\n+          VLog.w(TAG, \"Warning: unable to create folder : \" + storeFile.getPath());\n+        } else if (storeFile.exists() && !storeFile.delete()) {\n+          VLog.w(TAG, \"Warning: unable to delete file : \" + storeFile.getPath());\n+        }\n+        FileIO.copyFile(apk, storeFile);\n+        apk = storeFile;\n+      }\n+    }\n+    if (existOne != null) {\n+      PackageCache.remove(pkg.packageName);\n+    }\n+    AppFileSystem fileSystem = AppFileSystem.getDefault();\n+    AppInfo appInfo = new AppInfo();\n+    appInfo.dependSystem = dependSystem;\n+    appInfo.apkPath = apk.getPath();\n+    appInfo.packageName = pkg.packageName;\n+    appInfo.applicationInfo = pkg.applicationInfo;\n+\n+    File dataFolder = fileSystem.getAppPackageFolder(pkg.packageName);\n+    File libFolder = fileSystem.getAppLibFolder(pkg.packageName);\n+    File dvmCacheFolder = fileSystem.getAppDVMCacheFolder(pkg.packageName);\n+    File cacheFolder = fileSystem.getAppCacheFolder(pkg.packageName);\n+\n+    ensureFoldersCreated(dataFolder, libFolder, dvmCacheFolder, cacheFolder);\n+\n+    appInfo.dataDir = dataFolder.getPath();\n+    appInfo.libDir = libFolder.getPath();\n+    appInfo.cacheDir = cacheFolder.getPath();\n+    appInfo.odexDir = dvmCacheFolder.getPath();\n+    PackageCache.put(pkg, appInfo);\n+    notifyAppInstalled(pkg.packageName);\n+    res.isSuccess = true;\n+    return res;\n+  }\n+\n+  private boolean canUpdate(PackageParser.Package existOne, PackageParser.Package newOne, int flags) {\n+    if ((flags & InstallStrategy.COMPARE_VERSION) != 0) {\n+      if (existOne.mVersionCode < newOne.mVersionCode) {\n+        return true;\n+      }\n+    }\n+    if ((flags & InstallStrategy.TERMINATE_IF_EXIST) != 0) {\n+      return false;\n+    }\n+    if ((flags & InstallStrategy.UPDATE_IF_EXIST) != 0) {\n+      return true;\n+    }\n+    return false;\n+  }\n+\n+  public boolean uninstallApp(String pkg) {\n+    synchronized (PackageCache.sPackageCaches) {\n+      if (isAppInstalled(pkg)) {\n+        VProcessService.getService().killAppByPkg(pkg);\n+        FileIO.deleteDir(AppFileSystem.getDefault().getAppPackageFolder(pkg));\n+        PackageCache.remove(pkg);\n+        notifyAppUninstalled(pkg);\n+        return true;\n+      }\n+    }\n+    return false;\n+  }\n+\n+  public List<AppInfo> getAllApps() {\n+    return new ArrayList<>(PackageCache.sAppInfos.values());\n+  }\n+\n+  public int getAppCount() {\n+    return PackageCache.sAppInfos.size();\n+  }\n+\n+  public boolean isAppInstalled(String pkg) {\n+    return pkg != null && PackageCache.sPackageCaches.get(pkg) != null;\n+  }\n+\n+  private void notifyAppInstalled(String pkgName) {\n+    int N = remoteCallbackList.beginBroadcast();\n+    while (N-- > 0) {\n+      try {\n+        remoteCallbackList.getBroadcastItem(N).onNewApp(pkgName);\n+      } catch (RemoteException e) {\n+        // Ignore\n+      }\n+    }\n+    remoteCallbackList.finishBroadcast();\n+\n+    notifySysInstalled(pkgName);\n+    notifyVirtualInstalled(pkgName);\n+  }\n+\n+  private void notifyAppUninstalled(String pkgName) {\n+    int N = remoteCallbackList.beginBroadcast();\n+    while (N-- > 0) {\n+      try {\n+        remoteCallbackList.getBroadcastItem(N).onRemoveApp(pkgName);\n+      } catch (RemoteException e) {\n+        // Ignore\n+      }\n+    }\n+    remoteCallbackList.finishBroadcast();\n+\n+    notifySysUninstalled(pkgName);\n+    notifyVirtualUninstalled(pkgName);\n+  }\n+\n+  private void notifySysInstalled(String pkgName) {\n+    Intent intent = new Intent(Intent.ACTION_PACKAGE_ADDED);\n+    Uri uri = Uri.fromParts(\"package\", pkgName, null);\n+    intent.setData(uri);\n+    VReceiverService.sendBroadcast(intent);\n+  }\n+\n+  private void notifySysUninstalled(String pkgName) {\n+    Intent intent = new Intent(Intent.ACTION_PACKAGE_REMOVED);\n+    Uri uri = Uri.fromParts(\"package\", pkgName, null);\n+    intent.setData(uri);\n+    VReceiverService.sendBroadcast(intent);\n+  }\n+\n+  private void notifyVirtualInstalled(String pkgName) {\n+    Intent virtualIntent = new Intent(ServiceManagerNative.ACTION_PACKAGE_ADDED);\n+    Uri uri = Uri.fromParts(\"package\", pkgName, null);\n+    virtualIntent.setData(uri);\n+    VirtualCore.getCore().getContext().sendBroadcast(virtualIntent);\n+  }\n+\n+  private void notifyVirtualUninstalled(String pkgName) {\n+    Intent virtualIntent = new Intent(ServiceManagerNative.ACTION_PACKAGE_REMOVE);\n+    Uri uri = Uri.fromParts(\"package\", pkgName, null);\n+    virtualIntent.setData(uri);\n+    VirtualCore.getCore().getContext().sendBroadcast(virtualIntent);\n+  }\n+\n+  @Override\n+  public void registerObserver(IAppObserver observer) {\n+    try {\n+      remoteCallbackList.register(observer);\n+    } catch (Throwable e) {\n+      // Ignore\n+    }\n+  }\n+\n+  @Override\n+  public void unregisterObserver(IAppObserver observer) {\n+    try {\n+      remoteCallbackList.unregister(observer);\n+    } catch (Throwable e) {\n+      // Ignore\n+    }\n+  }\n+\n+  public AppInfo findAppInfo(String pkg) {\n+    synchronized (PackageCache.class) {\n+      if (pkg != null) {\n+        return PackageCache.sAppInfos.get(pkg);\n+      }\n+      return null;\n+    }\n+  }\n }",
      "parent_sha": "c82aeb574b958924297a899d7eea9c8c60303a79"
    }
  },
  {
    "oid": "0d25cc9539806899facbb93b184c02b080858a38",
    "message": "FIX: io redirect failed.\n\nSigned-off-by: tiann <twsxtd@gmail.com>",
    "date": "2020-07-18T04:23:23Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/0d25cc9539806899facbb93b184c02b080858a38",
    "details": {
      "sha": "719c1dedc72297a7308adf7bb813c6479189e0fa",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/NativeEngine.java",
      "status": "modified",
      "additions": 4,
      "deletions": 2,
      "changes": 6,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/0d25cc9539806899facbb93b184c02b080858a38/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2FNativeEngine.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/0d25cc9539806899facbb93b184c02b080858a38/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2FNativeEngine.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2FNativeEngine.java?ref=0d25cc9539806899facbb93b184c02b080858a38",
      "patch": "@@ -33,9 +33,11 @@ public class NativeEngine {\n \n     private static boolean sFlag = false;\n \n+    private static final String LIB_NAME = \"va++\";\n+\n     static {\n         try {\n-            System.loadLibrary(\"va++\");\n+            System.loadLibrary(LIB_NAME);\n         } catch (Throwable e) {\n             VLog.e(TAG, VLog.getStackTraceString(e));\n         }\n@@ -142,7 +144,7 @@ public static void forbid(String path) {\n \n     public static void enableIORedirect() {\n         try {\n-            String soPath = String.format(\"/data/data/%s/lib/libva++.so\", VirtualCore.get().getHostPkg());\n+            String soPath = VirtualCore.get().getContext().getApplicationInfo().nativeLibraryDir + File.separator + \"lib\" + LIB_NAME;\n             if (!new File(soPath).exists()) {\n                 throw new RuntimeException(\"io redirect failed.\");\n             }",
      "parent_sha": "a1e2b2a1fe4d71eca1661bf1a7bf4b4fd4fa1f3a"
    }
  },
  {
    "oid": "4fcd85db7d4f4927eca24f79da1e4e5703a244a3",
    "message": "Fix: launchMode bug.",
    "date": "2017-04-04T03:16:17Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/4fcd85db7d4f4927eca24f79da1e4e5703a244a3",
    "details": {
      "sha": "3a2525af302f0c4f6bc47223d97bc9ac50d25a52",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/server/am/ActivityStack.java",
      "status": "modified",
      "additions": 17,
      "deletions": 18,
      "changes": 35,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/4fcd85db7d4f4927eca24f79da1e4e5703a244a3/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fam%2FActivityStack.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/4fcd85db7d4f4927eca24f79da1e4e5703a244a3/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fam%2FActivityStack.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fserver%2Fam%2FActivityStack.java?ref=4fcd85db7d4f4927eca24f79da1e4e5703a244a3",
      "patch": "@@ -29,6 +29,7 @@\n import mirror.android.app.IApplicationThread;\n import mirror.com.android.internal.R_Hide;\n \n+import static android.content.pm.ActivityInfo.FLAG_NO_HISTORY;\n import static android.content.pm.ActivityInfo.LAUNCH_SINGLE_INSTANCE;\n import static android.content.pm.ActivityInfo.LAUNCH_SINGLE_TASK;\n import static android.content.pm.ActivityInfo.LAUNCH_SINGLE_TOP;\n@@ -139,7 +140,7 @@ private boolean markTaskByClearTarget(TaskRecord task, ClearTarget clearTarget,\n                 }\n             }\n             break;\n-            case ACTIVITY: {\n+            case SPEC_ACTIVITY: {\n                 synchronized (task.activities) {\n                     for (ActivityRecord r : task.activities) {\n                         if (r.component.equals(component)) {\n@@ -204,7 +205,6 @@ private void optimizeTasksLocked() {\n \n     int startActivityLocked(int userId, Intent intent, ActivityInfo info, IBinder resultTo, Bundle options,\n                             String resultWho, int requestCode) {\n-\n         optimizeTasksLocked();\n \n         Intent destIntent;\n@@ -247,7 +247,11 @@ int startActivityLocked(int userId, Intent intent, ActivityInfo info, IBinder re\n \n         switch (info.launchMode) {\n             case LAUNCH_SINGLE_TOP: {\n-                singleTop = true;\n+                if (clearTop) {\n+                    clearTop = false;\n+                } else {\n+                    singleTop = true;\n+                }\n                 if (containFlags(intent, Intent.FLAG_ACTIVITY_NEW_TASK)) {\n                     reuseTarget = containFlags(intent, Intent.FLAG_ACTIVITY_MULTIPLE_TASK)\n                             ? ReuseTarget.MULTIPLE\n@@ -278,7 +282,7 @@ int startActivityLocked(int userId, Intent intent, ActivityInfo info, IBinder re\n         }\n         if (clearTarget == ClearTarget.NOTHING) {\n             if (containFlags(intent, Intent.FLAG_ACTIVITY_REORDER_TO_FRONT)) {\n-                clearTarget = ClearTarget.ACTIVITY;\n+                clearTarget = ClearTarget.SPEC_ACTIVITY;\n             }\n         }\n         if (sourceTask == null && reuseTarget == ReuseTarget.CURRENT) {\n@@ -315,17 +319,10 @@ int startActivityLocked(int userId, Intent intent, ActivityInfo info, IBinder re\n                 if (clearTop && topRecord != null && taskMarked) {\n                     topRecord.marked = true;\n                 }\n-                if (topRecord != null) {\n-                    // Target activity is on top\n-                    if (!topRecord.marked && topRecord.component.equals(intent.getComponent())) {\n-                        deliverNewIntentLocked(sourceRecord, topRecord, intent);\n-                        delivered = true;\n-                    }\n-                    if (clearTop && singleTop && hasActivity(topRecord, intent.getComponent())) {\n-                        topRecord.marked = false;\n-                        deliverNewIntentLocked(sourceRecord, topRecord, intent);\n-                        delivered = true;\n-                    }\n+                // Target activity is on top\n+                if (topRecord != null && !topRecord.marked && topRecord.component.equals(intent.getComponent())) {\n+                    deliverNewIntentLocked(sourceRecord, topRecord, intent);\n+                    delivered = true;\n                 }\n             }\n             if (taskMarked) {\n@@ -475,7 +472,9 @@ private Intent startActivityProcess(int userId, ActivityRecord sourceRecord, Int\n             component = ComponentUtils.toComponentName(info);\n         }\n         targetIntent.setType(component.flattenToString());\n-        targetIntent.addFlags(intent.getFlags());\n+        if ((info.flags & FLAG_NO_HISTORY) != 0 || containFlags(intent, Intent.FLAG_ACTIVITY_NO_HISTORY)) {\n+            targetIntent.addFlags(Intent.FLAG_ACTIVITY_NO_HISTORY);\n+        }\n         StubActivityRecord saveInstance = new StubActivityRecord(intent, info,\n                 sourceRecord != null ? sourceRecord.component : null, userId);\n         saveInstance.saveToIntent(targetIntent);\n@@ -611,7 +610,7 @@ private boolean hasActivity(ActivityRecord topRecord, ComponentName component) {\n \n     private enum ClearTarget {\n         NOTHING,\n-        ACTIVITY,\n+        SPEC_ACTIVITY,\n         TASK(true),\n         TOP(true);\n \n@@ -629,4 +628,4 @@ private enum ClearTarget {\n     private enum ReuseTarget {\n         CURRENT, AFFINITY, DOCUMENT, MULTIPLE\n     }\n-}\n+}\n\\ No newline at end of file",
      "parent_sha": "533e3fb8e5ffd912c4eb3556cc3de3cf784361e6"
    }
  },
  {
    "oid": "67d46876294d74e9a3448a97773f5ea1e10faca1",
    "message": "[Exposed-UI] fix vector drawable exception on kitkat.",
    "date": "2018-06-06T06:12:30Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/67d46876294d74e9a3448a97773f5ea1e10faca1",
    "details": {
      "sha": "4df8ce06029d290cd8fe379e486020122c0e1557",
      "filename": "VirtualApp/app/src/main/java/io/virtualapp/about/AboutActivity.java",
      "status": "modified",
      "additions": 4,
      "deletions": 2,
      "changes": 6,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/67d46876294d74e9a3448a97773f5ea1e10faca1/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fabout%2FAboutActivity.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/67d46876294d74e9a3448a97773f5ea1e10faca1/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fabout%2FAboutActivity.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fabout%2FAboutActivity.java?ref=67d46876294d74e9a3448a97773f5ea1e10faca1",
      "patch": "@@ -4,6 +4,7 @@\n import android.content.ClipboardManager;\n import android.content.pm.PackageInfo;\n import android.content.pm.PackageManager;\n+import android.os.Build;\n import android.os.Bundle;\n import android.support.annotation.Nullable;\n import android.support.v7.app.AlertDialog;\n@@ -27,7 +28,6 @@ public class AboutActivity extends VActivity {\n     protected void onCreate(@Nullable Bundle savedInstanceState) {\n         super.onCreate(savedInstanceState);\n \n-\n         View aboutPage = new AboutPage(this)\n                 .isRTL(false)\n                 .setImage(R.mipmap.ic_launcher)\n@@ -47,7 +47,9 @@ Element getCopyRightsElement() {\n         Element copyRightsElement = new Element();\n         final String copyrights = String.format(getString(R.string.copy_right), Calendar.getInstance().get(Calendar.YEAR));\n         copyRightsElement.setTitle(copyrights);\n-        copyRightsElement.setIconDrawable(R.drawable.about_icon_copy_right);\n+        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.KITKAT) {\n+            copyRightsElement.setIconDrawable(R.drawable.about_icon_copy_right);\n+        }\n         copyRightsElement.setIconTint(mehdi.sakout.aboutpage.R.color.about_item_icon_color);\n         copyRightsElement.setIconNightTint(android.R.color.white);\n         copyRightsElement.setGravity(Gravity.CENTER);",
      "parent_sha": "4cb174899de20430cca204e737ad43236b6d11ad"
    }
  },
  {
    "oid": "39bd999297a4aac9097fb9fdca599e9575a8b513",
    "message": "Fix: lost a hook: getIccSerialNumberForSubscriber.",
    "date": "2016-08-11T05:50:05Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/39bd999297a4aac9097fb9fdca599e9575a8b513",
    "details": {
      "sha": "1f23d0da5c2c434aa408007ba76676f65f9382da",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/hook/patchs/phonesubinfo/PhoneSubInfoPatch.java",
      "status": "modified",
      "additions": 3,
      "deletions": 3,
      "changes": 6,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/39bd999297a4aac9097fb9fdca599e9575a8b513/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fphonesubinfo%2FPhoneSubInfoPatch.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/39bd999297a4aac9097fb9fdca599e9575a8b513/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fphonesubinfo%2FPhoneSubInfoPatch.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fphonesubinfo%2FPhoneSubInfoPatch.java?ref=39bd999297a4aac9097fb9fdca599e9575a8b513",
      "patch": "@@ -1,13 +1,13 @@\n package com.lody.virtual.client.hook.patchs.phonesubinfo;\n \n+import android.os.ServiceManager;\n+\n import com.android.internal.telephony.IPhoneSubInfo;\n import com.lody.virtual.client.hook.base.PatchObject;\n import com.lody.virtual.client.hook.base.ReplaceCallingPkgHook;\n import com.lody.virtual.client.hook.base.ReplaceLastPkgHook;\n import com.lody.virtual.client.hook.binders.HookPhoneSubInfoBinder;\n \n-import android.os.ServiceManager;\n-\n /**\n  * @author Lody\n  *\n@@ -44,10 +44,10 @@ protected void applyHooks() {\n \t\taddHook(new ReplaceLastPkgHook(\"getVoiceMailNumberForSubscriber\"));\n \t\taddHook(new ReplaceCallingPkgHook(\"getVoiceMailAlphaTag\"));\n \t\taddHook(new ReplaceLastPkgHook(\"getVoiceMailAlphaTagForSubscriber\"));\n-\n \t\t// The following method maybe need to fake\n \t\taddHook(new ReplaceCallingPkgHook(\"getDeviceId\"));\n \t\taddHook(new ReplaceCallingPkgHook(\"getIccSerialNumber\"));\n+\t\taddHook(new ReplaceLastPkgHook(\"getIccSerialNumberForSubscriber\"));\n \n \t}\n ",
      "parent_sha": "bb4ea22811a01ce70e16cc1e94838dd4cc44c0ef"
    }
  },
  {
    "oid": "f31d310281206e056df13fba3f8e6fe607605bce",
    "message": "Fix: getIntentSender may not work.",
    "date": "2016-08-31T12:11:10Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/f31d310281206e056df13fba3f8e6fe607605bce",
    "details": {
      "sha": "01bd6fa65b8a90adf5b3683a8033274dff890223",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/hook/patchs/am/GetIntentSender.java",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/f31d310281206e056df13fba3f8e6fe607605bce/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fam%2FGetIntentSender.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/f31d310281206e056df13fba3f8e6fe607605bce/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fam%2FGetIntentSender.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fpatchs%2Fam%2FGetIntentSender.java?ref=f31d310281206e056df13fba3f8e6fe607605bce",
      "patch": "@@ -48,7 +48,6 @@ public Object onHook(Object who, Method method, Object... args) throws Throwable\n \t\tif (args.length > 7 && args[7] instanceof Integer) {\n             args[7] = PendingIntent.FLAG_UPDATE_CURRENT;\n         }\n-\t\targs[0] = ActivityManagerCompat.INTENT_SENDER_SERVICE;\n \t\targs[6] = new String[] {null};\n \t\tIInterface sender = (IInterface) method.invoke(who, args);\n \t\tif (Build.VERSION.SDK_INT < Build.VERSION_CODES.JELLY_BEAN_MR2 && sender != null && creator != null) {\n@@ -68,6 +67,7 @@ private Intent redirectIntentSender(int type, String creator, Intent intent) {\n \t\t\t\tif (info != null) {\n \t\t\t\t\tok = true;\n \t\t\t\t\tnewIntent.setClass(getHostContext(), StubPendingActivity.class);\n+\t\t\t\t\tnewIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\n \t\t\t\t}\n \n \t\t\t} break;",
      "parent_sha": "5832058feb924cdd4ee20c749e5ebf280e2bc1ef"
    }
  },
  {
    "oid": "9470a5b29ff8ad02de70df332c1c00dff3995f56",
    "message": "Code: update the code of ServiceEnv.",
    "date": "2016-07-15T12:47:03Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/9470a5b29ff8ad02de70df332c1c00dff3995f56",
    "details": {
      "sha": "814c9d7f78a7b4bcc35f7590ca690e2384a8228a",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/env/ServiceEnv.java",
      "status": "modified",
      "additions": 11,
      "deletions": 13,
      "changes": 24,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/9470a5b29ff8ad02de70df332c1c00dff3995f56/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fenv%2FServiceEnv.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/9470a5b29ff8ad02de70df332c1c00dff3995f56/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fenv%2FServiceEnv.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fenv%2FServiceEnv.java?ref=9470a5b29ff8ad02de70df332c1c00dff3995f56",
      "patch": "@@ -1,14 +1,5 @@\n package com.lody.virtual.client.env;\n \n-import java.util.HashSet;\n-import java.util.Map;\n-import java.util.Set;\n-import java.util.concurrent.ConcurrentHashMap;\n-\n-import com.lody.virtual.client.core.VirtualCore;\n-import com.lody.virtual.client.hook.modifiers.ContextModifier;\n-import com.lody.virtual.helper.proto.AppInfo;\n-\n import android.app.ActivityManagerNative;\n import android.app.Application;\n import android.app.IServiceConnection;\n@@ -20,20 +11,28 @@\n import android.os.IBinder;\n import android.os.RemoteException;\n \n+import com.lody.virtual.client.core.VirtualCore;\n+import com.lody.virtual.client.hook.modifiers.ContextModifier;\n+import com.lody.virtual.helper.proto.AppInfo;\n+\n+import java.util.HashSet;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ConcurrentHashMap;\n+\n /**\n  * @author Lody\n  *\n  *\n  * @see android.app.ActivityThread\n  * @see android.app.IActivityManager\n  *\n- *      \u63d2\u4ef6\u7684Service\u8fd0\u884c\u73af\u5883\u3002 \u5df2\u5e9f\u5f03,\u73b0\u5df2\u91c7\u7528\u65b0\u65b9\u6848\u3002\n+ *   VirtualApp\u7684Service\u8fd0\u884c\u65f6\u73af\u5883\u3002\n  *\n  */\n-@Deprecated\n public class ServiceEnv {\n \n-\tpublic static final ServiceEnv sEnv = new ServiceEnv();\n+\tprivate static final ServiceEnv sEnv = new ServiceEnv();\n \n \tprivate final Map<String, RunningServiceRecord> mServices = new ConcurrentHashMap<String, RunningServiceRecord>();\n \tprivate final Map<IBinder, RunningServiceRecord> mConns = new ConcurrentHashMap<IBinder, RunningServiceRecord>();\n@@ -226,7 +225,6 @@ private static final class ServiceFakeBinder extends Binder {\n \t}\n \n \tprivate static final class RunningServiceRecord {\n-\n \t\tAppInfo appInfo;\n \t\tIBinder binder;\n \t\tServiceFakeBinder token;",
      "parent_sha": "acf82bf404061fa6c4323aab67c44d0eaa1ee392"
    }
  },
  {
    "oid": "6cc3a34720123c2105281e656f7dd593418ca012",
    "message": "Fix: Modify _VA_|_uri_ in handleUninstallShortcutIntent",
    "date": "2017-04-29T12:14:10Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/6cc3a34720123c2105281e656f7dd593418ca012",
    "details": {
      "sha": "2e870e8979da3a9e0da14ad3a2e18816a60baf80",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/hook/proxies/am/MethodProxies.java",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/6cc3a34720123c2105281e656f7dd593418ca012/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fproxies%2Fam%2FMethodProxies.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/6cc3a34720123c2105281e656f7dd593418ca012/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fproxies%2Fam%2FMethodProxies.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fproxies%2Fam%2FMethodProxies.java?ref=6cc3a34720123c2105281e656f7dd593418ca012",
      "patch": "@@ -1521,7 +1521,7 @@ private void handleUninstallShortcutIntent(Intent intent) {\n                 ComponentName componentName = shortcut.resolveActivity(getPM());\n                 if (componentName != null) {\n                     Intent newShortcutIntent = new Intent();\n-                    newShortcutIntent.putExtra(\"_VA_|_uri_\", shortcut);\n+                    newShortcutIntent.putExtra(\"_VA_|_uri_\", shortcut.toUri(0));\n                     newShortcutIntent.setClassName(getHostPkg(), Constants.SHORTCUT_PROXY_ACTIVITY_NAME);\n                     newShortcutIntent.removeExtra(Intent.EXTRA_SHORTCUT_INTENT);\n                     intent.putExtra(Intent.EXTRA_SHORTCUT_INTENT, newShortcutIntent);",
      "parent_sha": "2ef906f619b0708c6d6315d306098091375c6326"
    }
  },
  {
    "oid": "e980bf1c78bc699caca76b3ccef623fee062ca64",
    "message": "Fix: JobScheduler bug.",
    "date": "2017-01-28T04:44:24Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/e980bf1c78bc699caca76b3ccef623fee062ca64",
    "details": {
      "sha": "961afeb6e692c57798b7dab92f5db58627bce321",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/stub/StubJob.java",
      "status": "modified",
      "additions": 23,
      "deletions": 4,
      "changes": 27,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/e980bf1c78bc699caca76b3ccef623fee062ca64/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fstub%2FStubJob.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/e980bf1c78bc699caca76b3ccef623fee062ca64/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fstub%2FStubJob.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fstub%2FStubJob.java?ref=e980bf1c78bc699caca76b3ccef623fee062ca64",
      "patch": "@@ -97,9 +97,13 @@ public void stopJob(JobParameters jobParams) throws RemoteException {\n     /**\n      * Make JobScheduler happy.\n      */\n-    private void emptyCallback(IJobCallback callback, int jobId) throws RemoteException {\n-        callback.acknowledgeStartMessage(jobId, false);\n-        callback.jobFinished(jobId, false);\n+    private void emptyCallback(IJobCallback callback, int jobId) {\n+        try {\n+            callback.acknowledgeStartMessage(jobId, false);\n+            callback.jobFinished(jobId, false);\n+        } catch (RemoteException e) {\n+            e.printStackTrace();\n+        }\n     }\n \n \n@@ -134,10 +138,15 @@ public void jobFinished(int jobId, boolean reschedule) throws RemoteException {\n         @Override\n         public void onServiceConnected(ComponentName name, IBinder service) {\n             clientJobService = IJobService.Stub.asInterface(service);\n+            if (clientJobService == null) {\n+                emptyCallback(clientCallback, jobId);\n+                stopSession();\n+                return;\n+            }\n             try {\n                 clientJobService.startJob(jobParams);\n             } catch (RemoteException e) {\n-\n+                forceFinishJob();\n                 e.printStackTrace();\n             }\n         }\n@@ -147,6 +156,16 @@ public void onServiceDisconnected(ComponentName name) {\n \n         }\n \n+        void forceFinishJob() {\n+            try {\n+                clientCallback.jobFinished(jobId, false);\n+            } catch (RemoteException e) {\n+                e.printStackTrace();\n+            } finally {\n+                stopSession();\n+            }\n+        }\n+\n         void stopSession() {\n             if (clientJobService != null) {\n                 try {",
      "parent_sha": "5cddb9fcc6bfe6061a3cd61d7989a57340027a48"
    }
  },
  {
    "oid": "9dce1a01b267ed5ea9d85004cd9d4802aca8b323",
    "message": "Fix: Replace vuid with uid in getsockoptUcred",
    "date": "2017-04-29T12:15:16Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/9dce1a01b267ed5ea9d85004cd9d4802aca8b323",
    "details": {
      "sha": "6d4a6b17f2ae9be85cc0689ec0502075486851dd",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/hook/proxies/libcore/MethodProxies.java",
      "status": "modified",
      "additions": 2,
      "deletions": 2,
      "changes": 4,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/9dce1a01b267ed5ea9d85004cd9d4802aca8b323/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fproxies%2Flibcore%2FMethodProxies.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/9dce1a01b267ed5ea9d85004cd9d4802aca8b323/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fproxies%2Flibcore%2FMethodProxies.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fhook%2Fproxies%2Flibcore%2FMethodProxies.java?ref=9dce1a01b267ed5ea9d85004cd9d4802aca8b323",
      "patch": "@@ -68,9 +68,9 @@ public String getMethodName() {\n             public Object afterCall(Object who, Method method, Object[] args, Object result) throws Throwable {\n                 if (result != null) {\n                     Reflect ucred = Reflect.on(result);\n-                    int uid = ucred.get(\"vuid\");\n+                    int uid = ucred.get(\"uid\");\n                     if (uid == VirtualCore.get().myUid()) {\n-                        ucred.set(\"vuid\", getBaseVUid());\n+                        ucred.set(\"uid\", getBaseVUid());\n                     }\n                 }\n                 return result;",
      "parent_sha": "6cc3a34720123c2105281e656f7dd593418ca012"
    }
  },
  {
    "oid": "c7a908da539a3e12eea69c7e60bf8a4c5530dfe9",
    "message": "Fix: \u89e3\u51b36.0\u4ee5\u4e0bRenderScriptCacheDir\u5f15\u53d1\u7684\u67d0\u4e9b\u5e94\u7528\u5d29\u6e83\u7684\u95ee\u9898\u3002",
    "date": "2016-08-04T06:29:04Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/c7a908da539a3e12eea69c7e60bf8a4c5530dfe9",
    "details": {
      "sha": "9b68f087ed5681fbc9c73582639d87a0e7e0d7af",
      "filename": "VirtualApp/lib/src/main/java/com/lody/virtual/client/core/AppSandBox.java",
      "status": "modified",
      "additions": 1,
      "deletions": 1,
      "changes": 2,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/c7a908da539a3e12eea69c7e60bf8a4c5530dfe9/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fcore%2FAppSandBox.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/c7a908da539a3e12eea69c7e60bf8a4c5530dfe9/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fcore%2FAppSandBox.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Flib%2Fsrc%2Fmain%2Fjava%2Fcom%2Flody%2Fvirtual%2Fclient%2Fcore%2FAppSandBox.java?ref=c7a908da539a3e12eea69c7e60bf8a4c5530dfe9",
      "patch": "@@ -180,7 +180,7 @@ private static void setupRuntime(ApplicationInfo applicationInfo) {\n \t\t\t} catch (Throwable e) {\n \t\t\t\te.printStackTrace();\n \t\t\t}\n-\t\t\tif (Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {\n+\t\t\tif (Build.VERSION.SDK_INT >= Build.VERSION_CODES.M) {\n \t\t\t\ttry {\n \t\t\t\t\tRenderScriptCacheDir.setupDiskCache(codeCacheDir);\n \t\t\t\t} catch (Throwable e) {",
      "parent_sha": "a6352d7bd4c99d4b5ce9bb13ec3671a57a8b5efe"
    }
  },
  {
    "oid": "6005cf47e21d0eb82c2677fb81b91c91062d7b71",
    "message": "[Exposed] disable log output of version check.",
    "date": "2018-06-06T06:10:15Z",
    "url": "https://github.com/android-hacker/VirtualXposed/commit/6005cf47e21d0eb82c2677fb81b91c91062d7b71",
    "details": {
      "sha": "9c9788eae09a6d1e84f4f19fe3683673e2abff6e",
      "filename": "VirtualApp/app/src/main/java/io/virtualapp/update/VAVersionService.java",
      "status": "modified",
      "additions": 7,
      "deletions": 3,
      "changes": 10,
      "blob_url": "https://github.com/android-hacker/VirtualXposed/blob/6005cf47e21d0eb82c2677fb81b91c91062d7b71/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fupdate%2FVAVersionService.java",
      "raw_url": "https://github.com/android-hacker/VirtualXposed/raw/6005cf47e21d0eb82c2677fb81b91c91062d7b71/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fupdate%2FVAVersionService.java",
      "contents_url": "https://api.github.com/repos/android-hacker/VirtualXposed/contents/VirtualApp%2Fapp%2Fsrc%2Fmain%2Fjava%2Fio%2Fvirtualapp%2Fupdate%2FVAVersionService.java?ref=6005cf47e21d0eb82c2677fb81b91c91062d7b71",
      "patch": "@@ -21,16 +21,20 @@\n public class VAVersionService extends AVersionService {\n     private static final String TAG = \"VAVersionService\";\n \n+    static {\n+        AllenChecker.init(false);\n+    }\n+\n     public static final String CHECK_VERION_URL = \"http://vaexposed.weishu.me/update.json\";\n \n     @Override\n     public void onResponses(AVersionService service, String response) {\n         try {\n             JSONObject versionInfo = new JSONObject(response);\n //            {\n-//                url: \"https://raw.githubusercontent.com/feicien/android-auto-update/develop/extras/android-auto-update-v1.2.apk\",\n-//                        versionCode: 3,\n-//                    updateMessage: \"Android 7.0\"\n+//                url: \"download url\",\n+//                versionCode: 3,\n+//                updateMessage: \"Android 7.0\"\n //            }\n             String url = versionInfo.getString(\"url\");\n             int versionCode = versionInfo.getInt(\"versionCode\");",
      "parent_sha": "dbec7990fbe32d3929f96e995dbdfba7bb234b5a"
    }
  }
]